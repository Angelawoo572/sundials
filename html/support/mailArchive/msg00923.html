<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [sundials&#45;users] Eigenvalues of IDA system -->
<!--X-From-R13: Oyna Vvaqznefu <nynauNyyay.tbi> -->
<!--X-Date: Mon, 19 Mar 2007 11:33:59 &#45;0700 -->
<!--X-Message-Id: Pine.LNX.4.58.0703191127000.2663@tux64.llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 45EFAAFE.3060907@anu.edu.au -->
<!--X-Reference: Pine.LNX.4.58.0703141329300.29004@tux64.llnl.gov -->
<!--X-Reference: 45F9D523.10303@anu.edu.au -->
<!--X-Head-End-->
<html>
<head>
<title>Re: [sundials-users] Eigenvalues of IDA system</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00922.html">Date Prev</a>] [Date Next] [<a href="msg00915.html">Thread Prev</a>] [<a href="msg00902.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00923">Date Index</a></b>]
[<b><a href="threads.html#00923">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sundials-users] Eigenvalues of IDA system</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Alan Hindmarsh &lt;<a href="mailto:alanh%40llnl.gov">alanh@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Mon, 19 Mar 2007 11:31:36 -0700 (PDT)</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Hi John,

Your analysis looks good, except for a sign error: Change the sign of
the whole RHS of your dx'/dx equation.  Was that error in the matrix you
computed e'values for?

So if in fact the spectrum of dx'/dx is in the left half-plane, then
the solutions to the local linear approximation to the system are all
damped (both x and, via inversion of g = 0, also z).  I don't believe
there are other eigenvalues to worry about in the true solution of
the system (as opposed to the numerical solution).  Conversely, any
e'values of dx'/dx that show up in the right half-plane are bad news.

Of course, a badly nonlinear system can behave quite differently from
the local linear approximation.  The only way to eliminate that as the
cause of the trouble would be to explicitly create a linear approximate
system and try IDA on that.

As to the numerics, have you verified that you have consistent initial
conditions?  The initial x is arbitrary, but the initial z must satisfy
g = 0.  As you know, IDA will solve that problem for you if you have
only a guess for the initial z.  It could be that the spectrum you
computed is bad for an inconsistent (x,z), but good for a consistent
one.  Beyond that, IDA should not have any problems with this system,
assuming it is stable.

As to mesh-dependencies, I suggest looking at either the spectrum or
the condition number of the two matrices df/dx' and dg/dz.  Since
these must (in effect) be inverted, the system properties can change
rapidly with small variations in the mesh if either of these matrices
becomes very ill-conditioned.

-Alan H



On Fri, 16 Mar 2007, John Pye wrote:

&gt;<i> Hi Allan,</i>
&gt;<i></i>
&gt;<i> Thank you very much for these thoughts. I'll try to answer all your</i>
&gt;<i> questions here. If you think they deserve to go to the SUNDIALS list,</i>
&gt;<i> please let me know and I'll re-send.</i>
&gt;<i></i>
&gt;<i> Alan Hindmarsh wrote:</i>
&gt;<i> &gt; Hello John,</i>
&gt;<i> &gt;</i>
&gt;<i> &gt; Just a few thoughts (and questions):</i>
&gt;<i> &gt;</i>
&gt;<i> &gt; First, I gather that your DAE system is not an ODE system, that is</i>
&gt;<i> &gt; the time derivative vector y' is not given explicitly in F(t,y,y') = 0.</i>
&gt;<i> &gt; Is that the case?  If so, you should first look carefuly at the issue</i>
&gt;<i> &gt; of well-posedness.  For starters, is dF/dy' singular?  If so, can you</i>
&gt;<i> &gt; identify algebraic equations that are implicit in the system, and are</i>
&gt;<i> &gt; these uniquely solvable for the algebraic components of y (those for</i>
&gt;<i> &gt; which time derivatives do not appear)?  If the system is more</i>
&gt;<i> &gt; complicated than that, have you done anything to convince yourself</i>
&gt;<i> &gt; that it is well-posed?</i>
&gt;<i> &gt;</i>
&gt;<i> My DAE system is a semi-implicit index-one system, with no time variable</i>
&gt;<i> explicitly written in any of the equations. I can divide the equations</i>
&gt;<i> into differential and algebraic equations like this</i>
&gt;<i></i>
&gt;<i> F(y,y') = 0 ---&gt;</i>
&gt;<i></i>
&gt;<i> f(x',x,z) = 0</i>
&gt;<i> g(x,z) = 0</i>
&gt;<i></i>
&gt;<i> x, x' and f are all of length N. g and z are of length M.</i>
&gt;<i> df/dx' and dg/dz are both non-singular.</i>
&gt;<i></i>
&gt;<i> I should imagine that dF/dy' would be singular, as there are M rows that</i>
&gt;<i> contain equations without derivatives. Is there any need to check it?</i>
&gt;<i></i>
&gt;<i> To expand a little on my application: the equations in my model are</i>
&gt;<i> basically those of compressible gas flow. I am applying them to</i>
&gt;<i> two-phase (homogeneous) steam/water flow, which means that the fluid</i>
&gt;<i> properties are a bit tricker, but the structure of the equations is the</i>
&gt;<i> same. The flow is one-dimensional (this means that shocks are possible,</i>
&gt;<i> I think). There is no viscosity. As well as the fluid flow, there is</i>
&gt;<i> thermal mass in the pipe wall being considered, which means there a four</i>
&gt;<i> differential equations per pipe segment. The algebraic equations are to</i>
&gt;<i> do with external heat loss (outside of pipe), internal heat transfer,</i>
&gt;<i> pipe friction and calculation of fluid properties.</i>
&gt;<i></i>
&gt;<i> From the above, I believe I may have a well-posed problem. The</i>
&gt;<i> literature states that the *two-fluid* model of two-phase flow is</i>
&gt;<i> ill-posed, but as far as I can tell, this might not be true for</i>
&gt;<i> homogeneous two-phase flow (ie treated as a single compressible fluid).</i>
&gt;<i> If shocks are possible (as they are in compressible inviscid gas flow)</i>
&gt;<i> does that mean that there is not 'continuous dependence on the data'?</i>
&gt;<i> Unfortunately I haven't been able to locate any examples of how to</i>
&gt;<i> mathematically check ill-posedness.</i>
&gt;<i></i>
&gt;<i> I can remove the shocks from the system if I want: the momentum equation</i>
&gt;<i> can be replaced by simplified algebraic equation that effectively</i>
&gt;<i> eliminates the compression, or 'pressure' waves from the system. This is</i>
&gt;<i> probably tolerable for my application, which is dealing with</i>
&gt;<i> longer-period transients than those seen from the pressure waves.</i>
&gt;<i></i>
&gt;<i> You asked about the algebraic equations being uniquely solvable. No</i>
&gt;<i> problem there as far as I can tell: the fluid property equations are</i>
&gt;<i> written with rhof(T), rhog(T), hf(alpha(T),T), hg(alpha(T),T), etc then</i>
&gt;<i> rho(rhof,rhog,x),h(hf,hg,x) etc. I am only implementing saturation</i>
&gt;<i> properties.</i>
&gt;<i></i>
&gt;<i> &gt; The behavior you describe sounds like that of a system like Ay' = f(t,y),</i>
&gt;<i> &gt; in which the matrix A is nearly singular, and changes in mesh size are</i>
&gt;<i> &gt; drastically affecting the spectrum of A^{-1} df/dy, even though the</i>
&gt;<i> &gt; changes in A are numerically small.  In that case, I would try to find</i>
&gt;<i> &gt; a singluar matrix A0 that A is nearly equal to, and study the system</i>
&gt;<i> &gt; A0 y' = f instead.  This has a (perhaps implicit) algebraic subsystem</i>
&gt;<i> &gt; that your original problem is 'trying' to enforce, and if that</i>
&gt;<i> &gt; subsystem makes sense, it would be better to enforce it directly,</i>
&gt;<i> &gt; especially if that eliminates the large positive Re(lambda).</i>
&gt;<i> &gt;</i>
&gt;<i></i>
&gt;<i> Before getting too much into what the cause of this strange meshing</i>
&gt;<i> behaviour might be, I think perhaps I need to verify my technique for</i>
&gt;<i> calculating these eigenvalues. As I said, I'm a bit out of my comfort</i>
&gt;<i> zone with this, so it's possible I've made a mistake.</i>
&gt;<i></i>
&gt;<i> The above separated differential and algebraic equations can be</i>
&gt;<i> differentiated</i>
&gt;<i></i>
&gt;<i> df = 0 = f_x' dx' + f_x dx + f_z dz</i>
&gt;<i> dg = 0 = g_x dx + g_z dz</i>
&gt;<i></i>
&gt;<i> I am asserting that I remain on the trajectory of a solution, so I can</i>
&gt;<i> say that df and dg are equal to zero. Then I can solve the *matrix*</i>
&gt;<i> equatons by eliminating dz:</i>
&gt;<i></i>
&gt;<i> I've written all this up on our ASCEND Wiki,</i>
&gt;<i> <a  href="http://ascendwiki.cheme.cmu.edu/IDA">http://ascendwiki.cheme.cmu.edu/IDA</a></i>
&gt;<i></i>
&gt;<i> The solution is then</i>
&gt;<i></i>
&gt;<i> dx'/dx = (f_x')^-1 * [ f_x - f_z * { (g_z)^-1 * g_x } ]</i>
&gt;<i></i>
&gt;<i> As far as I can tell, the eigenvalues of this matrix will be the</i>
&gt;<i> eigenvalues of my dynamic system. Am I right to say that? Are there</i>
&gt;<i> eigenvalues associated with my algebraic variables that I should be</i>
&gt;<i> worrying about?</i>
&gt;<i></i>
&gt;<i></i>
&gt;<i> &gt; Without knowing more about what the matrix is whose eigenvalues</i>
&gt;<i> &gt; you are studying, it is hard to know if finding some in the right</i>
&gt;<i> &gt; half-plane is worrisome.  If dF/dy' is singular, have you generated an</i>
&gt;<i> &gt; equivalent, reduced-size, ODE system (with algebraic components</i>
&gt;<i> &gt; eliminated), and computed the Jacobian of that system?  If that is the</i>
&gt;<i> &gt; matrix, then yes you do not want to see those large positive</i>
&gt;<i> &gt; Re(lambda) values.</i>
&gt;<i> &gt;</i>
&gt;<i></i>
&gt;<i> This is what I did above actually. The web page (above) contains an</i>
&gt;<i> example of the plot of those eigenvalues, too, BTW.</i>
&gt;<i></i>
&gt;<i> I was looking at this from the physical point of view: thermodynamically</i>
&gt;<i> it's not possible that variables in my real system grow without bound.</i>
&gt;<i> So if I have eigenvalues in the right half-plane, it means that</i>
&gt;<i> something in the mathematical representation of my system is incorrect,</i>
&gt;<i> which is therefore worrying. I am worried about anything that causes</i>
&gt;<i> eigenvalues in the right half plane. Wouldn't you agree?</i>
&gt;<i></i>
&gt;<i></i>
&gt;<i> &gt; The large eigenvalues you see are a little similar to the situation</i>
&gt;<i> &gt; with central differencing of a diffusion equation, where the eigenvalues</i>
&gt;<i> &gt; of the Jacobian tend to -infinity as the mesh is refined.  But they</i>
&gt;<i> &gt; are always negative -- no positive real parts, in conformity with</i>
&gt;<i> &gt; the continuous operator involved, which has a spectrum stretching</i>
&gt;<i> &gt; to -infinity.</i>
&gt;<i> &gt;</i>
&gt;<i></i>
&gt;<i> This is probably what I would have expected, and is why I am so puzzled</i>
&gt;<i> by the current pattern of eigenvalues.</i>
&gt;<i></i>
&gt;<i> I have checked my eigenvalue plots for that case of pure ODE systems,</i>
&gt;<i> but perhaps if you know of a suitable example of a DAE system with known</i>
&gt;<i> eigenvalues then I could use that to check my method? Again, eigenvalues</i>
&gt;<i> in the context of DAE systems are not something I have been able to find</i>
&gt;<i> much information about.</i>
&gt;<i></i>
&gt;<i> &gt; As to the general question of using eigen-analysis for ODE/DAE</i>
&gt;<i> &gt; systems, this is sometimes done, but not often, just because it is</i>
&gt;<i> &gt; usually difficult -- both to obtain the right matrix and to compute</i>
&gt;<i> &gt; eigenvalues.  Also, doing this for DAEs is considerably more involved</i>
&gt;<i> &gt; that for ODEs.  For a linearized problem Ay' = By, the eigen-problem</i>
&gt;<i> &gt; is the generalized one, A lambda v = B v.  You should look at some of</i>
&gt;<i> &gt; the DAE literature for more on this.</i>
&gt;<i> &gt;</i>
&gt;<i></i>
&gt;<i> I assume you are mainly talking about the practical difficulties? With</i>
&gt;<i> ASCEND I have got all the code in place to perform the above analyses.</i>
&gt;<i> Subject to careful checking of course, which still remains to be done.</i>
&gt;<i></i>
&gt;<i> But if there is something lacking in my method, or some unrealised</i>
&gt;<i> simplification that I am making, please let me know.</i>
&gt;<i></i>
&gt;<i> Cheers</i>
&gt;<i> JP</i>
&gt;<i></i>
&gt;<i> &gt; On Thu, 8 Mar 2007, John Pye wrote:</i>
&gt;<i> &gt;</i>
&gt;<i> &gt;&gt;</i>
&gt;<i> &gt;&gt; Can anyone comment on whether this approach of plotting eigenvalues for</i>
&gt;<i> &gt;&gt; a DAE system sounds like a good idea, and can anyone suggest what this</i>
&gt;<i> &gt;&gt; sensitivity to the number of spatial nodes could be all about?</i>
&gt;<i> &gt;&gt;</i>
&gt;<i> &gt;&gt;</i>
&gt;<i> &gt;&gt;</i>
&gt;<i></i>

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00897" href="msg00897.html">[sundials-users] Eigenvalues of IDA system</a></strong>
<ul><li><em>From:</em> John Pye &lt;john.pye@anu.edu.au&gt;</li></ul></li>
<li><strong><a name="00915" href="msg00915.html">Re: [sundials-users] Eigenvalues of IDA system</a></strong>
<ul><li><em>From:</em> Alan Hindmarsh &lt;alanh@llnl.gov&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00922.html">Re: [sundials-users] CVODE compile error</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00915.html">Re: [sundials-users] Eigenvalues of IDA system</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00902.html">[sundials-users] Alternate linear solvers for kinsol</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00923">
<strong>Main</strong></a></li>
<li><a href="threads.html#00923">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
