<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [sundials&#45;users] Installing/checking sundials 2.1.1 -->
<!--X-From-R13: Dnqh Ereona <freona1Nyyay.tbi> -->
<!--X-Date: Tue, 07 Mar 2006 08:42:45 &#45;0800 (PST) -->
<!--X-Message-Id: 440DB78E.2010505@llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 4ba776c00603010317l2821e22w39fcdc18ca460816@mail.gmail.com -->
<!--X-Reference: 44062C4D.7030904@llnl.gov -->
<!--X-Reference: 4ba776c00603070740y6cb1d4dag3bdafc6545081268@mail.gmail.com -->
<!--X-Head-End-->
<html>
<head>
<title>Re: [sundials-users] Installing/checking sundials 2.1.1</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00350.html">Date Prev</a>] [<a href="msg00352.html">Date Next</a>] [<a href="msg00350.html">Thread Prev</a>] [<a href="msg00326.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00351">Date Index</a></b>]
[<b><a href="threads.html#00351">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sundials-users] Installing/checking sundials 2.1.1</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Radu Serban &lt;<a href="mailto:serban1%40llnl.gov">serban1@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Tue, 07 Mar 2006 08:40:46 -0800</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Christos,</pre><br>
<pre style="margin: 0em;">comments interspersed below...</pre><br>
Christos Frouzakis wrote:
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">Hi Radu,</pre><br>
thank you for the suggestions. Indeed setting -with-mpi*=no, solved the 
problem with the MPI libraries and include files. The linking issue will 
have to wait for the next release,  for now  I just edit the makefiles 
by hand.
</blockquote><br>Can you please attach one of your modified Makefiles (for example the one in cvode/fcmix/examples_ser)? Also, could you please indicate what 
 SUNDIALS version you use (please post the revision numbers from the comment section at the top of the following files: cvode.h cvode.c 
fcvode.h fcvode.c)<br>
<br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em">As before, the compilation goes through without complaints, but for some 
solvers the output from the examples does not compare well with the 
output provided. I'm particularly interested in cvode, and more 
specifically for mixed fortran/C codes (fcmix). As an example, the 
output of cvbandf is as follows
</blockquote><pre style="margin: 0em;"><br>Interesting. I assume you did check the C examples and they work fine, 
correct? Does cvbx update the solution vector?</pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">Band example problem:</pre><br>
<pre style="margin: 0em;"> Advection-diffusion, NEQ = 50</pre><br>
<pre style="margin: 0em;"><br> At t =   0.00  max.norm(u) =   0.895472E+02
 At t =   0.10  max.norm(u) =   0.895472E+02  NST =   85
 At t =   0.20  max.norm(u) =   0.895472E+02   NST =  103
 At t =   0.30  max.norm(u) =   0.895472E+02  NST =  113
 At t =   0.40  max.norm(u) =   0.895472E+02  NST =  120
 At t =   0.50  max.norm(u) =   0.895472E+02  NST =  126
 At t =   0.60  max.norm(u) =   0.895472E+02  NST =  130
 At t =   0.70  max.norm(u) =   0.895472E+02  NST =  134
 At t =   0.80  max.norm(u) =   0.895472E+02  NST =  137
 At t =   0.90  max.norm(u) =   0.895472E+02  NST =  140
 At t =   1.00   max.norm(u) =   0.895472E+02  NST =  142</pre><br>
<pre style="margin: 0em;"><br>Final statistics:</pre><br>
<pre style="margin: 0em;"> No. steps =  142  No. f-s =  173  No. J-s =    3   No. LU-s =   23
 No. nonlinear iterations =  170
 No. nonlinear convergence failures =    0
 No. error test failures =    3</pre><br>
The solution remains unchanged from the initial condition, although, for 
this case, the final statistics match the provided output. The rest of 
the examples show similar behavior (solution=initial condition).<br>
<br>
The compiler does not make a difference (I've tried with gcc/g77 and 
pgcc/pgf77.<br>
<br>
<pre style="margin: 0em;">Any suggestions before diving in the code(s) with the debugger?</pre><br>
-Christos.
</blockquote><br>To pinpoint the problem, can you please try the following: in the function FCV_CVODE in cvode/fcmix/fcvode.c, right after the call to 
CVode(), add the call:<br>
     N_VPrint_Serial(F2C_vec)<br>
and after the call to N_VGetArrayPointer(), print out some of the values of the array y.<br>
Recompile the fcvode library and one of the fcvode serial examples and run it.<br>
<br>
If what N_VPrint matches what is in the y vector (as I suspect it will), the problem is that the pointer y is not passed properly to the 
Fortran program. This would point to some Opteron-specific problems with mixing Fortran and C. I do not have access to such hardware, but a 
quick Google search revealed some potential issues related to the default integer size. This (or similar issues) can be the cause of your 
problems. You'll have to read more carefully the documentation for the Fortran compiler on Opteron.<br>
<br>
<pre style="margin: 0em;">--Radu</pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">On 3/2/06, *Radu Serban* &lt;serban1@llnl.gov &lt;<a  href="mailto:serban1@llnl.gov">mailto:serban1@llnl.gov</a>&gt;&gt; wrote:</pre><br>
<pre style="margin: 0em;">    Hi Christos,</pre><br>
<pre style="margin: 0em;">    Christos Frouzakis wrote:
     &gt; I am trying to install sundials on an Opteron cluster with Quadrics
     &gt; interconnect using the Portland group compilers.
     &gt; As there are no Quadrics MPI wrappers for the PGI compiles, I had to
     &gt; explicitly define the paths for the include files and libraries. The
     &gt; configuration was done with the command
     &gt;
     &gt; ./configure CC=pgcc CFLAGS=-fast F77=pgf77 FFLAGS=-fast
     &gt; --with-mpicc=pgcc --with-mpif77=pgf77
     &gt; --with-mpi-incdir=/usr/lib/mpi/include
     &gt; --with-mpi-libdir=/usr/lib/mpi/lib --with-mpi-libs=&quot;-lmpifarg -lmpi
     &gt; -lelan -g77libs&quot; --with-libs=-lg2c
     &gt;
     &gt; The configuration script did not correctly set the mpi include and
     &gt; library paths, so the corresponding makefiles were corrected by hand.</pre><br>
<pre style="margin: 0em;">    In the release version, if you want to manually specify the MPI
    include and lib directories, you need to set --with-mpicc=no and
    --with-mpif77=no, in which case configure will try to link MPI
    programs with the C and Fortran compilers and using the MPI flags
    you specify
    (include and lib dir, MPI flags and libraries).</pre><br>
<pre style="margin: 0em;">    With your current configure line, the script assumes you are using
    an MPI script/wrapper which would internally set the appropriate MPI
    include and lib directories. However, to make sure we do not get
    errors in the Makefiles (&quot;empty&quot; -I flags), if an mpicc script is
    used, we
    just set MPI_INC_DIR and MPI_LIB_DIR based on the location of mpicc
    (overwriting any user-specified MPI locations).</pre><br>
<pre style="margin: 0em;">    This is the reason why you see the &quot;wrong&quot; MPI_INCDIR and MPI_LIBDIR
    paths in the generated Makefiles. Since you specified
    --with-mpicc=pgcc, they are path_to_pgcc/../include and
    path_to_pgcc/../lib, respectively. Correct?</pre><br>
<pre style="margin: 0em;">    This issue has been resolved for the next release (see step 1b below).</pre><br>
<pre style="margin: 0em;">     &gt; The code compiled without any problems, warnings, or errors.
     &gt;
     &gt; In order to compile the examples, the linker had to be changed
    from CC
     &gt; to F77, but then everything went smoothly.</pre><br>
<pre style="margin: 0em;">    Indeed, in the release version, CC and MPICC are used to link the
    serial and parallel Fortran examples, respectively. This has been
    changed
    for the next release (see step 4 below)</pre><br>
<pre style="margin: 0em;">     &gt; Unfortunately, when I run the examples I get completely wrong results
     &gt; (in comparison to the corresponding *.out files).
     &gt; After a day of trying with compiler flags and modification of
    makefiles,
     &gt; I ran out of ideas ... Any suggestions?
     &gt;</pre><br>
<pre style="margin: 0em;">    Which examples are you referring to (all of them?) and what do you
    mean by 'completely wrong'? It is OK (actually quite likely) to get
    slightly different results (by this I mean within the specified
    tolerances) on different platforms and using different compilers,
    especially
    when using any optimization flags (the pgcc/pgf77 -fast flag will
    turn on level 2 optimization).</pre><br>
<pre style="margin: 0em;">     &gt; Best,
     &gt;
     &gt; -Christos Frouzakis</pre><br>
<pre style="margin: 0em;"><br>    Here's an overview of the MPI-related logic implemented in the
    SUNDIALS configure script.
    I refer here on the current development version which may be
    slightly different than what is in the released version, but I'd
    like to open
    this up for discussion in anticipation of the next release.</pre><br>
<pre style="margin: 0em;">    C MPI Tests
    -----------</pre><br>
<pre style="margin: 0em;">    The default behavior is to look for MPI compilation scripts/wrappers
    (mpicc or similar) which will automatically take care of passing the
    appropriate -I, -L, and -l options required by the MPI program. To
    overwrite the default behavior, you MUST specify --with-mpicc=no</pre><br>
<pre style="margin: 0em;">    1) If --with-mpicc is not specified, we assume MPICC=mpicc. If it is
    specified to something other than 'no' we use that script name as MPICC.</pre><br>
<pre style="margin: 0em;">    Next, we test if MPICC exists as a file (we cannot reliably test if
    it is executable since the '-x' test flag is not portable). If it
    cannot
    be found, we look into the user's path for it, or we try to use the
    MPI root directory (if specified).</pre><br>
<pre style="margin: 0em;">    a) If we still cannot find it, we give up MPI checking.
    b) If we can find it, we just set MPICC and then, ONLY if
    MPI_INC_DIR and/or MPI_LIB_DIR are empty, to resolve potential
    Makefile problems,
    we set them to basedir/../include and basedir/../lib, respectively
    (where basedir is the directory portion of the full pathname of MPICC)</pre><br>
<pre style="margin: 0em;">    2) If the configure line contains --with-mpicc=no then we attempt to
    link MPI programs with the C compiler (optionally specified through CC)
    and using the MPI include and lib directories and the MPI libraries
    provided by the user. The logic in this case is as follows:</pre><br>
<pre style="margin: 0em;">    a) Search for an MPI implementation
    if --with-mpi-incdir is specified, use it as MPI_INCDIR.
    else if --with-mpi-root is specified, use it to set MPI_INCDIR by
    appending /include
    else give up MPI checking</pre><br>
<pre style="margin: 0em;">    b) Search for MPI libraries
    if --with-mpi-libdir is specified, use it as MPI_LIBDIR
    else use MPI root directory to set MPI_LIBDIR by appending /lib</pre><br>
<pre style="margin: 0em;">    c) Check for the MPI libraries
    if --with-mpi-libs is not specified give up MPI checking
    else we try to link a test program</pre><br>
<pre style="margin: 0em;">    In this case, MPICC is the same as CC.</pre><br>
<pre style="margin: 0em;">    Fortran MPI Tests
    -----------------</pre><br>
<pre style="margin: 0em;">    If MPI Fortran is needed (based on which, if any, SUNDIALS modules
    are disabled, on whether Fortran support is enabled/disabled, on whether
    a working serial Fortran compiler was found previously, etc) we
    perform similar tests to the above ones.</pre><br>
<pre style="margin: 0em;">    In addition, the build system performs the following two tests:</pre><br>
<pre style="margin: 0em;">    3) Determine if MPI_Comm_f2c() from MPI-2 is supported so that
    communicators other than MPI_COMM_WORLD can be used in parallel
    Fortran programs</pre><br>
<pre style="margin: 0em;">    4) Determine what should be used to link parallel Fortran examples</pre><br>
<pre style="margin: 0em;">    If the MPICC wrapper or compiler (depending on steps 1 and 2 above)
    is NOT a C++ compiler then use MPIF77 to link.
    Else, we test if MPICC can link a Fortran parallel example. If yes,
    we will use MPICC to link. If not, we will use MPIF77 to link.</pre><br>
<pre style="margin: 0em;"><br>    --Radu</pre><br>
<pre style="margin: 0em;">    --
        Radu Serban
        Center for Applied Scientific Computing   [email] radu@llnl.gov
    &lt;<a  href="mailto:radu@llnl.gov">mailto:radu@llnl.gov</a>&gt;
        Lawrence Livermore National Laboratory    [phone] 925-424-4852
        P.O. Box 808, L-560                       [fax]   925-422-6287
        Livermore, CA 94551</pre><br>
<br>
</blockquote><pre style="margin: 0em;"><br></pre><br>
<br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00325" href="msg00325.html">[sundials-users] Installing/checking sundials 2.1.1</a></strong>
<ul><li><em>From:</em> Christos Frouzakis &lt;christos.frouzakis@gmail.com&gt;</li></ul></li>
<li><strong><a name="00329" href="msg00329.html">Re: [sundials-users] Installing/checking sundials 2.1.1</a></strong>
<ul><li><em>From:</em> Radu Serban &lt;serban1@llnl.gov&gt;</li></ul></li>
<li><strong><a name="00350" href="msg00350.html">Re: [sundials-users] Installing/checking sundials 2.1.1</a></strong>
<ul><li><em>From:</em> Christos Frouzakis &lt;christos.frouzakis@gmail.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00350.html">Re: [sundials-users] Installing/checking sundials 2.1.1</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00352.html">Re: [sundials-users] Changing algebraic variables during integration with IDA</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00350.html">Re: [sundials-users] Installing/checking sundials 2.1.1</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00326.html">[sundials-users] Re: root finding in IDA</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00351">
<strong>Main</strong></a></li>
<li><a href="threads.html#00351">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
