<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: Re&#45;4: [sundials&#45;users] performance for chemical kinetic problems -->
<!--X-From-R13: [vpunry Zrgmthf <zvpunry.yrgmthfNhav&#45;ovryrsryq.qr> -->
<!--X-Date: Wed, 27 Sep 2006 14:53:53 &#45;0700 -->
<!--X-Message-Id: 451AF248.3060208@uni&#45;bielefeld.de -->
<!--X-Content-Type: multipart/signed -->
<!--X-Reference: Pine.LNX.4.58.0609201521260.28545@tux64.llnl.gov -->
<!--X-Reference: 4511C60E.3000405@uni&#45;bielefeld.de -->
<!--X-Reference: Pine.LNX.4.58.0609271401190.16395@tux64.llnl.gov -->
<!--X-Derived: pgpqOZdJ7Quk3.pgp -->
<!--X-Head-End-->
<html>
<head>
<title>Re: Re-4: [sundials-users] performance for chemical kinetic problems</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00709.html">Date Prev</a>] [<a href="msg00711.html">Date Next</a>] [<a href="msg00709.html">Thread Prev</a>] [<a href="msg00712.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00710">Date Index</a></b>]
[<b><a href="threads.html#00710">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: Re-4: [sundials-users] performance for chemical kinetic problems</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Michael Letzgus &lt;<a href="mailto:michael.letzgus%40uni-bielefeld.de">michael.letzgus@uni-bielefeld.de</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Wed, 27 Sep 2006 23:51:04 +0200</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Hi Alan.


Alan Hindmarsh schrieb:
&gt;<i> </i>
&gt;<i> I'm not sure what step 1 here means.  If each pass through these steps</i>
&gt;<i> is a pulse, and the function k(t) is different for different pulses,</i>
&gt;<i> then you just need to be sure that you communicate to the RHS and</i>
&gt;<i> Jacobian functions what pulse is currently being computed.  You can do        </i>
&gt;<i> that either with global variables or with the f_data pointer.</i>

I'm simulating a multi-level spectroscopic system, and my pulse is an
excitation laser pulse applied to this system.
The laser pulse is short (~1E-12 sec) compared to the behavior of the
total system (~1E-7 sec).
I'm interested in what happens during the excitation and in the behavior
of the relaxation  process.

To do so, I have to multiply the excitation coefficients by the temporal
laser pulse shape. This laser pulse shape could be an analytic function,
but I also need a sampled (measured) pulse profile, so I have ~300
samples of laser power in time ( pulse(t) in my last post ).
To apply this pulse, I have to force the solver not to step over my
(short) pulse - this is the sequence 1-4:

1) calculate excitation coefficients based on current laser power
2) CVodesetstoptime(tstop);  // tstop is the next available sample of
the pulse

3) Cvode(...., CV_NORMAL_STOP);
4) goto 1



&gt;<i> Otherwise, your 4-step outline looks fine.  Jacobians should be</i>
&gt;<i> recomputed (or recalled from storage, depending on jok) within the</i>
&gt;<i> CVSpilsPrecSetupFn function when it is called.</i>

Hm, I think this is only possible for me if I can force the solver to
call CVSpilsPrecSetupFn between t_pulsestart and t_pulseend several
times. Otherwise, the solver will miss most of my pulse.


My (block) diagonal approach works very well, the number of convergence
failures is now 0.

My earlier reported loss of performance when changing from diagonal
approach via block-diagonal to full preconditioning was a stupid &quot;flaw&quot;
in my matrix setup, I accidentally used J[i][j] - but it must be J[j][i].
I used a transposed jacobian as preconditioner which caused the loss in
performance.


Best regards,
 Michael

</pre><p><strong>Attachment:
<a href="pgpqOZdJ7Quk3.pgp" >signature.asc</a></strong><br>
<em>Description:</em> OpenPGP digital signature</p>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00712" href="msg00712.html">Re: Re-4: [sundials-users] performance for chemical kinetic problems</a></strong>
<ul><li><em>From:</em> Alan Hindmarsh &lt;alanh@llnl.gov&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00702" href="msg00702.html">Re: Re-4: [sundials-users] performance for chemical kinetic problems</a></strong>
<ul><li><em>From:</em> Alan Hindmarsh &lt;alanh@llnl.gov&gt;</li></ul></li>
<li><strong><a name="00703" href="msg00703.html">Re: Re-4: [sundials-users] performance for chemical kinetic problems</a></strong>
<ul><li><em>From:</em> Michael Letzgus &lt;michael.letzgus@uni-bielefeld.de&gt;</li></ul></li>
<li><strong><a name="00709" href="msg00709.html">Re: Re-4: [sundials-users] performance for chemical kinetic problems</a></strong>
<ul><li><em>From:</em> Alan Hindmarsh &lt;alanh@llnl.gov&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00709.html">Re: Re-4: [sundials-users] performance for chemical kinetic problems</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00711.html">[sundials-users] Re: large stiff ODE system</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00709.html">Re: Re-4: [sundials-users] performance for chemical kinetic problems</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00712.html">Re: Re-4: [sundials-users] performance for chemical kinetic problems</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00710">
<strong>Main</strong></a></li>
<li><a href="threads.html#00710">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
