<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: yout in CVode() -->
<!--X-From-R13: Dnqh Ereona <freona1Nyyay.tbi> -->
<!--X-Date: Thu, 01 Dec 2005 09:21:51 &#45;0800 (PST) -->
<!--X-Message-Id: 438F2F31.5030003@llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1EhphT&#45;000PdE&#45;00.smallhare&#45;inbox&#45;ru@f30.mail.ru -->
<!--X-Head-End-->
<html>
<head>
<title>Re: yout in CVode()</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00188.html">Date Prev</a>] [<a href="msg00191.html">Date Next</a>] [<a href="msg00188.html">Thread Prev</a>] [<a href="msg00191.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00190">Date Index</a></b>]
[<b><a href="threads.html#00190">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: yout in CVode()</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Radu Serban &lt;<a href="mailto:serban1%40llnl.gov">serban1@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Thu, 01 Dec 2005 09:13:21 -0800</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<tt>Ivan Ivanov wrote:
</tt><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">Hi,</pre><br>
<pre style="margin: 0em;">Some questions:</pre><br>
<pre style="margin: 0em;">To do not copy the content of y vector after each call of CVode to my arrays I 
would like to attach the y content to my array via 
N_VSetArrayPointer_Serial(my_array, y).
It just overwrites the pointer '*data' in y with a pointer to my array. But if 
y was created by N_VNew_Serial() then the pointer to internally allocated 
memory will be lost. Moreover, after a call to N_VDestroy_Serial() the user 
data attached by N_VSetArrayPointer_Serial() will be deallocated.</pre><br>
<pre style="margin: 0em;">Am I right?</pre><br>
<pre style="margin: 0em;">If so, then N_VSetArrayPointer_Serial() probably should check 'own_data' and 
deallocate '*data' if needed before overwriting.</pre><br>
<pre style="margin: 0em;">At the moment use of N_VMake_Serial seems to be safe in that sense, or?</pre><br>
<pre style="margin: 0em;">Ivan Ivanov,
Institut fuer Theoretische Physik und Computational
Physics, Technische Universitaet Graz,  Petersgasse 16,  A-8010 Graz
phone/fax: +43(0)316 873 8195,             email: smallhare@inbox.ru
</pre></blockquote><pre style="margin: 0em;"><br>Hi Ivan,</pre><br>
<tt>The 'yout' argument to CVode() is owned and allocated by the user, not by the solver. Therefore, you 
can make sure that the data field in the yout N_Vector points to my_array before calling CVode(). 
You can do this in several different ways (note that these methods may not work with NVECTOR modules 
other than NVECTOR_SERIAL or NVECTOR_PARALLEL since they use constructors not required -- albeit 
recommended -- to exist in any NVECTOR implementation):</tt><br>
<br>
<tt>(a)<br>
Create an &quot;empty&quot; N_Vector yout using N_VNewEmpty_Serial and attach my_array to it. You can attach 
my_array either by calling N_VSetArrayPointer_Serial or by using the macro NV_DATA_S defined in 
nvector_serial.h. We recommend the latter method.</tt><br>
<br>
<tt>If you already have an N_Vector created (e.g. y0, the vector of initial conditions), you can use 
N_VCloneEmpty_Serial instead of N_VNewEmpty_Serial above to create yout by cloning.</tt><br>
<br>
<pre style="margin: 0em;">Option (a), using N_VNewEmpty_Serial and NV_DATA_S looks like the following 
code snippet:</pre><br>
<pre style="margin: 0em;">...
long int N;
realtype *my_array;
N_Vector yout;
...
yout = N_VNewEmpty_Serial(N);
my_array = (realtype *)malloc(N*sizeof(realtype));
NV_DATA_S(yout) = my_array;
...
flag = CVode(cvode_mem, tout, yout, &amp;tret, itask);
...
N_VDestroy_Serial(yout);
free(my_array);</pre><br>
<tt>(b)<br>
Use N_VMake_Serial, as you mentioned in your email (if you look into the implementation of this 
function, you'll see that it is basically equivalent to option (a) above).</tt><br>
<br>
<tt>(c)<br>
Use N_VNew_Serial to create yout, use it in the call to CVode(), and then grab the data into 
my_array. You can get the data from yout either by using the macro NV_DATA_S (recommended) or by 
calling the function N_VGetArrayPointer_Serial.</tt><br>
<br>
<pre style="margin: 0em;">In this case, you DO NOT need to allocate or free my_array!</pre><br>
<pre style="margin: 0em;">...
long int N;
realtype *my_array;
N_Vector yout;
...
yout = N_VNew_Serial(N);
...
flag = CVode(cvode_mem, tout, yout, &amp;tret, itask);
my_array = NV_DATA_S(yout);
...
N_VDestroy_Serial(yout);</pre><br>
<tt><br>NOTE: The function N_VSetArrayPointer_Serial is really intended only for internal use by the 
SUNDIALS solvers (where we do not want it to change the ownership flag), but if used in option (a) 
above it is safe from this point of view since both N_VNewEmpty_Serial and N_VCloneEmpty_Serial set 
own_data=FALSE. Therefore, whenever N_VDestroy_Serial(yout) is called, the data field in yout will 
not be freed, leaving that task to the user (who owns it).</tt><br>
<br>
<pre style="margin: 0em;">-- Radu</pre><br>
<pre style="margin: 0em;"><br>--
   Radu Serban
   Center for Applied Scientific Computing   [email] radu@llnl.gov
   Lawrence Livermore National Laboratory    [phone] 925-424-4852
   P.O. Box 808, L-560                       [fax]   925-422-6287
   Livermore, CA 94551</pre><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00188.html">Root finding ok</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00191.html">must N_VSpace return an exact result?</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00188.html">Root finding ok</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00191.html">must N_VSpace return an exact result?</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00190">
<strong>Main</strong></a></li>
<li><a href="threads.html#00190">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
