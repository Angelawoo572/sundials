<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [sundials&#45;users] Re: CVODES Question -->
<!--X-From-R13: Dnqh Ereona <enqhNyyay.tbi> -->
<!--X-Date: Wed, 28 Feb 2007 18:13:59 &#45;0800 -->
<!--X-Message-Id: 45E635F5.5070705@llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 45DF330C.8090503@craft&#45;tech.com -->
<!--X-Reference: Pine.LNX.4.58.0702281503530.4587@tux64.llnl.gov -->
<!--X-Head-End-->
<html>
<head>
<title>Re: [sundials-users] Re: CVODES Question</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00893.html">Date Prev</a>] [<a href="msg00895.html">Date Next</a>] [<a href="msg00892.html">Thread Prev</a>] [<a href="msg00909.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00894">Date Index</a></b>]
[<b><a href="threads.html#00894">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sundials-users] Re: CVODES Question</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Radu Serban &lt;<a href="mailto:radu%40llnl.gov">radu@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Wed, 28 Feb 2007 18:09:57 -0800</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<tt>Alan Hindmarsh wrote:
</tt><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">Hi William,</pre><br>
<pre style="margin: 0em;">First: Please address SUNDIALS-related questions/comments to
   sundials-users@llnl.gov
That way, the whole project here can see them and have a chance to answer,
as well as the associated the user group.</pre><br>
<pre style="margin: 0em;">Yes, CVODES should have no trouble computing sensitivities w.r.t. initial
values.  But I will let Radu Serban (its author) answer more fully.</pre><br>
<pre style="margin: 0em;">-Alan H</pre><br>
<pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">On Fri, 23 Feb 2007, William Calhoon wrote:</pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">Dr. Hindmarsh,</pre><br>
<pre style="margin: 0em;">Have you tried applying CVODES to obtain solution sensitivities with
respect to problem initial conditions, i.e. when the initial condition
for the sensitivity matrix is the identity matrix?  If not, do you
anticipate that CVODES could effectively handle such a problem?  The
DDASAC code effectively handles this problem but runs slowly.  The
ODESSA sensitivity code, when applied out of the box, does not appear to
be able to handle this type of problem.  Computing the sensitivities by
difference quotient is excessively expensive.  Do you know of any other
available codes to solve this type of problem?</pre><br>
<pre style="margin: 0em;">Thank you very much for your help.</pre><br>
<pre style="margin: 0em;">Have a good weekend,</pre><br>
<pre style="margin: 0em;">William Calhoon</pre><br>
<pre style="margin: 0em;">====================================================================</pre><br>
<pre style="margin: 0em;">William Calhoon, Ph.D.
Senior Research Scientist
Combustion Research and Flow Technology, Inc.
3313 Memorial Parkway South, Suite 108
Huntsville, AL 35801</pre><br>
<pre style="margin: 0em;">E-mail: calhoon@craft-tech.com
Phone : (256) 883-1905
FAX   : (256) 883-1967
====================================================================
</pre></blockquote><br>
</blockquote><pre style="margin: 0em;"><br>Hi William,</pre><br>
<pre style="margin: 0em;">Yes, CVODES can compute sensitivities w.r.t. initial conditions.</pre><br>
<tt>Since you ask, I assume you have noticed that the SUNDIALS distribution does not 
include any such example for forward sensitivity analysis (FSA) and for a good 
reason: as you've noticed with other codes, FSA is inefficient for such problems 
(unless the problem size is trivially small). Just out of curiosity, what is the 
dimension of your problem?</tt><br>
<br>
<tt>Indeed, computing sensitivities with respect to Np parameters using FSA implies 
solving 1+Np systems of the same size as the original problem. If the parameters 
are the IC, Np = Ny and that can quickly become prohibitively expensive. 
Therefore, expect a slow-down of roughly (1+Ny) when compared to a solution of 
the original equations!</tt><br>
<br>
<tt>Using difference quotients (DQ) to evaluate the sensitivity right-hand sides 
(RHS) may worsen things a bit more. CVODES provides 4 different DQ options which 
require 1, 2, or 4 evaluations of the original RHS for each sensitivity RHS. 
Thus the total slow-down will be (1+Ny), (1+2Ny), or (1+4Ny). In other words, 
using a forward DQ approximation basically does not add to the slow-down.</tt><br>
<br>
<tt>For FSA, alternatives to DQ for the evaluation of the sensitivity RHS are: (1) 
analytical (obvious :-), but sometimes not all that difficult to implement, 
especially when looking for sensitivities w.r.t. IC since in that case all you 
need is a function to compute Jacobian times vector; and (2) using an automatic 
differentiation tool (AD). There are many of these available; to name only a 
few: ADIC for C codes, ADOLC for C++, ADIFOR for Fortran. By the way, if I 
recall correctly, ODESSA does have AD capabilities. But again, do not expect to 
solve the efficiency issue by simply using something  else than DQ: it's 
unlikely you'll be able to improve much over forward DQ anyway, no matter how 
you evaluate the sensitivity RHS.</tt><br>
<br>
<tt>Depending on what you need the sensitivities w.r.t. IC for, the best approach 
may be to use adjoint sensitivity analysis (ASA) instead -- and CVODES can do 
that too. If you really need the whole sensitivity matrix, than ASA will not 
help you. However, if you only need the gradient of one (or a few) functionals 
of the solution of the original system with respect to its initial conditions, 
then ASA will perform incomparably better than FSA. Using CVODES, the cost of 
finding the gradient of</tt><br>
<br>
<pre style="margin: 0em;">g = g(tf,y(tf))  at a given time tf
or of
G = \int_t0^tf [ g(t,y(t)) dt ]</pre><br>
<pre style="margin: 0em;">where g is a scalar function and</pre><br>
<pre style="margin: 0em;">y' = f(t,y)
y(t0) = y0</pre><br>
<tt>is roughly 3 times the cost of solving y'=f, regardless of the parameters you 
want the gradient with respect to (including the case when those are y0). If you 
want to compute the gradient of Ng such functions, the cost will be roughly 
(2+Ng) the cost of a simulation.</tt><br>
<br>
<tt>ASA implies integrating backwards in time the so-called adjoint system. For more 
on ASA, see the CVODES documentation and references on the SUNDIALS website, as 
well as any of the CVODES adjoint sensitivity examples. Of course, ASA also has 
some difficulties. Besides those mentioned above (the fact that it is effective 
only for relatively small values of Ng and that it involves an integration 
backwards in time, the latter not a problem since CVODES will take care of that 
for you) there is the issue of generating the RHS of the adjoint system. 
Unfortunately, DQ is not an option in this case, so the adjoint RHS must be 
either derived analytically and hand-coded or else obtained with a reverse AD 
tool (and unfortunately those are not as mature as the ones for forward AD).</tt><br>
<br>
<pre style="margin: 0em;">Regards,
--Radu</pre><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00892" href="msg00892.html">[sundials-users] Re: CVODES Question</a></strong>
<ul><li><em>From:</em> Alan Hindmarsh &lt;alanh@llnl.gov&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00893.html">[sundials-users] Re: Problems when using sundialsTB toolbox</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00895.html">Re: [sundials-users] nonlinear problem</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00892.html">[sundials-users] Re: CVODES Question</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00909.html">[sundials-users] Re: Required  Function/Macro</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00894">
<strong>Main</strong></a></li>
<li><a href="threads.html#00894">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
