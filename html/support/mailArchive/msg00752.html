<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: R: [sundials&#45;users] Chemical equilibrium with limitation on the solution... -->
<!--X-From-R13: Yrvgu Sevp Uenag <xrtNyyay.tbi> -->
<!--X-Date: Fri, 27 Oct 2006 10:57:20 &#45;0700 -->
<!--X-Message-Id: 45424815.8050909@llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 002c01c6f9c9$19b4cd60$70c2fb82@VAHKIKEERAK -->
<!--X-Head-End-->
<html>
<head>
<title>Re: R: [sundials-users] Chemical equilibrium with limitation on the solution...</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00751.html">Date Prev</a>] [<a href="msg00753.html">Date Next</a>] [<a href="msg00749.html">Thread Prev</a>] [<a href="msg00763.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00752">Date Index</a></b>]
[<b><a href="threads.html#00752">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: R: [sundials-users] Chemical equilibrium with limitation on the solution...</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Keith Eric Grant &lt;<a href="mailto:keg%40llnl.gov">keg@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Fri, 27 Oct 2006 10:55:33 -0700</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
Paolo Greppi wrote:
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em">Hi Andreas and Keith, <br>
<br>
what is happening here is that for Na+ = Cl+ &lt; 6 the solid phase is not<br>
anymore stable and disappears.<br>
This is a transition to a different region of the phase space with a<br>
different variance. Some people call it a catastrophe. 
It is a catastrophe for the numerical implementation for sure, because it<br>
would require the equation / variable count to be updated etc. <br>
<br>
<pre style="margin: 0em;">We can work around this and avoid the troubles in may ways; Andreas' own
solution is OK if you write a custom solver, Keith's solution is brilliant
and also has a physical meaning.
If we rewrite:
        ln K_NaCl - ln a_Na+ - ln a_Cl- = 0
        K_NaCl = a_x * a_y / (1/b)</pre><br>
<pre style="margin: 0em;">then we can interpret 1/b as the activity of the solid, that while the
equilibium is active is assumed unitary and incorporated in the K_NaCl.
Outside the validity region of the equilibrium Keith proposes to assume a
metastable pseudo-solid in equilibrium with ions. The activity of the
metastable pseudo-solid is less than one..</pre><br>
<pre style="margin: 0em;">As such this example matches a variety of situations, if you want to see
examples of similar &quot;tweaks&quot; in the area of vapor-liquid equiliria you can
have a look at:</pre><br>
<pre style="margin: 0em;">&quot;Effective utilization of equations of state for thermodynamic properties in
process simulation&quot; (pagine 182-186) P. M. Mathias, J. F. Boston, S.
Watanasiri AIChE Journal Volume 30, Issue 2 (March 1984)</pre><br>
<pre style="margin: 0em;">Thanks you for proposing such application-oriented examples !</pre><br>
<pre style="margin: 0em;">Paolo</pre><br>
<pre style="margin: 0em;"><br>Paolo Greppi - Research Associate
Tel. +39 320 8960642
Email paolo.greppi@diam.unige.it
UNIVERSITA DEGLI STUDI DI GENOVA
Dipartimento d'Ingegneria Ambientale
Web <a  href="http://www.diam.unige.it/pert/">http://www.diam.unige.it/pert/</a>
Via all'Opera Pia, 15/a
16145 Genova (GE)
Italia</pre><br>
</blockquote><pre style="margin: 0em;"><br>Hi Paolo,</pre><br>
While it's before me again, I'll also note that there are a number of 
different numerical approaches, of which I've simply taken a &quot;good-enough&quot; 
penalty approach to keep the ratio or difference of b to one to a minimum.<br>
<br>
In &quot;Numerical Optimization&quot;, Nocedal and Wright, Chapters 12 and 17, 
describe a number of approaches to optimization problems with an inequality 
constraint. A next step from what I mentioned (simple quadratic penalty) is 
the &quot;Augmented Lagrangian Method&quot; or &quot;method of multipliers&quot;.<br>
<br>
In this way of thinking of things, the gradient of the quadratic function to 
be minimized, generates the mass balance equations. The constraint derives 
from the solubility equation, treated as an inequality. The inequality is 
transformed into an equality constraint by the inclusion of the &quot;slack 
variable&quot; b (i.e. b literally takes up the slack). The penalty is designed 
to keep 'b' inactive to the maximum extent possible.<br>
<br>
There's no particular reason, by the way, that the solubility equation has 
to be expressed in logs. As Paolo has expressed b,<br>
<br>
<pre style="margin: 0em;">K_NaCl - a_x * a_y / (1/b) = residual</pre><br>
is a valid residual expression. The difference, in terms of the Jacobian 
vector products, amounts to one of scaling.<br>
<br>
<pre style="margin: 0em;">Thanks for adding some more insight to the physical meaning of the problem.</pre><br>
<pre style="margin: 0em;">...Keith</pre><br>
<pre style="margin: 0em;"><br>--</pre><br>
<pre style="margin: 0em;"> +-----------------------------+-------------------------------------------+
 I Keith Eric Grant            I Common sense and a sense of humor are the I
 I                             I same thing, moving at different speeds.   I
 I CASC/ASD                    I A sense of humor is just common sense,    I
 I P.O. Box 808, L-103         I dancing.   ... Clive James                I
 I Lawrence Livrmr Natn'l Lab  I                                           I
 I EMail: keg@llnl.gov         I (or perhaps dancing is just common sense) I
 I FAX:   (925) 423-4908       I                                           I
 +-----------------------------+-------------------------------------------+</pre><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00749" href="msg00749.html">R: [sundials-users] Chemical equilibrium with limitation on the solution...</a></strong>
<ul><li><em>From:</em> &quot;Paolo Greppi&quot; &lt;paolo.greppi@diam.unige.it&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00751.html">Re: [sundials-users] A Question</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00753.html">Re: [sundials-users] A Question</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00749.html">R: [sundials-users] Chemical equilibrium with limitation on the solution...</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00763.html">Re: [sundials-users] Chemical equilibrium with limitation on the solution...</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00752">
<strong>Main</strong></a></li>
<li><a href="threads.html#00752">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
