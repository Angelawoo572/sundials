<!-- MHonArc v2.6.10 -->
<!--X-Subject: RE: CVODES error -->
<!--X-From-R13: "Qnb, Kv" <K.QnbNpenasvryq.np.hx> -->
<!--X-Date: Thu, 31 Mar 2005 01:27:44 &#45;0800 (PST) -->
<!--X-Message-Id: 8B8B9A8EAFB80D4783EC4EE210951B45011E50A5@ccexchange&#45;3.cns.cranfield.ac.uk -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<html>
<head>
<title>RE: CVODES error</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00025.html">Date Prev</a>] [<a href="msg00027.html">Date Next</a>] [<a href="msg00025.html">Thread Prev</a>] [<a href="msg00028.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00026">Date Index</a></b>]
[<b><a href="threads.html#00026">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>RE: CVODES error</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
&quot;Cao, Yi&quot; &lt;<a href="mailto:Y.Cao%40cranfield.ac.uk">Y.Cao@cranfield.ac.uk</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Thu, 31 Mar 2005 10:27:11 +0100</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>I have found the reason for the error. It is caused by one of
sensitivity equations, which has a term needs to be divided by a
parameter. When the parameter is zero, it causes problem, i.e. returns
one of the yScur term is -1.#IND000000000. By adding a small value,
1e-16 to that term, everything is fine. Thank you for your attention.

Yi Cao

-----Original Message-----
From: owner-sundials-users@lists.llnl.gov
[<a  href="mailto:owner-sundials-users@lists.llnl.gov">mailto:owner-sundials-users@lists.llnl.gov</a>] On Behalf Of Cao, Yi
Sent: 31 March 2005 09:37
To: sundials-users@llnl.gov
Subject: RE: CVODES error

I just did what you suggested:

1) itol=CV_SS gives the same error.
2) without sensitivity it works fine.
3) after remove call to CVodeSetSensPbar, the error is the same.

I also tried to debug the error and find the source is in
CVSensEwtSetSS. Within the loop for is, only when setting the final
ewtS, it fails. But at the moment, rtol and atol are still the same as
origin. Because I cannot see inside of N_Vector, so do not know what is
actual wrong with these ops. The code is quite simple:

static booleantype CVSensEwtSetSS(CVodeMem cv_mem, N_Vector *yScur) {
  int is;
  realtype rtoli, atoli;
  
  for (is=0; is&lt;Ns; is++) {
    rtoli = *reltolS;
    atoli = ((realtype *)abstolS)[is];
    N_VAbs(yScur[is], tempv);
    N_VScale(rtoli, tempv, tempv);
    N_VAddConst(tempv, atoli, tempv);
    if (N_VMin(tempv) &lt;= ZERO) return (FALSE);
    N_VInv(tempv, ewtS[is]);
  }
  return (TRUE);
}

If N_Vector ops are coded correctly, only thing would make tempv &lt;= 0 is
rtoli or/and atoli &lt;= 0. However, I monitored they are correct. Hence, I
guess, there are something wrong in N_Vector.

Yi Cao

-----Original Message-----
From: owner-sundials-users@lists.llnl.gov
[<a  href="mailto:owner-sundials-users@lists.llnl.gov">mailto:owner-sundials-users@lists.llnl.gov</a>] On Behalf Of Radu Serban
Sent: 31 March 2005 01:13
To: sundials-users@llnl.gov
Subject: Re: CVODES error

ewt is the weight vector for the solution vector. Depending on itol, its
components are

(1) ewt[i] = 1 / (*rtol * ABS(ycur[i]) + *atol), i=0,...,neq-1
     if itol = CV_SS
(2) ewt[i] = 1 / (*rtol * ABS(ycur[i]) + atol[i]), i=0,...,neq-1
     if itol = CV_SV

ewtS is an array of such vectors for the sensitivity variables.

The error message you see indicates that there is a component in one of
the ewtS vectors for which the denominator is nonpositive. Since you do
not specify your own sensitivity tolerances, CVODES sets the vector of
absolute tolerances for the is-th sensitivity to a multiple of the
vector of absolute tolerances for the solution variables, the scaling
factor being 1/|pbar_is|. The relative tolerance is set to be equal to
that for the solution, i.e. reltolS=1e-6.

You say that pbar is a vector of ones. So you should end up with abstolS
= 1e-8 for all sensitivities, so there should be no way for that error
to occur. Unless you have some bug in your code so that some tolerances
are overwritten. The other reason for me to suspect this, is that ewtS
is also computed and tested at the very first step (nst=0) and it seems
you did not get an error at that point -- you would have seen the
following error message: &quot;Initial ewtS has
component(s) equal to zero (illegal)&quot;.

Here are a few simple tests you can do:
1) Try itol=CV_SS (since you anyway do not have different absolute
tolerances)
2) Try to run the code without sensitivity calculations enabled.
3) Remove the call to CVodeSetSensPbar (the default is to use pbar all
ones).

Let me know what happens.

By the way, how recent is your version of CVODES?

--Radu

P.S. I did try to set a parameter to 0.0 in the cvfdx example (which is
part of the distribution) and everything worked fine just fine.



Cao, Yi wrote:
&gt;<i> I just found this is caused by some zeros in parameters. If I replace</i>
these zeros with very small number, say 1e-15, then, everything is fine.
Does CVODES not support parameters with zero values? Note, I choose
scaling vector, Pbar = 1.
&gt;<i>  </i>
&gt;<i> Yi Cao</i>
&gt;<i> </i>
&gt;<i> ________________________________</i>
&gt;<i> </i>
&gt;<i> From: owner-sundials-users@lists.llnl.gov on behalf of Cao, Yi</i>
&gt;<i> Sent: Thu 31/03/2005 00:04</i>
&gt;<i> To: sundials-users@llnl.gov</i>
&gt;<i> Subject: CVODES error</i>
&gt;<i> </i>
&gt;<i> </i>
&gt;<i> </i>
&gt;<i> Radu,</i>
&gt;<i> </i>
&gt;<i> Thank you for your reply. Here are some settings I used:</i>
&gt;<i> </i>
&gt;<i> 1. RTol = 1e-6, ATol = 1e-8. ATol is a vector but with equal values.</i>
&gt;<i> 2. plist is set to 1 to NS (in this case, 6) 3. Initial conditions for</i>

&gt;<i> sensitivity variables are [I 0], where I is</i>
unitary matrix.
&gt;<i> 4. I do not specify tol for sensitivity variables. Yes, I set pbar to</i>
1 through CVodeSetSensPbar.
&gt;<i> </i>
&gt;<i> But what is ewtS anyway? I cannot find it from the manual.</i>
&gt;<i> </i>
&gt;<i> Regards,</i>
&gt;<i> </i>
&gt;<i> Yi Cao</i>
&gt;<i> </i>
&gt;<i> ________________________________</i>
&gt;<i> </i>
&gt;<i> From: Radu Serban [<a  href="mailto:serban1@llnl.gov">mailto:serban1@llnl.gov</a>]</i>
&gt;<i> Sent: Wed 30/03/2005 20:55</i>
&gt;<i> To: Cao, Yi</i>
&gt;<i> Cc: Radu Serban</i>
&gt;<i> Subject: Re: Updated SUNDIALS web pages</i>
&gt;<i> </i>
&gt;<i> </i>
&gt;<i> </i>
&gt;<i> Dear Yi,</i>
&gt;<i> </i>
&gt;<i> Please post questions like this one on the sundials-users mailing list</i>
(to which I see you've subscribed). This way,
&gt;<i> everybody can take advantage of the information shared. Also, you may</i>
get an answer from somebody else, other than me.
&gt;<i> </i>
&gt;<i> In conclusion, please email this question to sundials-users@llnl.gov</i>
and also provide some more information:
&gt;<i> - what are the integration tolerances? Is atol a scalar or a vector?</i>
&gt;<i> - what is plist in the call to CVodeSensMalloc? Is it NULL?</i>
&gt;<i> - what are the initial conditions for the sensitivity variables? All</i>
zeros?
&gt;<i> - do you specify tolerances for the sensitivity variables or not (and</i>
leave it to CVODES to estimate them)? If yes, what
&gt;<i> are they? If not, do you set pbar through CVodeSetSensPbar? To what</i>
values?
&gt;<i> </i>
&gt;<i> --Radu</i>
&gt;<i> </i>
&gt;<i> Cao, Yi wrote:</i>
&gt;<i> </i>
&gt;<i>&gt;Dear Radu,</i>
&gt;<i>&gt;</i>
&gt;<i>&gt;I got the following error message when I run with CVODES,</i>
&gt;<i>&gt;</i>
&gt;<i>&gt;CVode-- At t = 7.98025e-011, a component of ewtS has become &lt;= 0.</i>
&gt;<i>&gt;</i>
&gt;<i>&gt;SUNDIALS_ERROR: CVode() failed with flag = -2</i>
&gt;<i>&gt;</i>
&gt;<i>&gt;Final Statistics</i>
&gt;<i>&gt;</i>
&gt;<i>&gt;nst     =     1</i>
&gt;<i>&gt;</i>
&gt;<i>&gt;nfe     =     4</i>
&gt;<i>&gt;netf    =     0    nsetups  =     1</i>
&gt;<i>&gt;nni     =     1    ncfn     =     0</i>
&gt;<i>&gt;</i>
&gt;<i>&gt;nfSe    =    24    nfeS     =     0</i>
&gt;<i>&gt;netfs   =     0    nsetupsS =     0</i>
&gt;<i>&gt;nniS    =     0    ncfnS    =     0</i>
&gt;<i>&gt;</i>
&gt;<i>&gt;njeD    =     1    nfeD     =     0</i>
&gt;<i>&gt;</i>
&gt;<i>&gt;Could you help me what is ewtS and how to avoid this error?</i>
&gt;<i>&gt;</i>
&gt;<i>&gt;Regards,</i>
&gt;<i>&gt;</i>
&gt;<i>&gt;Yi Cao</i>
&gt;<i> </i>
&gt;<i> </i>
&gt;<i> </i>
&gt;<i> --</i>
&gt;<i>     Radu Serban</i>
&gt;<i>     Center for Applied Scientific Computing   [email] radu@llnl.gov</i>
&gt;<i>     Lawrence Livermore National Laboratory    [phone] 925-424-4852</i>
&gt;<i>     P.O. Box 808, L-560                       [fax]   925-422-6287</i>
&gt;<i>     Livermore, CA 94551</i>
&gt;<i> </i>
&gt;<i> </i>
&gt;<i> </i>
&gt;<i> </i>
&gt;<i> </i>


-- 
    Radu Serban
    Center for Applied Scientific Computing   [email] radu@llnl.gov
    Lawrence Livermore National Laboratory    [phone] 925-424-4852
    P.O. Box 808, L-560                       [fax]   925-422-6287
    Livermore, CA 94551



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00025.html">RE: CVODES error</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00027.html">Re: changing dependent variable mid-run</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00025.html">RE: CVODES error</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00028.html">RE: changing dependent variable mid-run</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00026">
<strong>Main</strong></a></li>
<li><a href="threads.html#00026">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
