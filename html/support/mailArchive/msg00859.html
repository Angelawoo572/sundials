<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [sundials&#45;users] CPU&#45;Time and Output -->
<!--X-From-R13: Dnqh Ereona <enqhNyyay.tbi> -->
<!--X-Date: Wed, 31 Jan 2007 08:32:08 &#45;0800 -->
<!--X-Message-Id: 45C0C3F7.4000901@llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 3DAAD56FE208A84BAE63DF628D8C58B6DAAAF4@exchange2003.dspace.de -->
<!--X-Head-End-->
<html>
<head>
<title>Re: [sundials-users] CPU-Time and Output</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00858.html">Date Prev</a>] [<a href="msg00860.html">Date Next</a>] [<a href="msg00854.html">Thread Prev</a>] [<a href="msg00853.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00859">Date Index</a></b>]
[<b><a href="threads.html#00859">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sundials-users] CPU-Time and Output</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Radu Serban &lt;<a href="mailto:radu%40llnl.gov">radu@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Wed, 31 Jan 2007 08:29:43 -0800</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Joerg,</pre><br>
<tt>Joerg Frochte wrote:
</tt><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><tt>Hello, </tt><br>
<br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><tt>I only glanced over your code but I noticed you use the dense 
linear solver (for a Jacobian of dimension 1000x1000).
</tt></blockquote><tt><br>I assumed that the dense solver not the optimal choice, 
nevertheless I expected that runtime behaviour like this</tt><br>
<br>
<tt>CPU = C*(TimePeriot) + eps </tt><br>
<br>
<tt>eps (small) for initialisation time and C a constant. 
However, what I have seen is more like this</tt><br>
<br>
<tt>CPU = eps*(TimePeriot) + C  </tt><br>
<br>
<tt>That was a bit unexpected for me. </tt><br>
<br>
<tt>[..]
</tt></blockquote><tt><br>For many reasons, including the ones mentioned below, it's futile to try to come 
up with such a 'formula'...</tt><br>
<br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><tt>My guess is 
that you'll find that there'll be more Jacobian evaluations 
at the beginning of the simulation time.
</tt></blockquote><tt><br>Mmmm. I do not really understand the reason. 
I assumed that there is a Newton iteration in every time step. 
Why is the first step so expensive (CPU-Time)? 
Because of the initial condition calculation (see below)?
</tt></blockquote><tt><br>No it's not the initial condition calculation (if I recall correctly, you don't 
even call the IDACalcIC function as your initial conditions are already 
consistent). IDA performs Newton iterations at each time step, but the method 
used is a *modified* Newton, in the sense that the iteration matrix is fixed for 
several time steps. In the case of direct solvers, the Jacobian matrix is 
updated (and factored) when there is a significant change in the step size or if 
a 'recoverable' convergence failure occured with an out-of-date Jacobian. Since 
the step size changes most at the beginning of the simulation, you are most 
likely to see more Jacobian evaluations there.<br>
(see the &quot;IVP solution&quot; section in the IDA user guide: 
<a  href="http://www.llnl.gov/casc/sundials/documentation/ida_guide">http://www.llnl.gov/casc/sundials/documentation/ida_guide</a>)</tt><br>
<br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><tt>For the above reasons you should consider using either the 
banded linear solver or even one of the iterative linear 
solvers. If this problem is more than just a test
</tt></blockquote><tt><br>Just a little test to get an impression ;-)<br>
It is just the first thing I consider to construct a DAE problem 
with a given number of unknowns (10 , 1000; 10000 ...). </tt><br>
<br>
</blockquote><tt><br>Even (more so) for a test meant to give you &quot;an impression&quot; you should do things 
right :-) else you get the wrong impression. You should definitely try the 
banded linear solver (you don't even have to provide the Jacobian function - let 
IDA use its internal DQ approximation: it'll cost only 3 function evaluations 
for your 1D PDE semi-discretized with central differences).</tt><br>
<br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><tt>Take also a look at 
<a  href="http://www.llnl.gov/casc/sundials/support/notes.html#tout">http://www.llnl.gov/casc/sundials/support/notes.html#tout</a><br>
for a discussion on return and output times from the SUNDIALS 
integrators,
</tt></blockquote><tt><br>Thanks. That looks very interesting. </tt><br>
<br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><tt>as well as on the dense output option. You'll 
notice that, in regions where the integrator takes large 
internal steps,  getting dense output at very close times is 
quite cheap. In other words, ignoring the time spent in 
factoring the Jacobian, the run time is roughly proportional 
to the number of internal steps taken by the integrator and 
not with the number of output times (or the actual value of 
the time reached).
</tt></blockquote><pre style="margin: 0em;"><br>Yes. That is the point I did not understand...</pre><br>
<tt>How is this technique working? 
I thought IDA was doing something like this</tt><br>
<br>
<pre style="margin: 0em;">F( (y^{n+1}-y^{n}) / dt,y^{n+1},t ) = 0</pre><br>
<tt>and solves this problem in a Newton like iteration in every time step.
</tt></blockquote><pre style="margin: 0em;"><br>correct (see above)</pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><tt>For this iteration the Jacobian has to evaluate in every step. 
</tt></blockquote><pre style="margin: 0em;"><br>wrong (see above)</pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><tt>However, that seems to be wrong or is only half of the truth. 
</tt></blockquote><pre style="margin: 0em;"><br>therefore, as you guessed, it's only 1/2 the truth :-)</pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><tt>Is it the initial condition calculation that takes so much time? 
 
</tt><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><tt>(The above may not be the primary explanation in your case, 
due to your BC 
</tt></blockquote><tt><br>BC = Boundary Condition ??
</tt></blockquote><tt><br>Yes, BC=boundary condition. You force the system through the sine BC which will 
keep the step size from continuously increasing (it probably oscillates around 
some value with a 'period' similar to that of your excitation.</tt><br>
<br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><tt>which will probably keep the step size from 
increasing continuously as the simulation progresses).</tt><br>
<br>
<tt>I hope that this helps.
</tt></blockquote><pre style="margin: 0em;"><br>I see a glimpse of light... :-)</pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><tt>P.S. I didn't quite understand your question on having IDA 
run in an infinite loop. Could you please restate?
</tt></blockquote><tt><br>Lets for example consider a well posed, not that stiff problem 
and an input parameter alpha that can be changed steady by a user (GUI) 
or sensor etc. In example above the boundary condition could 
e.g. be y(0,t)=alpha. Thus, we have the problem:</tt><br>
<br>
<tt>F(d/dt y,y,t,alpha) = 0 </tt><br>
<br>
<tt>Now e.g. the program runs in an infinite loop and computes the solution<br>
y, 
display the results, while the user may changes alpha steady using a<br>
slight bar. 
I such I case (changing parameter) I assume it would be necessary to<br>
call 
IDAReInit(?) or maybe alpha could be a global variable...<br>
Nevertheless, because the &quot;output problem&quot; was just a mistake of the 
visualisation I assume that this would be no problem at all. 
</tt></blockquote><tt><br>Yes, you can certainly call the IDASolve function in an open loop, however, 
every time you change alpha you must treat the resulting discontinuity in the 
residual function properly (see 
<a  href="http://www.llnl.gov/casc/sundials/support/notes.html#disc">http://www.llnl.gov/casc/sundials/support/notes.html#disc</a>). You can 
re-initialize the solver there or by letting the integrator 'deal' with it. In 
any case, you'll probably see a 'slow-down' at every such point as IDA will end 
up using smaller step sizes.</tt><br>
<br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">Thanks a lot,</pre><br>
<pre style="margin: 0em;">Joerg</pre><br>
</blockquote><pre style="margin: 0em;"><br>--Radu</pre><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00854" href="msg00854.html">RE: [sundials-users] CPU-Time and Output</a></strong>
<ul><li><em>From:</em> &quot;Joerg Frochte&quot; &lt;JFrochte@dspace.de&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00858.html">[sundials-users] CVODE - Constraining to experimental data</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00860.html">Re: [sundials-users] Intel Compiler and other questions</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00854.html">RE: [sundials-users] CPU-Time and Output</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00853.html">Re: [sundials-users] CMake build system for SUNDIALS - Intel Compiler</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00859">
<strong>Main</strong></a></li>
<li><a href="threads.html#00859">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
