<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [sundials&#45;users] ReInit functions in sundialsTB -->
<!--X-From-R13: "Xbua I. Sngba" <wjrNorib.pur.jvfp.rqh> -->
<!--X-Date: Wed, 27 Sep 2006 11:40:32 &#45;0700 -->
<!--X-Message-Id: 17690.50486.601181.329770@segfault.lan -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 17664.30697.219776.747040@segfault.lan -->
<!--X-Reference: 450F33C0.2090509@llnl.gov -->
<!--X-Head-End-->
<html>
<head>
<title>Re: [sundials-users] ReInit functions in sundialsTB</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00707.html">Date Prev</a>] [<a href="msg00709.html">Date Next</a>] [<a href="msg00694.html">Thread Prev</a>] [<a href="msg00654.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00708">Date Index</a></b>]
[<b><a href="threads.html#00708">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sundials-users] ReInit functions in sundialsTB</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
&quot;John W. Eaton&quot; &lt;<a href="mailto:jwe%40bevo.che.wisc.edu">jwe@bevo.che.wisc.edu</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Wed, 27 Sep 2006 14:38:46 -0400</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On 18-Sep-2006, Radu Serban wrote:

Thanks for the reply and the explanation of how things are currently
implemented.

| Your case however is easier to deal with, since the discontinuities occur at 
| fixed times and there are no jumps in the solution (but rather only in the 
| control function u). To integrate such a system, one can certainly set stop 
| times and reinitialize the solver at the points of discontinuity in the 
control. 
| However,  CVODES will be able to integrate forward such a system without 
having 
| to explicitly specify the points where the control is discontinuous (you will 
| see a reduction in step size and order at those points and, quite likely, 
some 
| error test failures there).

My experience has been that although there are no jumps in the
solution, if the slope of the solution is discontinuous, it is more
efficient to set stop times and reinitialize.  I always assumed this
to be the proper way to handle such cases because otherwise the solver
has to do extra work to discover where the discontinuity in the in the
slope of the solution occurs.  In addition to the extra time spent, I
also assumed that the accuracy of the solution would also be better if
stop times are set in cases like this.  I haven't done any experiments
to test these assumptions lately, so maybe they are no longer valid
with current methods.  Can you comment, or point to previous
discussions about this?

| To solve the adjoint sensitivity problem with CVODES, you will have to use 
the 
| latter approach since, with the current implementation, one cannot set stop 
| times neither for CVodeF nor for CVodeB. For those interested, here are the 
| reasons why this is not possible:

OK.  If setting stop times will help efficiency and/or accuracy of the
solution when there are known discontinuities in the input, then I
think it would be nice to have stop times implemented for CVodeF and
CVodeB.

| Returning to your problem, the solution is then to let CVODES integrate over 
| this type of discontinuities without any re-initializations, both on the 
forward 
| and backward phases. As an example, I have attached a file with the Matlab 
code 
| needed to find the gradient with respect to the control parameterization of 
the 
| solution at the final time tf=1 of the following ODE:
| y' = - y + u(t)
| y(t0) = 1
| where u is a piecewise constant control, u(t) = p_i;  t_i &lt; t &lt;= t_{i+1}, i = 
| 1,2,3,4.

Thanks for sending the example.

| P.S. The re-initialization functions in sundialsTB will be available in the 
next 
| release, but - for the reasons mentioned above - they'll be intended for 
| different uses:

OK.

Thanks,

jwe

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00653" href="msg00653.html">[sundials-users] ReInit functions in sundialsTB</a></strong>
<ul><li><em>From:</em> &quot;John W. Eaton&quot; &lt;jwe@bevo.che.wisc.edu&gt;</li></ul></li>
<li><strong><a name="00694" href="msg00694.html">Re: [sundials-users] ReInit functions in sundialsTB</a></strong>
<ul><li><em>From:</em> Radu Serban &lt;radu@llnl.gov&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00707.html">Re: [sundials-users] CVodeB and intermediate output</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00709.html">Re: Re-4: [sundials-users] performance for chemical kinetic problems</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00694.html">Re: [sundials-users] ReInit functions in sundialsTB</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00654.html">[sundials-users] Steady state solution with CVODE...</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00708">
<strong>Main</strong></a></li>
<li><a href="threads.html#00708">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
