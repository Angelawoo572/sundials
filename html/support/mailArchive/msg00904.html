<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [sundials&#45;users] Alternate linear solvers for kinsol -->
<!--X-From-R13: Dnqh Ereona <enqhNyyay.tbi> -->
<!--X-Date: Fri, 09 Mar 2007 15:45:13 &#45;0800 -->
<!--X-Message-Id: 45F1F13C.7060708@llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: e2a523940703090459o41ec762flf502f7217942bbd0@mail.gmail.com -->
<!--X-Head-End-->
<html>
<head>
<title>Re: [sundials-users] Alternate linear solvers for kinsol</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00903.html">Date Prev</a>] [<a href="msg00905.html">Date Next</a>] [<a href="msg00902.html">Thread Prev</a>] [<a href="msg00905.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00904">Date Index</a></b>]
[<b><a href="threads.html#00904">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sundials-users] Alternate linear solvers for kinsol</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Radu Serban &lt;<a href="mailto:radu%40llnl.gov">radu@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Fri, 09 Mar 2007 15:43:56 -0800</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<tt>&#xCE;&#xCF;&#xCE;&#xCE;&#xCE;&#xCE;&#xCE;&#xCE;&#xCF; &#xCE;&#xCE;&#xCE;&#xCE;&#xCE;&#xCF;&#xCE;&#xCE;&#xCF; wrote:
</tt><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">Dear all,</pre><br>
<pre style="margin: 0em;">I am trying to provide an alternate sparse linear solver for KINSOL.
The sparse solver, named PARDISO, is part of Intel's Mathematical
Kernel Library. Has anyone tried to link KINSOL with an existing
compiled library? Since initialization, preprocessing and solving of
the linear solver take place in a &quot;black box&quot; way, how should I
interface linit, lsetup, lsolve and lfree?</pre><br>
<pre style="margin: 0em;">Sincerely</pre><br>
<pre style="margin: 0em;">Vaggelis Voyiatzis</pre><br>
</blockquote><pre style="margin: 0em;"><br>Hi Vaggelis,</pre><br>
<pre style="margin: 0em;">I'm not quite sure I follow...</pre><br>
<tt>Recall that linit, lsetup, and lfree are not required! The only function that a 
linear solver module must provide is lsolve. The other 3 are optional. If linit 
or lfree are not needed, simply set the coresponding fields in the KINMem 
structure to NULL. If lsetup is not needed, set it to NULL but also set the 
field setupNonNull to FALSE (so that kinsol does not attempt to call it).</tt><br>
<br>
<tt>In other words, in an extreme case, one could provide a linear solver module 
that does all the work inside lsolve. However, for a direct linear solver (such 
as PARDISO) you'll probably want to separate the lsetup and lsolve phases so 
that you can get KINSOL to use a modified Newton method (in which the Jacobian 
evaluation and its factorization are not performed at each iteration).</tt><br>
<br>
<tt>A quick Google search for PARDISO pointed to 
<a  href="http://www.computational.unibas.ch/cs/scicomp/software/pardiso/">http://www.computational.unibas.ch/cs/scicomp/software/pardiso/</a>. Just scanning 
the documentation provided there (apparently the version available from Basel is 
incompatible with Intel's MKL version -- but I assume the two interfaces follow 
similar philosophies) it turns out that PARDISO does provide distinct 
initialization, factorization, solve, and free phases (by calling the same 
function with different flags).  Therefore, a possible KINSOL interface to 
PARDISO could consist of two files kinsol_pardiso.h and kinsol_pardiso.c 
sketched below.</tt><br>
<br>
<pre style="margin: 0em;">Similar interfaces could be written for the other SUNDIALS solvers.</pre><br>
<pre style="margin: 0em;">Hope that this helps,
--Radu</pre><br>
<tt>P.S. Any reason why PARDISO and not some other sparse direct linear solver? I 
plan on providing support for a sparse direct linear solver in a future SUNDIALS 
release, but I still haven't made up my mind on which one to use. It will have 
to be one with MPI support and certainly a free one :-)</tt><br>
<br>
<pre style="margin: 0em;">kinsol_pardiso.h
------------------------</pre><br>
<pre style="margin: 0em;">....</pre><br>
<pre style="margin: 0em;">/* prototype of user-callable function to attach PARDISO to KINSOL */
int KINPardiso(void *kinmem, int N);</pre><br>
<pre style="margin: 0em;">....</pre><br>
<pre style="margin: 0em;"><br>kinsol_pardiso.c
------------------------</pre><br>
<pre style="margin: 0em;">#include &lt;kinsol/kinsol_pardiso.h&gt;
#include &quot;kinsol_impl.h&quot;
/* Whatever else is needed */</pre><br>
<pre style="margin: 0em;"><br>static int kinPardisoInit(KINMem kin_mem);
static int kinPardisoSetup(KINMem kin_mem);
static int kinPardisoSolve(KINMem kin_mem, N_Vector x, N_Vector b,
                 realtype *res_norm);
static void kinPardisoFree(KINMem kin_mem);</pre><br>
<pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">int KINPardiso(void *kinmem, int N)
{
...</pre><br>
<pre style="margin: 0em;">kin_mem = (KINMem) kinmem;</pre><br>
<pre style="margin: 0em;">....</pre><br>
<pre style="margin: 0em;">kin_mem-&gt;kin_linit  = kinPardisoInit;
kin_mem-&gt;kin_lsetup = kinPardisoSetup;
kin_mem-&gt;kin_lsolve = kinPardisoSolve;
kin_mem-&gt;kin_lfree  = kinPardisoFree;</pre><br>
<pre style="margin: 0em;">kin_mem-&gt;kin_setupNonNull = TRUE;</pre><br>
<pre style="margin: 0em;">....</pre><br>
<pre style="margin: 0em;">/* Create a kinpardiso_mem structure to hold counters
 * and/or other workspace needed to evaluate the sparse
 * Jacobian, and attach it to kin_mem-&gt;kin_lmem  */</pre><br>
<pre style="margin: 0em;"> ...</pre><br>
<pre style="margin: 0em;">}</pre><br>
<pre style="margin: 0em;">static int kinPardisoInit(KINMem kin_mem)
{
int flag = 0;
...
/* Initialize counters */</pre><br>
<pre style="margin: 0em;">/* call pardisoinit */</pre><br>
<pre style="margin: 0em;">/* call pardiso with phase=11 for fill-reduction analysis
 * (probably only if you can provide the sparsity Jacobian pattern
 * at this point. Otherwise you may have to call it with phase=12
 * in lsetup) */</pre><br>
<pre style="margin: 0em;">/* Set flag != 0 if an error occurs here */</pre><br>
<pre style="margin: 0em;">return(flag);
}</pre><br>
<pre style="margin: 0em;">static int kinPardisoSetup(KINMem kin_mem)
{
int flag=0;</pre><br>
<pre style="margin: 0em;">/* Evaluate Jacobian and call call pardiso with phase=22
 * to factorize the matrix. You may have to call it with phase=12
 * if the fill-reduction analysis was not done in linit)  */</pre><br>
<pre style="margin: 0em;">/* Set flag != 0 if an error occurs here */</pre><br>
<pre style="margin: 0em;">return(flag);
}</pre><br>
<tt>static int kinPardisoSolve(KINMem kin_mem, N_Vector x, N_Vector b, realtype 
*res_norm)<br>
{<br>
int flag=0;</tt><br>
<br>
<pre style="margin: 0em;">/* call pardiso with phase=33 to solve the system Jx=b */</pre><br>
<pre style="margin: 0em;">/* Set flag != 0 if an error occurs here */</pre><br>
<pre style="margin: 0em;">return(flag);
}</pre><br>
<pre style="margin: 0em;">static void kinPardisoFree(KINMem kin_mem)
{</pre><br>
<pre style="margin: 0em;">/* free any memory allocated in KINPardiso for kinpardiso_mem */</pre><br>
<pre style="margin: 0em;">/* call pardiso with phase=-1 to release all its internal memory */</pre><br>
<pre style="margin: 0em;">return;
}</pre><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00905" href="msg00905.html">Re: [sundials-users] Alternate linear solvers for kinsol</a></strong>
<ul><li><em>From:</em> Andrey Romanenko &lt;andrey@ciengis.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00902" href="msg00902.html">[sundials-users] Alternate linear solvers for kinsol</a></strong>
<ul><li><em>From:</em> &quot;&#x395;&#x3C5;&#x3AC;&#x3B3;&#x3B3;&#x3B5;&#x3BB;&#x3BF;&#x3C2; &#x392;&#x3BF;&#x3B3;&#x3B9;&#x3B1;&#x3C4;&#x3B6;&#x3AE;&#x3C2;&quot; &lt;evoyiatzis@gmail.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00903.html">[sundials-users] Two Questions - about CVODES and SundialsTB</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00905.html">Re: [sundials-users] Alternate linear solvers for kinsol</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00902.html">[sundials-users] Alternate linear solvers for kinsol</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00905.html">Re: [sundials-users] Alternate linear solvers for kinsol</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00904">
<strong>Main</strong></a></li>
<li><a href="threads.html#00904">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
