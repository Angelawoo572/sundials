<!-- MHonArc v2.6.10 -->
<!--X-Subject: RE: [sundials&#45;users] Changing algebraic variables during integration with IDA -->
<!--X-From-R13: Oyna Vvaqznefu <nynauNyyay.tbi> -->
<!--X-Date: Tue, 07 Mar 2006 15:14:42 &#45;0800 (PST) -->
<!--X-Message-Id: Pine.LNX.4.58.0603071509020.22595@tux64.llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 9719251EEFA00B4397C90260CE584496015D2F9C@nt2mail03.emn.com -->
<!--X-Head-End-->
<html>
<head>
<title>RE: [sundials-users] Changing algebraic variables during integration with IDA</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00353.html">Date Prev</a>] [<a href="msg00355.html">Date Next</a>] [<a href="msg00352.html">Thread Prev</a>] [<a href="msg00331.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00354">Date Index</a></b>]
[<b><a href="threads.html#00354">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>RE: [sundials-users] Changing algebraic variables during integration with IDA</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Alan Hindmarsh &lt;<a href="mailto:alanh%40llnl.gov">alanh@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Tue, 07 Mar 2006 15:11:13 -0800 (PST)</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>
Hello Ernie,

1. The decision on whether to restart an integrator (CVODE or IDA) on
a step change to the model depends on the size of the change and your
experience with the efficiency of the integrator in dealing with it.
If the change is small, and the solver (without a restart) gets
through it without much extra work, then keep doing it that way.  But
if the change is large enough, the extra work the solver does to get
through it will outweigh the extra overhead of the restart.  Evidently
your changes to C are such that IDA cannot get through successrully at
all, although it should if the change in C is small.

2. If A, B, and C are constants, and you simply change their values at
a time that is either preset or determined externally to the solver, that
would be an &quot;explicit&quot; change.  The &quot;implicit&quot; case would be where the
change is to occur when some condition (involving the solution) is
satisfied, in the form g(t,y) = 0 for some function g.  For that case,
you need the rootfinding feature.

3. The rootfinding feature and IDACalcIC are completely different.
Rootfinding happens during the integration, and involves checking
after every integration step to see if a given function g(t,y) has
changed sign.  (More than one such g function can be specified too.)
IDACalcIC happens only at the start, before any integration steps, and
resets y and/or yp components to make them consistent with the DAE
system F = 0 itself.  IDACalcIC makes sense when you have algebraic
variables for which consistent initial values are not obvious; it does
not make sense in the case of your model (posed as a DAE system),
because for it, given yy1 and yy2, the consistent value of the
algebraic variable yy3 is obvious.  In fact, that is the reason that
model should be solved as a pair of ODEs instead.

-Alan Hindmarsh


On Fri, 3 Mar 2006, Vogel, Ernest F - Eastman wrote:

&gt;<i> Radu,</i>
&gt;<i></i>
&gt;<i> Oops!  I've got a mistake in the equations.  They should be:</i>
&gt;<i></i>
&gt;<i> Two differential equations:</i>
&gt;<i> yp1 = A - yy3</i>
&gt;<i> yp2 = yy3 - B</i>
&gt;<i></i>
&gt;<i> One algebraic equation:</i>
&gt;<i> yy3 = C * ( yy1 - yy2 )</i>
&gt;<i></i>
&gt;<i> yy3 is the algebraic variable.  Sorry for that confusion.</i>
&gt;<i></i>
&gt;<i> I now have additional question, besides the original ones below.</i>
&gt;<i> Because yy3 can be solved for explicitly very easily in this case, is</i>
&gt;<i> there really any advantage to solving this problem as a set of DAEs as</i>
&gt;<i> opposed to a set of ODEs?</i>
&gt;<i></i>
&gt;<i> Thanks very much and again my apologies for the mistake in the</i>
&gt;<i> equations.</i>
&gt;<i></i>
&gt;<i> Ernie</i>
&gt;<i></i>
&gt;<i></i>
&gt;<i> Vogel, Ernest F - Eastman wrote:</i>
&gt;<i> &gt; Alan,</i>
&gt;<i> &gt;</i>
&gt;<i> &gt; Thank you very much for your reply.</i>
&gt;<i> &gt;</i>
&gt;<i> &gt; I'd like to offer a simple example for clarification.</i>
&gt;<i> &gt;</i>
&gt;<i> &gt; Two differential equations:</i>
&gt;<i> &gt; yp1 = A - yy2</i>
&gt;<i> &gt; yp2 = yy2 - B</i>
&gt;<i> &gt;</i>
&gt;<i> &gt; One algebraic equation:</i>
&gt;<i> &gt; yy2 = C * ( yy1 - yy2 )</i>
&gt;<i> &gt;</i>
&gt;<i> &gt; (yp is the derivative of yy.)</i>
&gt;<i> &gt;</i>
&gt;<i> &gt; I am simulating a continuous process with discrete feedback control.</i>
&gt;<i> &gt; The integrator stops at the end of each control action step (I am</i>
&gt;<i> using</i>
&gt;<i> &gt; IDASetStopTime so it doesn't overshoot).  In some cases, a controller</i>
&gt;<i> &gt; could change A or B.  In those cases, IDA seemed to handle changes to</i>
&gt;<i> A</i>
&gt;<i> &gt; and B without trouble.  In other cases, a controller could change C.</i>
&gt;<i> As</i>
&gt;<i> &gt; I expected, changes to C caused problems which I over came by calling</i>
&gt;<i> &gt; IDACalcIC whenever I changed C.</i>
&gt;<i> &gt;</i>
&gt;<i> &gt; I was not sure from your reply exactly when I should need to restart</i>
&gt;<i> the</i>
&gt;<i> &gt; solver.  It seems that changes to C should for sure require a restart,</i>
&gt;<i> &gt; but what about A and B?</i>
&gt;<i> &gt;</i>
&gt;<i> &gt; Your reply also brings up a couple more questions:</i>
&gt;<i> &gt; Would you say that in my case, changes to A, B, and C are explicit?</i>
&gt;<i> &gt; Would an implicit change likely occur at an unknown time?</i>
&gt;<i> &gt; What is the difference between the rootfinding feature and IDACalcIC?</i>
&gt;<i> &gt;</i>
&gt;<i> &gt; Once again, thanks very much for your help.</i>
&gt;<i> &gt;</i>
&gt;<i> &gt; Ernie Vogel</i>

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00340" href="msg00340.html">RE: [sundials-users] Changing algebraic variables during integration   with IDA</a></strong>
<ul><li><em>From:</em> &quot;Vogel, Ernest F - Eastman&quot; &lt;efvogel@eastman.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00353.html">Re: [sundials-users] value of t during internal steps of CVODE call</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00355.html">Re: [sundials-users] Sundials compilation error (problem with xlc/xlf?)</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00352.html">Re: [sundials-users] Changing algebraic variables during integration with IDA</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00331.html">RE: [sundials-users] sundials-users archives</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00354">
<strong>Main</strong></a></li>
<li><a href="threads.html#00354">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
