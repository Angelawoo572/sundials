<!-- MHonArc v2.6.10 -->
<!--X-Subject: [sundials&#45;users] memory leaks -->
<!--X-From-R13: Oqevna Rvrgm <nqevna.qvrgmNtznvy.pbz> -->
<!--X-Date: Tue, 21 Mar 2006 07:11:01 &#45;0800 (PST) -->
<!--X-Message-Id: 13eaacd00603210708l562e614s@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<html>
<head>
<title>[sundials-users] memory leaks</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00381.html">Date Prev</a>] [<a href="msg00383.html">Date Next</a>] [<a href="msg00376.html">Thread Prev</a>] [<a href="msg00383.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00382">Date Index</a></b>]
[<b><a href="threads.html#00382">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>[sundials-users] memory leaks</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Adrian Dietz &lt;<a href="mailto:adrian.dietz%40gmail.com">adrian.dietz@gmail.com</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Tue, 21 Mar 2006 16:08:08 +0100</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Hello, I am trying to find what is wrong in the memory management, the
problem comes from the use of CVODE because I have not problems with
the other solvers, here it is my source code concerning the CVODE
calls (very simple). this function should be called several times.
if someboby could help me ....
Many thanks...

static Model *global_pointer_this;
static void f(realtype t, N_Vector u, N_Vector udot, void *f_data);
void Model::Evolve_Artificial_CVODE(double time) {

        global_pointer_this = this;

        int a = 0;
        int flag = 0;

        long int state = this-&gt;n_states;
        N_Vector Y0 = N_VMake_Serial(state , this-&gt;States);
        N_Vector Y1 = N_VNew_Serial(state);
        void *cvode = CVodeCreate(CV_BDF, CV_FUNCTIONAL);

        double rtol = 1.e-12;
        double *atol =  new double[this-&gt;n_states];
        for(a = 0; a &lt; this-&gt;n_states; ++a) {
                atol[a] = 1.e-12;
        }
        
        void *a_tol = (void *)atol;
        flag = CVodeMalloc(cvode, f, 0., Y0, CV_SS, rtol, a_tol);
        double tret = 0.;
        flag = CVDense(cvode,state);

        flag = CVode(cvode, time, Y1, &amp;tret, CV_NORMAL);

        double *mon_Y1 = N_VGetArrayPointer_Serial(Y1);
        for(a = 0; a &lt; this-&gt;n_states; ++a) {
                this-&gt;States[a] = mon_Y1[a];
        }

        this-&gt;Compute_Outputs(this-&gt;States);
        
        N_VDestroy_Serial(Y0);
        N_VDestroy_Serial(Y1);
        CVodeFree(cvode);

        delete [] atol;
}

static void f(realtype t, N_Vector u, N_Vector udot, void *f_data) {

        double *mon_u = N_VGetArrayPointer_Serial(u);
        double *retour = global_pointer_this-&gt;Get_State_Derivatives(mon_u);
        double *le_pointeur = N_VGetArrayPointer_Serial(udot);
        int a = 0;
        int a_max = global_pointer_this-&gt;N_States();
        for(a = 0; a &lt; a_max; ++a) {
                le_pointeur[a] = retour[a];
        }
        delete [] retour;
}


--
Adrian Dietz
35 rue de Lothaire II
appartement 69
54000 Nancy
France
+33-(0)3.83.44.63.62
<a  href="http://adrian.dietz.free.fr">http://adrian.dietz.free.fr</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00384" href="msg00384.html">Re: [sundials-users] memory leaks</a></strong>
<ul><li><em>From:</em> Radu Serban &lt;serban1@llnl.gov&gt;</li></ul></li>
<li><strong><a name="00383" href="msg00383.html">Re: [sundials-users] memory leaks</a></strong>
<ul><li><em>From:</em> David Guibert &lt;David.Guibert@cdcsp.univ-lyon1.fr&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00381.html">Re: [sundials-users] Offline Manipulation of y values</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00383.html">Re: [sundials-users] memory leaks</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00376.html">[sundials-users] Offline Manipulation of y values</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00383.html">Re: [sundials-users] memory leaks</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00382">
<strong>Main</strong></a></li>
<li><a href="threads.html#00382">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
