<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [sundials&#45;users] Re: (IDACalcIC failure) -->
<!--X-From-R13: "Xbua Blr" <wbua.clrNfghqrag.hafj.rqh.nh> -->
<!--X-Date: Wed, 06 Dec 2006 19:41:12 &#45;0800 -->
<!--X-Message-Id: 1165462593.1928.279276035@webmail.messagingengine.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 1164508973.5954.277429533@webmail.messagingengine.com -->
<!--X-Reference: 4569BA60.1090107@llnl.gov -->
<!--X-Head-End-->
<html>
<head>
<title>Re: [sundials-users] Re: (IDACalcIC failure)</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00816.html">Date Prev</a>] [<a href="msg00818.html">Date Next</a>] [<a href="msg00782.html">Thread Prev</a>] [<a href="msg00821.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00817">Date Index</a></b>]
[<b><a href="threads.html#00817">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sundials-users] Re: (IDACalcIC failure)</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
&quot;John Pye&quot; &lt;<a href="mailto:john.pye%40student.unsw.edu.au">john.pye@student.unsw.edu.au</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Thu, 07 Dec 2006 14:36:33 +1100</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Hi Radu,

Thanks for your comments on this -- and sorry for my delay in
responding. What I found was happening in this case was that I was
actually plopping my derivative values into the wrong places in the
dense Jacobian matrix.

I guess that this meant that as you said, I ended up with a singular
Jacobian. Or perhaps alternatively, the wrong Jacobian caused residuals
not to decrease as they ought to, when making Newton steps?

In either case, I wonder if it might be feasible to change the error
message for this case -- since really there is no error code being
passed back from the evaluation function as the error message had been
suggesting. It should be possible from IDA output to determine whether
the code is being thrown by user-side or solver-side code, I think.

Cheers
JP

Radu Serban wrote:
&gt;<i> John Pye wrote:</i>
&gt;<i>&gt; IDA:IDACalcIC: The residual routine or the linear setup or solve routine</i>
&gt;<i>&gt; had a recoverable error, but IDACalcIC was unable to recover. (error</i>
&gt;<i>&gt; -19)</i>
&gt;<i>&gt;</i>
&gt;<i>&gt; This seems impossible! Can anyone offer any suggestions about ways in</i>
&gt;<i>&gt; which this could occur? I'm sure I must be missing something obvious</i>
&gt;<i>&gt; here.</i>
&gt;<i> Hi JP,</i>
&gt;<i></i>
&gt;<i> Since you have eliminated the case of a recoverable failure in the residual </i>
&gt;<i> function, then either the linear solver's setup function or its solve </i>
&gt;<i> function failed with a &quot;recoverable&quot; error. The solve function in the dense </i>
&gt;<i> linear solver always return &quot;success&quot;, so we can eliminate that one. There </i>
&gt;<i> are two ways for the setup function in the dense linear solver to have a </i>
&gt;<i> recoverable failure: either in evaluating the Jacobian  (but you provide the </i>
&gt;<i> Jacobian function and you say it always return 0) or in performing the LU </i>
&gt;<i> decomposition of J = dF/dy' + cj*dF/dy.</i>
&gt;<i></i>
&gt;<i> So my guess is that your djex returns a singular Jacobian. To confirm this, </i>
&gt;<i> call IDADenseGetLastFlag after IDACalcIC returns with error IDA_NO_RECOVERY = </i>
&gt;<i> -19 and to obtain the last return value from the direct linear solver. If the </i>
&gt;<i> LU decomposition fails, this value is equal to the column index (numbered </i>
&gt;<i> from one) at which a zero diagonal element was encountered during the LU </i>
&gt;<i> factorization of the dense Jacobian matrix.</i>
&gt;<i></i>
&gt;<i> If the problem size is not too large, you could try to print out the computed </i>
&gt;<i> Jacobian from within djex using the DensePrint function.</i>
&gt;<i></i>
&gt;<i> --Radu</i>
-- 
John Pye
Department of Mechanical and Manufacturing Engineering
University of New South Wales, Sydney, Australia.
john.pye AT student DOT unsw.edu.au

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00821" href="msg00821.html">Re: [sundials-users] Re: (IDACalcIC failure)</a></strong>
<ul><li><em>From:</em> Radu Serban &lt;radu@llnl.gov&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00785" href="msg00785.html">[no subject]</a></strong>
<ul><li><em>From:</em> &quot;John Pye&quot; &lt;john.pye@student.unsw.edu.au&gt;</li></ul></li>
<li><strong><a name="00782" href="msg00782.html">[sundials-users] Re: (IDACalcIC failure)</a></strong>
<ul><li><em>From:</em> Radu Serban &lt;radu@llnl.gov&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00816.html">Re: [sundials-users] Stiff ODE solution is slow?</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00818.html">[sundials-users] Building SUNDIALS on Gentoo within an ebuild</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00782.html">[sundials-users] Re: (IDACalcIC failure)</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00821.html">Re: [sundials-users] Re: (IDACalcIC failure)</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00817">
<strong>Main</strong></a></li>
<li><a href="threads.html#00817">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
