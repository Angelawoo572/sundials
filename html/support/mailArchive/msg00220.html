<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: Undefined value from CVodeGetCurrentStep -->
<!--X-From-R13: Dnqh Ereona <freona1Nyyay.tbi> -->
<!--X-Date: Tue, 17 Jan 2006 16:01:32 &#45;0800 (PST) -->
<!--X-Message-Id: 43CD830C.6020102@llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: op.s3bmu2y5t8lo91@smtp.kuleuven.ac.be -->
<!--X-Reference: 43CD2433.2080406@llnl.gov -->
<!--X-Reference: op.s3jnq9b0t8lo91@smtp.kuleuven.ac.be -->
<!--X-Reference: 200601172318.09538.andrey@enginum.com -->
<!--X-Head-End-->
<html>
<head>
<title>Re: Undefined value from CVodeGetCurrentStep</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00219.html">Date Prev</a>] [<a href="msg00221.html">Date Next</a>] [<a href="msg00219.html">Thread Prev</a>] [<a href="msg00221.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00220">Date Index</a></b>]
[<b><a href="threads.html#00220">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: Undefined value from CVodeGetCurrentStep</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Radu Serban &lt;<a href="mailto:serban1%40llnl.gov">serban1@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Tue, 17 Jan 2006 15:51:40 -0800</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
Andrey Romanenko wrote:
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">Hi!</pre><br>
Can you solve this by  turning on the root finding feature in order to stop 
the integration when the concentration hits zero?. Check out section 5.8 of 
CVODES manual.<br>
<br>
<pre style="margin: 0em;">Andrey</pre><br>
<pre style="margin: 0em;">On Tuesday 17 January 2006 22:36, Andreas Nicolai wrote:</pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">Now in order to use the same procedure in CVODE I would need the current
time step, that is actually used during the current iteration from within
the f() function, in order to correctly calculate the sink term.</pre><br>
<pre style="margin: 0em;">Any suggestions how I could obtain that value?</pre><br>
<pre style="margin: 0em;">PS: Alternatively I could use some kind of scaling function, which would
&quot;gently&quot; bend my dissolution rate towards zero if my remaining salt masses
approach zero.
</pre></blockquote><br>
</blockquote><pre style="margin: 0em;"><br>Andreas,</pre><br>
<pre style="margin: 0em;">I think Andrey's suggestion is something to consider for your particular 
problem.</pre><br>
However, getting the current step size in the user functions is legitimate, whether to do something 
like you were doing, or (as Alan Hindmarsh pointed out to me) when writing a user-provided, 
finite-difference-based Jacobian approximation function. The latter is something that our 
documentation mentions, but I had missed in my previous reply to your question...<br>
<br>
I looked again through the code and I discovered that not only next_h, the value returned by 
CVodeGetCurrentStep, is not initialized in CVodeCreate (leaving it undefined at the first f() call, 
which is made before any step size is available), but also it is not updated as frequently as it 
should be (so that it is out of date whenever the step size is changed internally while attempting 
to take a successful step - changes due to error or convergence test failures).<br>
<br>
I fixed these issues related to next_h and the next release will include the fixes. In the meantime, 
if you or someone else needs this, I could tell you how to fix the cvode.c (or cvodes.c in CVODES) 
file. For this, I'll need to know the revision number and/or date of your copy of the file (in the 
comment section at the top of the file).<br>
<br>
<pre style="margin: 0em;">--Radu</pre><br>
<pre style="margin: 0em;"><br></pre><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00221" href="msg00221.html">Re: Undefined value from CVodeGetCurrentStep</a></strong>
<ul><li><em>From:</em> Andreas Nicolai &lt;Andreas.Nicolai@gmx.net&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00215" href="msg00215.html">Undefined value from CVodeGetCurrentStep</a></strong>
<ul><li><em>From:</em> Andreas Nicolai &lt;Andreas.Nicolai@gmx.net&gt;</li></ul></li>
<li><strong><a name="00216" href="msg00216.html">Re: Undefined value from CVodeGetCurrentStep</a></strong>
<ul><li><em>From:</em> Radu Serban &lt;serban1@llnl.gov&gt;</li></ul></li>
<li><strong><a name="00218" href="msg00218.html">Re: Undefined value from CVodeGetCurrentStep</a></strong>
<ul><li><em>From:</em> Andreas Nicolai &lt;Andreas.Nicolai@gmx.net&gt;</li></ul></li>
<li><strong><a name="00219" href="msg00219.html">Re: Undefined value from CVodeGetCurrentStep</a></strong>
<ul><li><em>From:</em> Andrey Romanenko &lt;andrey@enginum.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00219.html">Re: Undefined value from CVodeGetCurrentStep</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00221.html">Re: Undefined value from CVodeGetCurrentStep</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00219.html">Re: Undefined value from CVodeGetCurrentStep</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00221.html">Re: Undefined value from CVodeGetCurrentStep</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00220">
<strong>Main</strong></a></li>
<li><a href="threads.html#00220">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
