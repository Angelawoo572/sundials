<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: changing dependent variable mid&#45;run -->
<!--X-From-R13: Dnqh Ereona <freona1Nyyay.tbi> -->
<!--X-Date: Fri, 01 Apr 2005 08:40:13 &#45;0800 (PST) -->
<!--X-Message-Id: 424D7957.1060904@llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: BAY104&#45;F28C16D48D70AA5258E098EB3380@phx.gbl -->
<!--X-Head-End-->
<html>
<head>
<title>Re: changing dependent variable mid-run</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00031.html">Date Prev</a>] [<a href="msg00033.html">Date Next</a>] [<a href="msg00029.html">Thread Prev</a>] [<a href="msg00031.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00032">Date Index</a></b>]
[<b><a href="threads.html#00032">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: changing dependent variable mid-run</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Radu Serban &lt;<a href="mailto:serban1%40llnl.gov">serban1@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Fri, 01 Apr 2005 08:39:51 -0800</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Jordan,</pre><br>
After CVodeMalloc (initialization) or CVodeReInit (re-initialization), CVODE will always start at order 1 (backward 
Euler) using either a step size provided by the user (through CVodeSetInitstep) or estimated internally. Ignoring the 
fact that in your code snippet below you use hcur before setting it (!), why would you expect the step size to change?!? 
In your code below, if you reinitialize after *every* step, obviously hcur will always be the same (equal to what CVODE 
estimated at the very first invocation of CVode()).<br>
<br>
More importantly, why would you reinitialize CVODE after every step? We put so much effort into writing a robust 
variable-order, variable-step integrator and you want to use it as a fixed-step backward Euler integrator :-(<br>
<br>
<pre style="margin: 0em;">--Radu</pre><br>
<pre style="margin: 0em;"><br></pre><br>
<tt>Jordan Atlas wrote:
</tt><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em">
Thank you Yi!  That does explain it an fix the problem --&gt; when I use an 
appropriate &quot;tout&quot; for the integration it proceeds with a positive time 
step.<br>
<br>
I have an immediately related question.  In my program, I wanted to use 
the CV_ONE_STEP mode and then reinitialize cvode after *every* time 
step.  If I do that, the time step size does not vary, even if I try to 
reinitialize and then use CVodeSetInitStep(...) for the &quot;current&quot; step 
size.<br>
<br>
Is it possible to reinitialize the integrator after every step and still 
have a time step size that varies?  I pasted some example code below again.<br>
<br>
<pre style="margin: 0em;">Thank you,
--Jordan--</pre><br>
<pre style="margin: 0em;">double tret = 0.0;
<tt>
for (int steps = 1; steps &lt; 200; steps++)
{
    flag = CVode(cvode_mem, tret+0.01, y, &amp;tret, CV_ONE_STEP);
    checkFlag(flag);</tt></pre><br>
<pre style="margin: 0em;"><tt>    //The step size is constant whether or not I include this line
    //CVodeSetInitStep(hcur);</tt></pre><br>
<tt>    flag = CVodeGetIntegratorStats(cvode_mem, &amp;nsteps, &amp;nfevals, 
&amp;nlinsetups, &amp;netfails,&amp;qlast, &amp;qcur, &amp;hinused, &amp;hlast, &amp;hcur, &amp;tcur);<br>
    checkFlag(flag);</tt><br>
<br>
<tt>    oFile &lt;&lt; tret &lt;&lt; &quot;,&quot; &lt;&lt; NV_Ith_S(y,0) &lt;&lt; &quot;,&quot; &lt;&lt; NV_Ith_S(y,1) &lt;&lt; &quot;,&quot;<br>
    &lt;&lt; nsteps &lt;&lt; &quot;,&quot; &lt;&lt; nfevals &lt;&lt; &quot;,&quot; &lt;&lt; nlinsetups &lt;&lt; &quot;,&quot; &lt;&lt; netfails 
&lt;&lt; &quot;,&quot;<br>
    &lt;&lt; qlast &lt;&lt; &quot;,&quot; &lt;&lt; qcur &lt;&lt; &quot;,&quot; &lt;&lt; hinused &lt;&lt; &quot;,&quot; &lt;&lt; hlast &lt;&lt; &quot;,&quot; &lt;&lt; 
hcur &lt;&lt; &quot;,&quot; &lt;&lt; tcur &lt;&lt; endl;</tt><br>
<br>
<tt>    if (true)<br>
    {<br>
        //In this example I'm not actuall making any changes to the 
dependent variables --- I just want to see what happens to the step size 
if I ReInit on every step<br>
        flag = CVodeReInit(cvode_mem, f, tret, y, CV_SS, &amp;reltol, &amp;abstol);<br>
        checkFlag(flag);<br>
    }<br>
}</tt><br>
<br>
<br>
</blockquote><pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">--
   Radu Serban
   Center for Applied Scientific Computing   [email] radu@llnl.gov
   Lawrence Livermore National Laboratory    [phone] 925-424-4852
   P.O. Box 808, L-560                       [fax]   925-422-6287
   Livermore, CA 94551</pre><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00029" href="msg00029.html">RE: changing dependent variable mid-run</a></strong>
<ul><li><em>From:</em> Jordan Atlas &lt;tunamaccheese@hotmail.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00031.html">Re: changing dependent variable mid-run</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00033.html">Re: Enforcing a minimum time step</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00029.html">RE: changing dependent variable mid-run</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00031.html">Re: changing dependent variable mid-run</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00032">
<strong>Main</strong></a></li>
<li><a href="threads.html#00032">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
