<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [sundials&#45;users] Integration with CVode : how to modify the intial condition during the integration ? -->
<!--X-From-R13: Dnqh Ereona <enqhNyyay.tbi> -->
<!--X-Date: Fri, 22 Sep 2006 09:34:32 &#45;0700 -->
<!--X-Message-Id: 4514108B.5060808@llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 4513F352.2010907@inria.fr -->
<!--X-Head-End-->
<html>
<head>
<title>Re: [sundials-users] Integration with CVode : how to modify the intial condition during the integration ?</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00705.html">Date Prev</a>] [<a href="msg00707.html">Date Next</a>] [<a href="msg00705.html">Thread Prev</a>] [<a href="msg00711.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00706">Date Index</a></b>]
[<b><a href="threads.html#00706">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sundials-users] Integration with CVode : how to modify the intial condition during the integration ?</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Radu Serban &lt;<a href="mailto:radu%40llnl.gov">radu@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Fri, 22 Sep 2006 09:34:19 -0700</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Pierre,</pre><br>
First of all, could you please describe exactly the problem you're trying to 
solve, in its general form? The example you give below cannot possibly be what 
you want, since, after the first output time (0.001), you basically say that 
you'd like to solve the following two ODEs:<br>
y1' = f(t, y1) , y1(0.001) = ymean<br>
y2' = f(t, y2),  y2(0.001) = ymean<br>
which will obviously mean that y1==y2 from there on.<br>
<br>
Secondly (assuming that either the two right-hand side functions are different 
or the new ICs at t1=0.001 are different, so that you don't have the trivial 
situation above) what you have is a problem with discontinuities. This has been 
discussed at length on this mailing list. Look at previous posts 
(<a  href="http://www.llnl.gov/casc/sundials/support/mailArchive/maillist.html">http://www.llnl.gov/casc/sundials/support/mailArchive/maillist.html</a>) and also 
at the note on this subject that I posted on the SUNDIALS website 
(<a  href="http://www.llnl.gov/casc/sundials/support/notes.html#disc">http://www.llnl.gov/casc/sundials/support/notes.html#disc</a>).<br>
<br>
<pre style="margin: 0em;">A couple more comments are interspersed below...</pre><br>
<pre style="margin: 0em;">--Radu</pre><br>
pommier wrote:
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em">Hello,<br>
I am a PhD student at INRIA (France) and I am using your solver CVode to 
solve my ODEs. But I have a problem :<br>
I would like to solve 2 ODes<br>
<br>
<pre style="margin: 0em;">\dot{y}_1=f(t,y_1)  y_1(0)= 2.0
\dot{y}_2=f(t,y_2)  y_2(0)= 1.0</pre><br>
for my example f(t,y) = y(t)  and I am in 1D so it is obvious that the 
exact solution is y(t)=y(0)*exp(t).  At each time step I compute the mean.<br>
<br>
<pre style="margin: 0em;">After the end of the first time step my outputs are (t1=0.001)
2.0020014128303396e+00       1.0010012408633520e+00</pre><br>
2.0 * exp(0.001) = 2.0020014128303396e+00  and 1.0 * exp(0.001) = 
1.0010012408633520e+00<br>
So the result is correct.<br>
<br>
After I compute their average  : ymean = (y1(t1)+y2(t1))/2 = 
1.5015013268468458e+00   and my new initial conditions are  y1(t1) = 
ymean and y2(t1)=ymean and I solve my ODEs until t2=0.002<br>
<br>
<pre style="margin: 0em;">The outputs are after the integration (t2 = 0.002)
2.0040045534839654e+00       1.0020035045392661e+00</pre><br>
The result is correct because 2*exp(0.002) = 2.0040045534839654e+00 and 
1.0*exp(0.002) = 1.0020035045392661e+00<br>
<br>
but my initial conditons aren't neither 2.0 nor 1.0 but ymean so the 
result is bad (in my case).<br>
<br>
</blockquote><br>So what would be the correct result in your case? What would you like to see at 
t=0.002?<br>
<br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em">A solution to solve this problem is to use the function CVodeReInit. 
Unfortunately the time of execution is very big (I have 100 systems of 
ODEs in R30)<br>
Is there a best solution ? How does CVodeMalloc store the initial 
conditions in its memory ? It is faster to change only the initial 
conditions rather re-initialise the memory isn't it ?<br>
I'm using the latest version of CVode (2.4.0). I would like to change 
only the initial condition, not the others parameters. Is it possible ?<br>
<br>
</blockquote><br>As their name implies, initial conditions are used only at the initial time. It 
does not make sense to discuss about &quot;modifying initial conditions during the 
integration&quot;.<br>
<br>
You also seem to be confused by the fact that it is possible to use the same 
vector y both in CVodeMalloc and in CVode. You could simply use two different 
vectors, call them y0 and y, in which case you could just destroy y0 after the 
call to CVodeMalloc (which would make it clear that what you ask in the subject 
is not possible). Moreover, the argument y of CVode is only an output, so any 
modifications to it that you make to it after a return from CVode will not be 
seen by the integrator (because you're actually not even supposed to change the 
solution vector outside the integrator). If you do want to add a jump 
(discontinuity) to the solution of the ODE, then you basically have a new IVP 
(initial value problem) from that point on and you should just treat it as such 
and reinitialize the solver.<br>
<br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em">I send you my program for the example. There is a Makefile. The name of 
the executable file is &quot; out &quot;<br>
make<br>
./out<br>
<br>
<pre style="margin: 0em;">Thank you very much for your attention.
Pierre-Lin Pommier
</pre></blockquote><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00705" href="msg00705.html">[sundials-users] Integration with CVode : how to modify the intial condition during the integration ?</a></strong>
<ul><li><em>From:</em> pommier &lt;pierre-lin.pommier@inria.fr&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00705.html">[sundials-users] Integration with CVode : how to modify the intial condition during the integration ?</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00707.html">Re: [sundials-users] CVodeB and intermediate output</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00705.html">[sundials-users] Integration with CVode : how to modify the intial condition during the integration ?</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00711.html">[sundials-users] Re: large stiff ODE system</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00706">
<strong>Main</strong></a></li>
<li><a href="threads.html#00706">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
