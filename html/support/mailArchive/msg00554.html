<!-- MHonArc v2.6.10 -->
<!--X-Subject: [sundials&#45;users] Bizarre crashes in Sundials DLL -->
<!--X-From-R13: "Qnlyr Euneebpx" <pnlyrNpurzrat.hpg.np.mn> -->
<!--X-Date: Wed, 28 Jun 2006 04:10:06 &#45;0700 -->
<!--X-Message-Id: 20060628110638.2B13D405C@munch.che.uct.ac.za -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<html>
<head>
<title>[sundials-users] Bizarre crashes in Sundials DLL</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00553.html">Date Prev</a>] [<a href="msg00555.html">Date Next</a>] [<a href="msg00545.html">Thread Prev</a>] [<a href="msg00558.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00554">Date Index</a></b>]
[<b><a href="threads.html#00554">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>[sundials-users] Bizarre crashes in Sundials DLL</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
&quot;Cayle Sharrock&quot; &lt;<a href="mailto:cayle%40chemeng.uct.ac.za">cayle@chemeng.uct.ac.za</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Wed, 28 Jun 2006 13:06:29 +0200</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Hi,

I'm putting together a suite of modelling tools in Delphi. My overall
strategy is to use numerical codes from various sources (Fortran, C, Delphi
etc.) compile them into DLLs and then create a consistent object layer from
Delphi to access the various routines. 

However, I'm having trouble getting this together with the Sundials codes.
What I've done so far is:
 * Compiled and succesfully run the demo programs supplied with CVODE for
serial processors. I used Dev-Cpp with GCC ver 2.95. All the results were
identical or close to the supplied outputs.
 * Compiled and built a Windows DLL of the CVODE code with the Serial vector
option.
 * Rewrote cvdenx in Delphi as a console application.
 
I believe that I've sorted out all the issues regarding type conversions
between the two languages; the program runs and calls the Delphi F,G, and
Jac junctions (so the DLL functions are being called and work correctly to a
point). In addition, cvODECreate, CVodeMalloc, CVodeRootInit, CVDense,
CVDenseSetJacFn all return cvSUCCESS and on inspection, all memory seems to
be allocated correctly. 

The problem is that the DLL crashes at the exit point of one of the internal
procedures (CVDenseSetup). The calling stack at this point is:
  CVDenseSetup (aliased as lsetup)
  CVNlsNewton
  CVNls
  CVStep 
  CVODE
CVDenseSetup crashes at the line &quot;return (0)&quot; with an Eprivileged
instruction exception.
So it doesn't seem to be an issue with the Delphi/DLL interface at all, but
something internal to the DLL. It must be the DLL because the example
problem (cvdenx) compiled and ran with no problems using the same compiler
(i.e. no DLL created).
And here's another weird thing: If I change the compiler options (most
notably generating code for say i486 or SSE 2), the code crashes at a
different (earlier) point.

I have very little C / C++ experience and have been banging my head against
a wall for days now. If anyone can shed some light on the problem, I'd be
very grateful.

If you'd like more details (PE info on the DLL, source code etc.) let me
know; I wanted to keep this post reasonably short.

Thanks in advance,
Cayle

-----------------------------------------------------------------
Cayle Sharrock
Senior Process Engineer
Sasol Technology R&amp;D/ University of Cape Town
 
email: cayle@chemeng.uct.ac.za
 


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00558" href="msg00558.html">RE: [sundials-users] Bizarre crashes in Sundials DLL</a></strong>
<ul><li><em>From:</em> &quot;Cayle Sharrock&quot; &lt;cayle@chemeng.uct.ac.za&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00553.html">Re: [sundials-users] Problems with IDACalcIC()</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00555.html">[sundials-users] Re: problem in running the parallel fortran example</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00545.html">[sundials-users] Problems with IDACalcIC()</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00558.html">RE: [sundials-users] Bizarre crashes in Sundials DLL</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00554">
<strong>Main</strong></a></li>
<li><a href="threads.html#00554">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
