<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [sundials&#45;users] Installing/checking sundials 2.1.1 -->
<!--X-From-R13: Quevfgbf Tebhmnxvf <puevfgbf.sebhmnxvfNtznvy.pbz> -->
<!--X-Date: Tue, 07 Mar 2006 07:44:28 &#45;0800 (PST) -->
<!--X-Message-Id: 4ba776c00603070740y6cb1d4dag3bdafc6545081268@mail.gmail.com -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: 4ba776c00603010317l2821e22w39fcdc18ca460816@mail.gmail.com -->
<!--X-Reference: 44062C4D.7030904@llnl.gov -->
<!--X-Head-End-->
<html>
<head>
<title>Re: [sundials-users] Installing/checking sundials 2.1.1</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00349.html">Date Prev</a>] [<a href="msg00351.html">Date Next</a>] [<a href="msg00329.html">Thread Prev</a>] [<a href="msg00351.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00350">Date Index</a></b>]
[<b><a href="threads.html#00350">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sundials-users] Installing/checking sundials 2.1.1</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Christos Frouzakis &lt;<a href="mailto:christos.frouzakis%40gmail.com">christos.frouzakis@gmail.com</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Tue, 07 Mar 2006 16:40:54 +0100</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
Hi Radu,<br><br>thank you for the suggestions. Indeed setting -with-mpi*=no, solved the problem with the MPI libraries and include files. The linking issue will have to wait for the next release,&nbsp; for now&nbsp; I just edit the makefiles by hand.
<br><br>As before, the compilation goes through without complaints, but for some solvers the output from the examples does not compare well with the output provided. I'm particularly interested in cvode, and more specifically for mixed fortran/C codes (fcmix). As an example, the output of cvbandf is as follows
<br><br>Band example problem:<br><br>&nbsp;Advection-diffusion, NEQ = 50<br><br><br>&nbsp;At t =&nbsp;&nbsp; 0.00&nbsp; max.norm(u) =&nbsp;&nbsp; 0.895472E+02<br>&nbsp;At t =&nbsp;&nbsp; 0.10&nbsp; max.norm(u) =&nbsp;&nbsp; 0.895472E+02&nbsp; NST =&nbsp;&nbsp; 85<br>&nbsp;At t =&nbsp;&nbsp; 0.20&nbsp; max.norm(u) =&nbsp;&nbsp; 0.895472E+02
&nbsp; NST =&nbsp; 103<br>&nbsp;At t =&nbsp;&nbsp; 0.30&nbsp; max.norm(u) =&nbsp;&nbsp; 0.895472E+02&nbsp; NST =&nbsp; 113<br>&nbsp;At t =&nbsp;&nbsp; 0.40&nbsp; max.norm(u) =&nbsp;&nbsp; 0.895472E+02&nbsp; NST =&nbsp; 120<br>&nbsp;At t =&nbsp;&nbsp; 0.50&nbsp; max.norm(u) =&nbsp;&nbsp; 0.895472E+02&nbsp; NST =&nbsp; 126<br>&nbsp;At t =&nbsp;&nbsp; 0.60&nbsp; max.norm(u) =&nbsp;&nbsp; 
0.895472E+02&nbsp; NST =&nbsp; 130<br>&nbsp;At t =&nbsp;&nbsp; 0.70&nbsp; max.norm(u) =&nbsp;&nbsp; 0.895472E+02&nbsp; NST =&nbsp; 134<br>&nbsp;At t =&nbsp;&nbsp; 0.80&nbsp; max.norm(u) =&nbsp;&nbsp; 0.895472E+02&nbsp; NST =&nbsp; 137<br>&nbsp;At t =&nbsp;&nbsp; 0.90&nbsp; max.norm(u) =&nbsp;&nbsp; 0.895472E+02&nbsp; NST =&nbsp; 140<br>&nbsp;At t =&nbsp;&nbsp; 1.00
&nbsp; max.norm(u) =&nbsp;&nbsp; 0.895472E+02&nbsp; NST =&nbsp; 142<br><br><br>Final statistics:<br><br>&nbsp;No. steps =&nbsp; 142&nbsp; No. f-s =&nbsp; 173&nbsp; No. J-s =&nbsp;&nbsp;&nbsp; 3&nbsp;&nbsp; No. LU-s =&nbsp;&nbsp; 23<br>&nbsp;No. nonlinear iterations =&nbsp; 170<br>&nbsp;No. nonlinear convergence failures =&nbsp;&nbsp;&nbsp; 0
<br>&nbsp;No. error test failures =&nbsp;&nbsp;&nbsp; 3<br><br>The solution remains unchanged from the initial condition, although, for this case, the final statistics match the provided output. The rest of the examples show similar behavior (solution=initial condition).
<br><br>The compiler does not make a difference (I've tried with gcc/g77 and pgcc/pgf77. <br><br>Any suggestions before diving in the code(s) with the debugger?<br><br>-Christos.<br><br><div><span class="gmail_quote">On 3/2/06, 
<b class="gmail_sendername">Radu Serban</b> &lt;<a href="mailto:serban1@llnl.gov">serban1@llnl.gov</a>&gt; wrote:</span><blockquote class="gmail_quote" style="border-left: 1px solid rgb(204, 204, 204); margin: 0pt 0pt 0pt 0.8ex; padding-left: 1ex;">
Hi Christos,<br><br>Christos Frouzakis wrote:<br>&gt; I am trying to install sundials on an Opteron cluster with Quadrics<br>&gt; interconnect using the Portland group compilers.<br>&gt; As there are no Quadrics MPI wrappers for the PGI compiles, I had to
<br>&gt; explicitly define the paths for the include files and libraries. The<br>&gt; configuration was done with the command<br>&gt;<br>&gt; ./configure CC=pgcc CFLAGS=-fast F77=pgf77 FFLAGS=-fast<br>&gt; --with-mpicc=pgcc --with-mpif77=pgf77
<br>&gt; --with-mpi-incdir=/usr/lib/mpi/include<br>&gt; --with-mpi-libdir=/usr/lib/mpi/lib --with-mpi-libs=&quot;-lmpifarg -lmpi<br>&gt; -lelan -g77libs&quot; --with-libs=-lg2c<br>&gt;<br>&gt; The configuration script did not correctly set the mpi include and
<br>&gt; library paths, so the corresponding makefiles were corrected by hand.<br><br>In the release version, if you want to manually specify the MPI include and lib directories, you need to set --with-mpicc=no and<br>--with-mpif77=no, in which case configure will try to link MPI programs with the C and Fortran compilers and using the MPI flags you specify
<br>(include and lib dir, MPI flags and libraries).<br><br>With your current configure line, the script assumes you are using an MPI script/wrapper which would internally set the appropriate MPI<br>include and lib directories. However, to make sure we do not get errors in the Makefiles (&quot;empty&quot; -I flags), if an mpicc script is used, we
<br>just set MPI_INC_DIR and MPI_LIB_DIR based on the location of mpicc (overwriting any user-specified MPI locations).<br><br>This is the reason why you see the &quot;wrong&quot; MPI_INCDIR and MPI_LIBDIR paths in the generated Makefiles. Since you specified
<br>--with-mpicc=pgcc, they are path_to_pgcc/../include and path_to_pgcc/../lib, respectively. Correct?<br><br>This issue has been resolved for the next release (see step 1b below).<br><br>&gt; The code compiled without any problems, warnings, or errors.
<br>&gt;<br>&gt; In order to compile the examples, the linker had to be changed from CC<br>&gt; to F77, but then everything went smoothly.<br><br>Indeed, in the release version, CC and MPICC are used to link the serial and parallel Fortran examples, respectively. This has been changed
<br>for the next release (see step 4 below)<br><br>&gt; Unfortunately, when I run the examples I get completely wrong results<br>&gt; (in comparison to the corresponding *.out files).<br>&gt; After a day of trying with compiler flags and modification of makefiles,
<br>&gt; I ran out of ideas ... Any suggestions?<br>&gt;<br><br>Which examples are you referring to (all of them?) and what do you mean by 'completely wrong'? It is OK (actually quite likely) to get<br>slightly different results (by this I mean within the specified tolerances) on different platforms and using different compilers, especially
<br>when using any optimization flags (the pgcc/pgf77 -fast flag will turn on level 2 optimization).<br><br>&gt; Best,<br>&gt;<br>&gt; -Christos Frouzakis<br><br><br>Here's an overview of the MPI-related logic implemented in the SUNDIALS configure script.
<br>I refer here on the current development version which may be slightly different than what is in the released version, but I'd like to open<br>this up for discussion in anticipation of the next release.<br><br>C MPI Tests
<br>-----------<br><br>The default behavior is to look for MPI compilation scripts/wrappers (mpicc or similar) which will automatically take care of passing the<br>appropriate -I, -L, and -l options required by the MPI program. To overwrite the default behavior, you MUST specify --with-mpicc=no
<br><br>1) If --with-mpicc is not specified, we assume MPICC=mpicc. If it is specified to something other than 'no' we use that script name as MPICC.<br><br>Next, we test if MPICC exists as a file (we cannot reliably test if it is executable since the '-x' test flag is not portable). If it cannot
<br>be found, we look into the user's path for it, or we try to use the MPI root directory (if specified).<br><br>a) If we still cannot find it, we give up MPI checking.<br>b) If we can find it, we just set MPICC and then, ONLY if MPI_INC_DIR and/or MPI_LIB_DIR are empty, to resolve potential Makefile problems,
<br>we set them to basedir/../include and basedir/../lib, respectively (where basedir is the directory portion of the full pathname of MPICC)<br><br>2) If the configure line contains --with-mpicc=no then we attempt to link MPI programs with the C compiler (optionally specified through CC)
<br>and using the MPI include and lib directories and the MPI libraries provided by the user. The logic in this case is as follows:<br><br>a) Search for an MPI implementation<br>if --with-mpi-incdir is specified, use it as MPI_INCDIR.
<br>else if --with-mpi-root is specified, use it to set MPI_INCDIR by appending /include<br>else give up MPI checking<br><br>b) Search for MPI libraries<br>if --with-mpi-libdir is specified, use it as MPI_LIBDIR<br>else use MPI root directory to set MPI_LIBDIR by appending /lib
<br><br>c) Check for the MPI libraries<br>if --with-mpi-libs is not specified give up MPI checking<br>else we try to link a test program<br><br>In this case, MPICC is the same as CC.<br><br>Fortran MPI Tests<br>-----------------
<br><br>If MPI Fortran is needed (based on which, if any, SUNDIALS modules are disabled, on whether Fortran support is enabled/disabled, on whether<br>a working serial Fortran compiler was found previously, etc) we perform similar tests to the above ones.
<br><br>In addition, the build system performs the following two tests:<br><br>3) Determine if MPI_Comm_f2c() from MPI-2 is supported so that communicators other than MPI_COMM_WORLD can be used in parallel Fortran programs
<br><br>4) Determine what should be used to link parallel Fortran examples<br><br>If the MPICC wrapper or compiler (depending on steps 1 and 2 above) is NOT a C++ compiler then use MPIF77 to link.<br>Else, we test if MPICC can link a Fortran parallel example. If yes, we will use MPICC to link. If not, we will use MPIF77 to link.
<br><br><br>--Radu<br><br>--<br>&nbsp;&nbsp;&nbsp;&nbsp;Radu Serban<br>&nbsp;&nbsp;&nbsp;&nbsp;Center for Applied Scientific Computing&nbsp;&nbsp; [email] <a href="mailto:radu@llnl.gov">radu@llnl.gov</a><br>&nbsp;&nbsp;&nbsp;&nbsp;Lawrence Livermore National Laboratory&nbsp;&nbsp;&nbsp;&nbsp;[phone] 925-424-4852
<br>&nbsp;&nbsp;&nbsp;&nbsp;P.O. Box 808, L-560&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [fax]&nbsp;&nbsp; 925-422-6287<br>&nbsp;&nbsp;&nbsp;&nbsp;Livermore, CA 94551<br></blockquote></div><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00351" href="msg00351.html">Re: [sundials-users] Installing/checking sundials 2.1.1</a></strong>
<ul><li><em>From:</em> Radu Serban &lt;serban1@llnl.gov&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00325" href="msg00325.html">[sundials-users] Installing/checking sundials 2.1.1</a></strong>
<ul><li><em>From:</em> Christos Frouzakis &lt;christos.frouzakis@gmail.com&gt;</li></ul></li>
<li><strong><a name="00329" href="msg00329.html">Re: [sundials-users] Installing/checking sundials 2.1.1</a></strong>
<ul><li><em>From:</em> Radu Serban &lt;serban1@llnl.gov&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00349.html">Re: [sundials-users] Sundials compilation error (problem with xlc/xlf?)</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00351.html">Re: [sundials-users] Installing/checking sundials 2.1.1</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00329.html">Re: [sundials-users] Installing/checking sundials 2.1.1</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00351.html">Re: [sundials-users] Installing/checking sundials 2.1.1</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00350">
<strong>Main</strong></a></li>
<li><a href="threads.html#00350">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
