<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [sundials&#45;users] Re: (IDACalcIC failure) -->
<!--X-From-R13: Dnqh Ereona <enqhNyyay.tbi> -->
<!--X-Date: Mon, 11 Dec 2006 11:03:22 &#45;0800 -->
<!--X-Message-Id: 457DAB33.7050602@llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 1164508973.5954.277429533@webmail.messagingengine.com -->
<!--X-Reference: 4569BA60.1090107@llnl.gov -->
<!--X-Reference: 1165462593.1928.279276035@webmail.messagingengine.com -->
<!--X-Head-End-->
<html>
<head>
<title>Re: [sundials-users] Re: (IDACalcIC failure)</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00820.html">Date Prev</a>] [<a href="msg00822.html">Date Next</a>] [<a href="msg00817.html">Thread Prev</a>] [<a href="msg00784.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00821">Date Index</a></b>]
[<b><a href="threads.html#00821">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sundials-users] Re: (IDACalcIC failure)</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Radu Serban &lt;<a href="mailto:radu%40llnl.gov">radu@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Mon, 11 Dec 2006 11:02:11 -0800</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi John,</pre><br>
<tt>John Pye wrote:
</tt><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">Hi Radu,</pre><br>
<pre style="margin: 0em;">Thanks for your comments on this -- and sorry for my delay in
responding. What I found was happening in this case was that I was
actually plopping my derivative values into the wrong places in the
dense Jacobian matrix.</pre><br>
<pre style="margin: 0em;">I guess that this meant that as you said, I ended up with a singular
Jacobian. Or perhaps alternatively, the wrong Jacobian caused residuals
not to decrease as they ought to, when making Newton steps?</pre><br>
<pre style="margin: 0em;">In either case, I wonder if it might be feasible to change the error
message for this case -- since really there is no error code being
passed back from the evaluation function as the error message had been
suggesting. It should be possible from IDA output to determine whether
the code is being thrown by user-side or solver-side code, I think.</pre><br>
</blockquote><tt><br>The error message correctly indicated that there was a problem in the rhs 
function OR linear solve function OR linear setup function (the last one in this 
case).</tt><br>
<br>
<tt>We could be more specific only to some (small) extent. Because IDA links to a 
linear solver through a generic interface (so that one can attach a new linear 
solver module besides those provided within SUNDIALS), we only intercept 3 types 
of return values from any linear solver interface function (0 for success, 
negative for unrecoverable failure, positive for recoverable error). Each linear 
solver is free to decide when any of these three values is returned. For the 
dense linear solver, only its setup function can fail recoverably (if it 
encounters a zero pivot while decomposing the Jacobian matrix). This is why the 
linear solvers provided with SUNDIALS offer a ***GetLastFlag function which can 
be queried to get more details if an error occurred.  Had you called the 
function IDADenseGetLastFlag (as I suggested) you'd have obtained a positive 
number representing the iteration at which the LU factorization encountered a 
zero pivot (indicating a singular Jacobian and hence a problem in the Jacobian 
function).</tt><br>
<br>
<tt>My point is, all we could potentially do is have three different failure codes 
instead of the single IDA_NO_RECOVERY (-19). But that would unnecessarily 
increase the list of all possible IDA return flags, without providing much more 
information. Indeed, as you've seen in my previous post, a simple &quot;forensic&quot; 
analysis can exactly point to the problem if such a failure occurs.</tt><br>
<br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">Cheers
JP</pre><br>
</blockquote><pre style="margin: 0em;"><br>Regards,
--Radu</pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><tt>Radu Serban wrote:
</tt><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><tt>John Pye wrote:
</tt><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">IDA:IDACalcIC: The residual routine or the linear setup or solve routine
had a recoverable error, but IDACalcIC was unable to recover. (error
-19)</pre><br>
<pre style="margin: 0em;">This seems impossible! Can anyone offer any suggestions about ways in
which this could occur? I'm sure I must be missing something obvious
here.
</pre></blockquote><pre style="margin: 0em;">Hi JP,</pre><br>
<pre style="margin: 0em;">Since you have eliminated the case of a recoverable failure in the residual function, then either 
the linear solver's setup function or its solve function failed with a &quot;recoverable&quot; 
error. The solve function in the dense linear solver always return &quot;success&quot;, so we can 
eliminate that one. There are two ways for the setup function in the dense linear solver to have a 
recoverable failure: either in evaluating the Jacobian  (but you provide the Jacobian function and 
you say it always return 0) or in performing the LU decomposition of J = dF/dy' + cj*dF/dy.</pre><br>
<pre style="margin: 0em;">So my guess is that your djex returns a singular Jacobian. To confirm this, 
call IDADenseGetLastFlag after IDACalcIC returns with error IDA_NO_RECOVERY = 
-19 and to obtain the last return value from the direct linear solver. If the 
LU decomposition fails, this value is equal to the column index (numbered from 
one) at which a zero diagonal element was encountered during the LU 
factorization of the dense Jacobian matrix.</pre><br>
<pre style="margin: 0em;">If the problem size is not too large, you could try to print out the computed 
Jacobian from within djex using the DensePrint function.</pre><br>
<tt>--Radu
</tt></blockquote></blockquote><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00785" href="msg00785.html">[no subject]</a></strong>
<ul><li><em>From:</em> &quot;John Pye&quot; &lt;john.pye@student.unsw.edu.au&gt;</li></ul></li>
<li><strong><a name="00782" href="msg00782.html">[sundials-users] Re: (IDACalcIC failure)</a></strong>
<ul><li><em>From:</em> Radu Serban &lt;radu@llnl.gov&gt;</li></ul></li>
<li><strong><a name="00817" href="msg00817.html">Re: [sundials-users] Re: (IDACalcIC failure)</a></strong>
<ul><li><em>From:</em> &quot;John Pye&quot; &lt;john.pye@student.unsw.edu.au&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00820.html">Re: [sundials-users] Compliment + Question</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00822.html">Re: [sundials-users] Building SUNDIALS on Gentoo within an ebuild</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00817.html">Re: [sundials-users] Re: (IDACalcIC failure)</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00784.html">[sundials-users] Adapting to stiff and non-stiff ODEs</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00821">
<strong>Main</strong></a></li>
<li><a href="threads.html#00821">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
