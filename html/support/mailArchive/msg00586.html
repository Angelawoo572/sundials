<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [sundials&#45;users] custom linear solvers for cvodes, and ida -->
<!--X-From-R13: Jhrqbat Lunat <mkqNoh.rqh> -->
<!--X-Date: Fri, 21 Jul 2006 07:37:01 &#45;0700 -->
<!--X-Message-Id: Pine.A41.4.63.0607211020470.116112@acsrs3.bu.edu -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 44B6786F.5050906@mit.edu -->
<!--X-Reference: 44BC0C4E.6040603@llnl.gov -->
<!--X-Reference: 20060718170219.230zrhhoys8g0w8o@www.bu.edu -->
<!--X-Reference: Pine.LNX.4.58.0607181711210.27337@tux64.llnl.gov -->
<!--X-Head-End-->
<html>
<head>
<title>Re: [sundials-users] custom linear solvers for cvodes, and ida</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00585.html">Date Prev</a>] [<a href="msg00587.html">Date Next</a>] [<a href="msg00583.html">Thread Prev</a>] [<a href="msg00584.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00586">Date Index</a></b>]
[<b><a href="threads.html#00586">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sundials-users] custom linear solvers for cvodes, and ida</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Xuedong Zhang &lt;<a href="mailto:zxd%40bu.edu">zxd@bu.edu</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Fri, 21 Jul 2006 10:32:55 -0400 (EDT)</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi, Alan and Radu:</pre><br>
  First thank you guys so much for providing such an excellent software 
online. and also I really appreciate Alan to detail the guidance of using 
sundials with specific problems.<br>
<br>
  I agree that a specific solver for second order problem maybe not 
suitable for sundials, architecture wise. And essentially for the second 
order problem, it just need to re-use the existing solver modules 
(solver A{-1} for example) in most cases.<br>
For the iterative method, there is more trouble (maybe) than benefit 
because we need consider the errors, and when to stop iteration etc.<br>
<br>
  Anyway, I have some question related to my problem and how to use 
sundials, to make it clear, I will send it in a seperate email.<br>
<br>
<pre style="margin: 0em;">Thanks
Xuedong</pre><br>
<pre style="margin: 0em;">On Tue, 18 Jul 2006, Alan Hindmarsh wrote:</pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">Hello Xuedong,</pre><br>
<pre style="margin: 0em;">To elaborate a little on Radu's reply:</pre><br>
<pre style="margin: 0em;">First, if your problem is really y'' = f(y,y',t), it is not an IDA
problem.  It becomes a CVODE problem by defining the vector
z = (y,y').  It is inefficient to use a DAE solver for an ODE system.
However, if your problem is Ay'' = f with a nontrivial matrix A, then
IDA may be the better choice, depending on the complexity of A.
CVODE is still a candidate, with A^{-1}f being evaluated every time
the right-hand side is called for, if you can find an efficient way of
computing that.  If A is constant and not too large, probably a dense
or banded LU treatment is best.</pre><br>
<pre style="margin: 0em;">Second, there are a few solvers available that treat such a second
order ODE system directly (not as a first-order system).  But they
are very few.  If you can find one, try it and compare with the
CVODE or IDA solution.  The comparison may be enlightening.</pre><br>
<pre style="margin: 0em;">Thirdly, a fundamental issue is whether or not the solution method
needs to be implicit -- that is, whether it needs to make use of the
Jacobian blocks df/dy and df/dy'.  If the system does not have decay
modes with small time constants, the chances are that an implicit
solution method is not needed.  In that case, a solution with CVODE,
with the nonstiff option (Adams method + Functional iteration), makes
the most sense.  Then there is no need for a special linear solver,
only the solver to compute A{-1}f efficiently, in the case Ay'' = f.</pre><br>
<pre style="margin: 0em;">The purpose of the various linear solver modules in CVODE etc. is to
exploit the particular sparsity structure of the Jacobian in the cases
where an implicit method is called for.  For y'' = f, defining
z = (y,y'), the Jacobian is the block matrix</pre><br>
<pre style="margin: 0em;">   (   0      I    )
J = (               )
   ( df/dy  df/dy' )</pre><br>
<pre style="margin: 0em;">If y is a vector of length N, and the 2N-vector z is ordered in a
different way [e.g. z = (y_1, y'_1, y_2, y'_2, ...)], then of course J
is instead a permutation of the above.</pre><br>
<pre style="margin: 0em;">But you have said nothing about the sparsity structures of df/dy or
df/dy'.  So a specialized linear solver module for this problem would
have to have two things:
 (a) the knowledge of which components of z are 'positions' (from y) and
 which are 'velocities' (from y'), as Radu pointed out, and
 (b) information about the structure of df/dy and df/dy' to be
 assumed (dense, banded, other sparse, etc. ).
If one of the two natural choices for z is adopted, then the knowledge
in (a) would follow from the knowledge of which of those choices was
made.  The best choice depends on various things.  For example, if N
is large and the blocks df/dy and df/dy' are banded, the second choice
seems best, and the existing banded linear solver would exploit the
structure of J about as well as could be done with any special module.
If N is not large, there is not much to gain, and the existing dense
solver is probably best.  There are many other possibilities, of course.</pre><br>
<pre style="margin: 0em;">-Alan Hindmarsh</pre><br>
<pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;"><br>On Tue, 18 Jul 2006 zxd@bu.edu wrote:</pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">This is may be specific but it is also very general for a
variety of problems. e.g. for many mechanical system
(each component may be specified by p,v).</pre><br>
<pre style="margin: 0em;">In this case, in stead of problem of 2n x 2n, it only need solve the
problem with n x n size, both for direct linear solver and iterative
linear solver, so the advantage is obvious.</pre><br>
<pre style="margin: 0em;">This is because the Jac Matrix is very structured:
If this system can be described as Ay'' + By' +Cy = 0.
The Jac matrix for u' and u (u = [p, v] is [I, O; O A], [O I; C B]
separately. And it is easily to cut the problem size in half.</pre><br>
<br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">Xuedong,
Such a linear solver would require knowledge of the 'type' of
variable ('position' or 'velocity') which is not required otherwise
and would
conflict with one of the design principles for the SUNDIALS solvers
(namely that the solvers are data-independent). Of course, you can
write
your own linear solver and interface it to any of the SUNDIALS
solvers. When using a dense Jacobian, a linear solver like the one you
suggest, would certainly save memory but probably not a whole lot in
terms of efficiency. For an iterative linear solver I do not see any
advantages.
--Radu</pre><br>
<pre style="margin: 0em;">--
    Radu Serban
    Center for Applied Scientific Computing   [email] radu@llnl.gov
    Lawrence Livermore National Laboratory    [phone] 925-424-4852
    P.O. Box 808, L-560                       [fax]   925-422-6287
    Livermore, CA 94551</pre><br>
</blockquote><pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;"><br>--
Xuedong Zhang
Research Associate
Hearing Research Center, Department of Biomedical Engineering
Boston University</pre><br>
<pre style="margin: 0em;"><br></pre><br>
</blockquote><br>
</blockquote><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00575" href="msg00575.html">[sundials-users] custom linear solvers for cvodes, and ida</a></strong>
<ul><li><em>From:</em> Xuedong Zhang &lt;zxd@MIT.EDU&gt;</li></ul></li>
<li><strong><a name="00578" href="msg00578.html">Re: [sundials-users] custom linear solvers for cvodes, and ida</a></strong>
<ul><li><em>From:</em> Radu Serban &lt;radu@llnl.gov&gt;</li></ul></li>
<li><strong><a name="00582" href="msg00582.html">Re: [sundials-users] custom linear solvers for cvodes, and ida</a></strong>
<ul><li><em>From:</em> zxd@bu.edu</li></ul></li>
<li><strong><a name="00583" href="msg00583.html">Re: [sundials-users] custom linear solvers for cvodes, and ida</a></strong>
<ul><li><em>From:</em> Alan Hindmarsh &lt;alanh@llnl.gov&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00585.html">Re: [sundials-users] Problems with IDACalcIC()</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00587.html">[sundials-users] Question about uinsg sundials for problem will ill-conditinoed Jacobian Matrix</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00583.html">Re: [sundials-users] custom linear solvers for cvodes, and ida</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00584.html">Re: [sundials-users] custom linear solvers for cvodes, and ida</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00586">
<strong>Main</strong></a></li>
<li><a href="threads.html#00586">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
