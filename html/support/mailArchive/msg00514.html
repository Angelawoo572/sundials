<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [sundials&#45;users] CV_TOO_MUCH_WORK -->
<!--X-From-R13: Dnqh Ereona <enqhNyyay.tbi> -->
<!--X-Date: Thu, 15 Jun 2006 06:46:02 &#45;0700 -->
<!--X-Message-Id: 449163F7.2030808@llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 000c01c69055$811c1900$3df901a3@PCHEARTBREAK -->
<!--X-Head-End-->
<html>
<head>
<title>Re: [sundials-users] CV_TOO_MUCH_WORK</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00513.html">Date Prev</a>] [<a href="msg00515.html">Date Next</a>] [<a href="msg00512.html">Thread Prev</a>] [<a href="msg00516.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00514">Date Index</a></b>]
[<b><a href="threads.html#00514">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sundials-users] CV_TOO_MUCH_WORK</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Radu Serban &lt;<a href="mailto:radu%40llnl.gov">radu@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Thu, 15 Jun 2006 06:43:19 -0700</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Alan,</pre><br>
<tt>I asked for the equations because I thought you might be solving some DAEs with an operator split approach.<br>
But for your system, you should certainly rethink how you use CVODE. A fully implicit approach will give you much better performance than 
the operator splitting you are currently doing. Just semi-discretize your PDE with any finite difference and use CVODE on the resulting 
(large) ODE system. Several of the CVODE examples (all of those using one of the Krylov linear solvers but also cvbanx) are good starting 
templates.</tt><br>
<br>
<tt>You will have to pay attention to all the issues Alan H. mentioned (ordering of variables, choice of linear solver, and, if using one of the 
Krylov solvers, preconditioning).</tt><br>
<br>
<tt>I would worry about memory requirements only after getting CVODE to work on the proper ODE system. In any case, commenting out portions of 
the code will not save you much (if anything) and will only make updating to newer SUNDIALS releases harder. If you do not use root finding, 
there is no extra memory allocated, so it's useless to comment it out. Also, the memory allocated for stability limit detection is 
insignificant (an array of 24 realtypes). If memory really becomes an issue, you can save much more by limiting the maximum method order 
(but only after careful consideration of the pros and cons) since the space required for N_Vectors dominates (by a large extent) the CVODE 
memory usage.</tt><br>
<br>
<pre style="margin: 0em;">--Radu</pre><br>
<pre style="margin: 0em;">Alan Garny wrote:</pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">I currently solve my PDE system using a finite difference method and reading
your comments, it now makes sense: I should rearrange things.</pre><br>
<pre style="margin: 0em;">To answer Radu's question, one of the systems I am trying to solve is:</pre><br>
<pre style="margin: 0em;">Am*(Cm*dVm/dt+Sum(Iion)) = div(D*grad(Vm))</pre><br>
<pre style="margin: 0em;">Where Am is the surfave-to-volume ratio of the cell, Cm is the capacitance
of the cell, Vm is the transmembrane potential of the cell, Iion is one of
the cell's currents, and D the conductivity tensor.</pre><br>
<pre style="margin: 0em;">At the moment, the way I solve that is:</pre><br>
<pre style="margin: 0em;">1) Solve dVm/dt = -1/Cm*Sum(Iion) for each cell, using CVODE,
2) Compute 1/Am*div(D*grad(Vm)) for each cell,
3) Update Vm using a simple forward Euler technique.</pre><br>
<pre style="margin: 0em;">Because of #3, I obviously have to reinitialise CVODE, which is where I lose
an awful lot of time.</pre><br>
<pre style="margin: 0em;">I suppose I should rewrite the above equation as follows:</pre><br>
<pre style="margin: 0em;">dVm/dt = 1/Cm*(1/Am*div(D*grad(Vm))-Sum(Iion))</pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><tt>From there, it's going to be easy to use CVODE in an efficient way. I should
</tt></blockquote><pre style="margin: 0em;">have thought of that before. I tried to get CVODE and my implementation of a
'cell' to work together as well as possible, without having to modify the
latter, but it would seem that it might be worth reworking my implementation
of a 'cell'.</pre><br>
<pre style="margin: 0em;">This still leaves the problem of memory requirements though. CVODE does
require quite a bit of it, even though I have been able to reduce its
requirements by commenting out some of the stuff that I don't need (e.g.
stability limit detection and rootfinding data). I guess there is no much
that can be done about it though...</pre><br>
<pre style="margin: 0em;">Anyway, thanks again for a great library and useful comments!</pre><br>
<pre style="margin: 0em;">        Cheers, Alan.</pre><br>
<br>
</blockquote><pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">--
   Radu Serban
   Center for Applied Scientific Computing   [email] radu@llnl.gov
   Lawrence Livermore National Laboratory    [phone] 925-424-4852
   P.O. Box 808, L-560                       [fax]   925-422-6287
   Livermore, CA 94551</pre><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00516" href="msg00516.html">RE: [sundials-users] CV_TOO_MUCH_WORK</a></strong>
<ul><li><em>From:</em> &quot;Alan Garny&quot; &lt;agml@hellix.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00512" href="msg00512.html">RE: [sundials-users] CV_TOO_MUCH_WORK</a></strong>
<ul><li><em>From:</em> &quot;Alan Garny&quot; &lt;agml@hellix.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00513.html">Re: [sundials-users] include file directory layout</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00515.html">Re: [sundials-users] include file directory layout</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00512.html">RE: [sundials-users] CV_TOO_MUCH_WORK</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00516.html">RE: [sundials-users] CV_TOO_MUCH_WORK</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00514">
<strong>Main</strong></a></li>
<li><a href="threads.html#00514">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
