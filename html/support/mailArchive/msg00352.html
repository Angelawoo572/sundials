<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [sundials&#45;users] Changing algebraic variables during integration with IDA -->
<!--X-From-R13: Dnqh Ereona <freona1Nyyay.tbi> -->
<!--X-Date: Tue, 07 Mar 2006 09:13:54 &#45;0800 (PST) -->
<!--X-Message-Id: 440DBEF9.4060200@llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 9719251EEFA00B4397C90260CE584496015D2F9C@nt2mail03.emn.com -->
<!--X-Head-End-->
<html>
<head>
<title>Re: [sundials-users] Changing algebraic variables during integration with IDA</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00351.html">Date Prev</a>] [<a href="msg00353.html">Date Next</a>] [<a href="msg00340.html">Thread Prev</a>] [<a href="msg00354.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00352">Date Index</a></b>]
[<b><a href="threads.html#00352">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sundials-users] Changing algebraic variables during integration with IDA</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Radu Serban &lt;<a href="mailto:serban1%40llnl.gov">serban1@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Tue, 07 Mar 2006 09:12:25 -0800</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Ernie,</pre><br>
Vogel, Ernest F - Eastman wrote:
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">Radu,</pre><br>
<pre style="margin: 0em;">Oops!  I've got a mistake in the equations.  They should be:</pre><br>
<pre style="margin: 0em;">Two differential equations:
yp1 = A - yy3
yp2 = yy3 - B</pre><br>
One algebraic equation:<br>
yy3 = C * ( yy1 - yy2 ) <br>
<br>
<pre style="margin: 0em;">yy3 is the algebraic variable.  Sorry for that confusion.</pre><br>
<pre style="margin: 0em;">I now have additional question, besides the original ones below.
Because yy3 can be solved for explicitly very easily in this case, is
there really any advantage to solving this problem as a set of DAEs as
opposed to a set of ODEs?
</pre></blockquote><br>Indeed, you can look at this system as an index-1 DAE but it wouldn't be very productive to do so. I would rather look at y3 as some 
temporary variable which is needed to put together the right-hand side of an ODE of dimension 2. If y3 is of interest in itself, you can 
always recover it at any time you have a (y1,y2) solution.<br>
<br>
If the problem you want to solve is in this form, you should definitely switch to using CVODE and solve what is practically the underlying 
ODE for your DAE system.<br>
<br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">Thanks very much and again my apologies for the mistake in the
equations.</pre><br>
Ernie
</blockquote><pre style="margin: 0em;"><br>--Radu</pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;"><br>-----Original Message-----
From: owner-sundials-users@lists.llnl.gov
[<a  href="mailto:owner-sundials-users@lists.llnl.gov">mailto:owner-sundials-users@lists.llnl.gov</a>] On Behalf Of Radu Serban
Sent: Thursday, March 02, 2006 3:33 PM
To: sundials-users@llnl.gov
Subject: Re: [sundials-users] Changing algebraic variables during
integration with IDA</pre><br>
<pre style="margin: 0em;">Ernie,</pre><br>
Before attempting to answer any of your questions, please revisit the<br>
example you give below. If A, B, and C are specified, this is not a 
DAE. What would the algebraic variable be? If A, B, and C are constants,<br>
this set of 3 equations has a solution only if A=B and then y1 and 
y2 are constants: y2=A, y1 = (1+C)*A/C.<br>
<br>
<pre style="margin: 0em;">Assuming you do have an honest DAE (we also need to figure out its
index, so a better simplified example is needed for that too), are A, B,</pre><br>
<pre style="margin: 0em;">C constants that the controller would change at each action step?</pre><br>
<pre style="margin: 0em;">--Radu</pre><br>
<pre style="margin: 0em;">Vogel, Ernest F - Eastman wrote:</pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">Alan,</pre><br>
<pre style="margin: 0em;">Thank you very much for your reply.</pre><br>
<pre style="margin: 0em;">I'd like to offer a simple example for clarification.</pre><br>
<pre style="margin: 0em;">Two differential equations:
yp1 = A - yy2
yp2 = yy2 - B</pre><br>
<pre style="margin: 0em;">One algebraic equation:
yy2 = C * ( yy1 - yy2 )</pre><br>
<pre style="margin: 0em;">(yp is the derivative of yy.)</pre><br>
<pre style="margin: 0em;">I am simulating a continuous process with discrete feedback control.
The integrator stops at the end of each control action step (I am
</pre></blockquote><pre style="margin: 0em;"><br>using</pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">IDASetStopTime so it doesn't overshoot).  In some cases, a controller
could change A or B.  In those cases, IDA seemed to handle changes to
</pre></blockquote><pre style="margin: 0em;"><br>A</pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em">and B without trouble.  In other cases, a controller could change C.
</blockquote><pre style="margin: 0em;"><br>As</pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">I expected, changes to C caused problems which I over came by calling
IDACalcIC whenever I changed C.</pre><br>
I was not sure from your reply exactly when I should need to restart
</blockquote><pre style="margin: 0em;"><br>the</pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">solver.  It seems that changes to C should for sure require a restart,
but what about A and B?</pre><br>
<pre style="margin: 0em;">Your reply also brings up a couple more questions:
Would you say that in my case, changes to A, B, and C are explicit?
Would an implicit change likely occur at an unknown time?
What is the difference between the rootfinding feature and IDACalcIC?</pre><br>
<pre style="margin: 0em;">Once again, thanks very much for your help.</pre><br>
<pre style="margin: 0em;">Ernie Vogel</pre><br>
<br>-----Original Message-----<br>
From: Alan Hindmarsh [<a  href="mailto:alanh@llnl.gov">mailto:alanh@llnl.gov</a>] 
Sent: Wednesday, March 01, 2006 5:08 PM<br>
To: Vogel, Ernest F - Eastman<br>
Cc: sundials-users@llnl.gov; alanh@llnl.gov<br>
Subject: Re: [sundials-users] Changing algebraic variables during<br>
integration with IDA<br>
<br>
<pre style="margin: 0em;"><br>Hello Ernie,</pre><br>
<pre style="margin: 0em;">If and when there is a major discontinuity in the model (whether in a
differential variable or an algebraic variagle), it is best to stop
there and restart.  Letting the ODE/DAE solver locate the jump and get
through it on its own is likely to be less efficient.  If the point of
the jump is defined implicitly, use the rootfinding feature (available
in CVODE now, and in IDA in the next release) to locate it.  On the
other hand, if the jump is small, each of these solvers is designed to
handle it without extra assistance.</pre><br>
<pre style="margin: 0em;">When stopping and restarting after resetting a variable value, you
should call IDAReInit.  Also call IDACalcIC only if your new values
are not known to be consistent with the DAEs.</pre><br>
<pre style="margin: 0em;">In the sundials-users archives you will find various other discussions
about handling discontinuities.</pre><br>
<pre style="margin: 0em;">-Alan Hindmarsh</pre><br>
<pre style="margin: 0em;"><br>On Wed, 22 Feb 2006, Vogel, Ernest F - Eastman wrote:</pre><br>
<pre style="margin: 0em;"><br></pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">For the set of DAEs that I am integrating with IDA, I want to make
changes to variables that appear in the differential equations and
variables that appear in the algebraic equations periodically over the
course of the integration.  Changing variables that appear in
differential equations do not appear to present a problem.  However,
changing variables that appear in algebraic equations make the solver
stop.  That result seems expected because the changes move the
</pre></blockquote><pre style="margin: 0em;"><br>algebraic</pre><br>
<br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">equations away from a solution.  To fix the problem, I called the
function IDACalcIC to recalculate the algebraic solution each time I
changed a variable in an algebraic equation.  That additional call
</pre></blockquote><pre style="margin: 0em;"><br>made</pre><br>
<br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">the total function evaluations go up by a factor of 4, compared to the
case where I am not changing algebraic variables.  I'm wondering if
there is a better way to deal with the case of changing variables in
algebraic equations.  Calling IDAReInit seems like a possibility, but
not as likely to work as IDACalcIC.</pre><br>
<pre style="margin: 0em;">Thanks for your help!
Ernie Vogel
</pre></blockquote><pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">[* Internet Mail *]</pre><br>
<pre style="margin: 0em;"><br></pre><br>
</blockquote><pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">[* Internet Mail *]</pre><br>
<pre style="margin: 0em;"><br></pre><br>
</blockquote><pre style="margin: 0em;"><br></pre><br>
<br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00340" href="msg00340.html">RE: [sundials-users] Changing algebraic variables during integration   with IDA</a></strong>
<ul><li><em>From:</em> &quot;Vogel, Ernest F - Eastman&quot; &lt;efvogel@eastman.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00351.html">Re: [sundials-users] Installing/checking sundials 2.1.1</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00353.html">Re: [sundials-users] value of t during internal steps of CVODE call</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00340.html">RE: [sundials-users] Changing algebraic variables during integration   with IDA</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00354.html">RE: [sundials-users] Changing algebraic variables during integration with IDA</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00352">
<strong>Main</strong></a></li>
<li><a href="threads.html#00352">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
