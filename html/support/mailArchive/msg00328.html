<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [sundials&#45;users] value of t during internal steps of CVODE call -->
<!--X-From-R13: Oyna Vvaqznefu <nynauNyyay.tbi> -->
<!--X-Date: Wed, 01 Mar 2006 14:54:44 &#45;0800 (PST) -->
<!--X-Message-Id: Pine.LNX.4.58.0603011451320.2926@tux64.llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20060227060328.37597.qmail@web37010.mail.mud.yahoo.com -->
<!--X-Head-End-->
<html>
<head>
<title>Re: [sundials-users] value of t during internal steps of CVODE call</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00327.html">Date Prev</a>] [<a href="msg00329.html">Date Next</a>] [<a href="msg00315.html">Thread Prev</a>] [<a href="msg00308.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00328">Date Index</a></b>]
[<b><a href="threads.html#00328">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sundials-users] value of t during internal steps of CVODE call</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Alan Hindmarsh &lt;<a href="mailto:alanh%40llnl.gov">alanh@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Wed, 01 Mar 2006 14:52:39 -0800 (PST)</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>
Hello Raj,

Here are answers to your questions, although I can think of no reason
why you would need to know any of this.

a) The value of y you see inside the f() function is NEVER the actual
solution.  It is either approximate value in a sequence of iterates,
or an artificially incremented value for Jacobian evaluation.  The
last one you see for a given successful step is the next-to-last
iterate, not the last.

b1) The actual accepted solution for a given successful step (like the
one ending at t = 553.100979 in your case) is stored internally in an
array called zn (which also carries much more history information).
You do not have direct access to that location from outside CVODE.
But you can certainly get that solution vector, as follows: If you are
in one-step mode, it is the y value returned.  If you are in normal
(overshoot and interpolate) mode, call CVodeGetCurrentTime and then
call CVGetDky with order = 1 and t = tcur.

b2) After a successful step, the actual solution value (in zn) is used
to start the next step, but only after a q-th order prediction
operation that uses all the available history information, where q
is the current method order.  (If q = 1, the prediction has the form
ypred = yold + h * ydotold, using date at the old t.)

c) When a step fails (as did the one ending at t = 554.100979 in your
case), and a new stepsize is chosen (it went from 1.0 to .25 in your
case), a new prediction at the new forward time is done, again using
all available history information.  The predicted value of y is the
first one you see within f(); in your case that is y = 0.116425925.

-Alan Hindmarsh


On Sun, 26 Feb 2006, raj duffy wrote:

&gt;<i> Hey There</i>
&gt;<i>       Have few more question (perhaps the last set!)  regarding internal time </i>
&gt;<i> steps and corresponding y values. Below is a  part of my simulation.</i>
&gt;<i>   &quot;t = ...... y= ........&quot; are being printed from inside the function f()</i>
&gt;<i></i>
&gt;<i>   Tsteps    =    552</i>
&gt;<i>   t=    553.100979    y    0.116404725</i>
&gt;<i>   t=    553.100979    y    0.117354231</i>
&gt;<i>   t=    553.100979    y    0.116216941</i>
&gt;<i>   t=    553.100979    y    0.116663327   (passes convergence tests)</i>
&gt;<i>   t=    553.100979    y    0.115648493   (passes convergence tests)</i>
&gt;<i>   t=    553.100979    y    0.116903802   (passes convergence tests)</i>
&gt;<i>   Tsteps    =    553</i>
&gt;<i>   t=    554.100979    y    0.116422809</i>
&gt;<i>   t=    554.100979    y    0.117275213</i>
&gt;<i>   t=    554.100979    y    0.116433829</i>
&gt;<i>   t=    554.100979    y    0.116221562</i>
&gt;<i>   t=    554.100979    y    0.116451969</i>
&gt;<i>   t=    554.100979    y    0.116722255</i>
&gt;<i>   t=    554.100979    y    0.115780886</i>
&gt;<i>   t=    554.100979    y    0.116865043</i>
&gt;<i>   t=    554.100979    y    0.11687925</i>
&gt;<i>   t=    554.100979    y    0.116576685</i>
&gt;<i>   t=    554.100979    y    0.116454164</i>
&gt;<i>   t=    554.100979    y    0.117410634</i>
&gt;<i>   t=    554.100979    y    0.116358146</i>
&gt;<i>   t=    554.100979    y    0.11617726</i>
&gt;<i>   t=    554.100979    y     0.116245398   (Note: after this time step  </i>
&gt;<i> decreases)</i>
&gt;<i>   t=    553.350979    y    0.116425925</i>
&gt;<i>   t=    553.350979    y    0.11734981</i>
&gt;<i>   t=    553.350979    y    0.116311416</i>
&gt;<i>   t=    553.600979    y    0.116656432</i>
&gt;<i>   t=    553.600979    y    0.115716523</i>
&gt;<i>   t=    553.600979    y    0.116684277</i>
&gt;<i>   t=    553.987421    y    0.116500736</i>
&gt;<i>   t=    553.987421    y    0.117433375</i>
&gt;<i>   t=    553.987421    y    0.116445501</i>
&gt;<i>   t=    554.373862    y    0.116841636</i>
&gt;<i>   t=    554.373862    y    0.115856428</i>
&gt;<i>   t=    554.373862    y    0.116979296</i>
&gt;<i></i>
&gt;<i></i>
&gt;<i></i>
&gt;<i>   Now my questions are</i>
&gt;<i></i>
&gt;<i>   a) Is the y value printed for some t (as above) is also the actual  </i>
&gt;<i> solution at that t. Or the printed y value above are basically the y  value </i>
&gt;<i> at the second last iteration before convergence at time t.</i>
&gt;<i></i>
&gt;<i>   b) what is the actual solution at  t=    553.100979  given the fact that </i>
&gt;<i> last 3 y values corresponding to this t pass  convergence tests and are </i>
&gt;<i> perhaps just being used for jacobian  evaluation. Will this be the value used </i>
&gt;<i> in first iteration for next  internal time step.</i>
&gt;<i></i>
&gt;<i>   c) What happens when the time step reverts from a larger value (say  </i>
&gt;<i> t=554.100979) to a smaller one (t = 553.350979). Does the iteration for  t </i>
&gt;<i> =553.350979 starts from the y value at t=     553.100979 (i.e. one time step </i>
&gt;<i> earlier than the convergence failure  which happened at t=554.100979).</i>
&gt;<i></i>

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00315" href="msg00315.html">Re: [sundials-users] value of t during internal steps of CVODE call</a></strong>
<ul><li><em>From:</em> raj duffy &lt;raj_duffy@yahoo.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00327.html">Re: [sundials-users] Changing algebraic variables during integration with IDA</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00329.html">Re: [sundials-users] Installing/checking sundials 2.1.1</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00315.html">Re: [sundials-users] value of t during internal steps of CVODE call</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00308.html">Re: [sundials-users] value of t during internal steps of CVODE call</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00328">
<strong>Main</strong></a></li>
<li><a href="threads.html#00328">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
