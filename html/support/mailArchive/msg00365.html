<!-- MHonArc v2.6.10 -->
<!--X-Subject: RE: [sundials&#45;users] Sundials compilation error (problem with xlc/xlf?) -->
<!--X-From-R13: "@bl, Rnivq X" <qwaNotf.np.hx> -->
<!--X-Date: Fri, 10 Mar 2006 07:43:49 &#45;0800 (PST) -->
<!--X-Message-Id: D36ADF13A2713749A7B0274D40F0C0D6325020@kwntsmail.ad.bgs.ac.uk -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<html>
<head>
<title>RE: [sundials-users] Sundials compilation error (problem with xlc/xlf?)</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00364.html">Date Prev</a>] [<a href="msg00366.html">Date Next</a>] [<a href="msg00364.html">Thread Prev</a>] [<a href="msg00366.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00365">Date Index</a></b>]
[<b><a href="threads.html#00365">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>RE: [sundials-users] Sundials compilation error (problem with xlc/xlf?)</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
&quot;Noy, David J&quot; &lt;<a href="mailto:djn%40bgs.ac.uk">djn@bgs.ac.uk</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Fri, 10 Mar 2006 15:41:15 +0000</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Radu,

Following CW Yuan and Christos Frouzakis, I'd like to add a third report of 
problems with the Fortran examples and the solution not being updated. I can 
confirm this problem both on an Intel linux machine with PGI compilers and on a 
PowerMac using Absoft Fortran. I have done a bit of digging about in the 
cvdensef example and the problem seems to lie in the fcvode.c interface code. 
At line 357 you assign a new address to the solution vector with the line

  y = N_VGetArrayPointer(F2C_vec);

I think it may be the case that some (many?) Fortran compilers will not look 
for a new address for an array when a subroutine returns - only the contents of 
an array are expected to change, not its location. My C coding skills are not 
up to doing the job properly (I work mainly with Fortran), but I found that 
replacing the line with

  realtype *ytmp;
  ytmp = N_VGetArrayPointer(F2C_vec);
  for (i=0; i&lt;3; i++)
    y[i] = ytmp[i];

allows the cvdensef example to work correctly. I imagine there is a 'proper' 
way to copy the data content of this vector across which you can supply, but I 
also wonder if there may be other places that you have used this approach, 
requiring a more extensive revision of the Fortran interface files.

Incidently, when installing Sundials on the Linux machine I found that all the 
Fortran examples failed to link because configure had set $(CC) as the loader 
which failed. It seems that with PGI compilers, Fortran main programs have to 
be loaded with f77, so replacing the loader in the makefile with $(F77) works, 
but is there a way to get configure to write the makefiles this way 
automatically?

Regards,

David Noy


-----Original Message-----
From: owner-sundials-users@lists.llnl.gov
[<a  href="mailto:owner-sundials-users@lists.llnl.gov]On">mailto:owner-sundials-users@lists.llnl.gov]On</a> Behalf Of Radu Serban
Sent: 09 March 2006 21:38
To: sundials-users@llnl.gov
Subject: Re: [sundials-users] Sundials compilation error (problem with
xlc/xlf?)


Hi CW,

The results and statistics that you obtain for the C examples, both serial and 
parallel, are fine. When compared with the sample outputs 
provided with SUNDIALS, the differences in solutions are within tolerances and 
you can always expect variations like the ones you see in the 
final statistics.

As to the Fortran examples, you are now the second one to report that the 
reported solution is not updated. Christos Frouzakis obtained the 
exact same thing on an Opteron machine. I have built SUNDIALS before on AMD 
processors, but never on a 64-bit AMD processor (Opteron or 
Athlon).

I have a feeling yours is a 64-bit box also, isn't it? If so, you should (as I 
suggested to Christos) read carefully the g77 manpage to see 
what flags are needed to mix Fortran and C. Also, you may need to modify the 
Fortran examples to ensure that the sizes of various types 
agree with what the C libraries expect. As I've already mentioned to Christos, 
a Google search shows issues related to g77 not generating 
integers 8-byte long by default (and not having the -i8 option either). I 
strongly suspect this is what's going on here.

I do not have acces to such a machine to try it myself, but I'd try to force 
32-bit mode and see if that works (-m32 compiler switch to gcc 
and g77 I suppose).

Also, if you have access to PGI compilers, try using those as pgf77 does 
provide the -i8 option.

Botom line is that these issues are difficult to resolve remotely. The very 
first thing that you should do is write and test a very simple 
mixed Fortran-C program.

--Radu



*********************************************************************
This message (and any attachments) is for the recipient only.
NERC is subject to the Freedom of Information Act 2000 and
the contents of this email and any reply you make may be
disclosed by NERC unless it is exempt from release under
the Act. Any material supplied to NERC may be stored in an
electronic records management system.
*********************************************************************



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00366" href="msg00366.html">Re: [sundials-users] Sundials compilation error (problem with xlc/xlf?)</a></strong>
<ul><li><em>From:</em> Aaron Collier &lt;collier6@llnl.gov&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00364.html">Re: [sundials-users] Sundials compilation error (problem with xlc/xlf?)</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00366.html">Re: [sundials-users] Sundials compilation error (problem with xlc/xlf?)</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00364.html">Re: [sundials-users] Sundials compilation error (problem with xlc/xlf?)</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00366.html">Re: [sundials-users] Sundials compilation error (problem with xlc/xlf?)</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00365">
<strong>Main</strong></a></li>
<li><a href="threads.html#00365">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
