<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: R: [sundials&#45;users] Re: Avoiding discontinuities in y_dot -->
<!--X-From-R13: Oyna Vvaqznefu <nynauNyyay.tbi> -->
<!--X-Date: Wed, 08 Feb 2006 12:55:00 &#45;0800 (PST) -->
<!--X-Message-Id: Pine.LNX.4.58.0602081244400.8076@tux64.llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 200602080816.k188GaN9000308@nospam&#45;4.llnl.gov -->
<!--X-Head-End-->
<html>
<head>
<title>Re: R: [sundials-users] Re: Avoiding discontinuities in y_dot</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00291.html">Date Prev</a>] [Date Next] [<a href="msg00290.html">Thread Prev</a>] [<a href="msg00241.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00292">Date Index</a></b>]
[<b><a href="threads.html#00292">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: R: [sundials-users] Re: Avoiding discontinuities in y_dot</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Alan Hindmarsh &lt;<a href="mailto:alanh%40llnl.gov">alanh@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Wed, 08 Feb 2006 12:53:04 -0800 (PST)</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>
In my opinion, the transformation idea is more harmful than helpful.
First, the transformation (and its inverse) itself adds expense.
Second, the proper choice of tolerances for the transformed variable
is unclear, and is very likely to lead to a more expensive integration
(aside from the bounds issue).  Finally, I think users are tempted to
use this (or other tricks) to avoid small (tolerance-level) violations
of bounds when no such action is really needed.  Just let the small
unphysical values occur, but locally adjust them if necessary.

Bad difference-quotient Jacobian values from y_local seem very unlikely to
me.  The computed values of (partial f / partial y_i) are likely to be
zero because of y_local, and that is appropriate since y_i is flat (for a
while).

-Alan H.



On Wed, 8 Feb 2006, Paolo Greppi 3iP wrote:

&gt;<i> Regarding bounds, my experience is as follows.</i>
&gt;<i> Either the feasible range is open or it is closed. For example open means</i>
&gt;<i> 0&lt;y&lt;1 and closed 0&lt;=y&lt;=1.</i>
&gt;<i></i>
&gt;<i> If the bound is open you can nonlinearly transform the variable so that the</i>
&gt;<i> unfeasible values are unattainable.</i>
&gt;<i> One example of function you can use for finite limits is a rational 1st</i>
&gt;<i> order function; a log scaling is an obvious choice if the feasible range is</i>
&gt;<i> 0&lt;y&lt;Inf.</i>
&gt;<i> The solver will see the yscaled=log(y) as the unknown, so no matter how low</i>
&gt;<i> it will drive it, the physical variable y=exp(yscaled) will be positive.</i>
&gt;<i></i>
&gt;<i> If the bound is closed, i.e. even the limit(s) are/is feasible, and if the</i>
&gt;<i> solver has a step limitation it makes sense to scale anyway with a nonlinear</i>
&gt;<i> function so that while approaching the limit the solver slows down.</i>
&gt;<i> In this case you should use one scaling function that makes trespassing the</i>
&gt;<i> limit possible (maybe using a shift like in log(y+1)).</i>
&gt;<i> But that does not solve the problem.</i>
&gt;<i></i>
&gt;<i> Restricting the values obtained from the solver with y_local protects from</i>
&gt;<i> division by zero, negative logs and all sort of bad things, but also makes</i>
&gt;<i> the residual function insensible to further changes to y. Example: if y</i>
&gt;<i> should be positive and the solver tries first y=-0.1 and next y=-0.01 since</i>
&gt;<i> the residual always computes with y_local=0, it will be confused.</i>
&gt;<i> If the jacobian is analytic and computed at y_local=0 it will predict a</i>
&gt;<i> dependency of f on y which is not seen by the solver when it actually tries</i>
&gt;<i> different unfeasible values.</i>
&gt;<i></i>
&gt;<i> So it is also required to tweak the residual by adding a shadow cost when</i>
&gt;<i> the limit is trespassed; this acts as a soft wall that smoothly encourages</i>
&gt;<i> the solver to re-enter the feasible zone.</i>
&gt;<i> Example:</i>
&gt;<i> f = f_whatever(y_local) + cost*(y - y_local)</i>
&gt;<i> This also impacts the jacobian, by adding the cost to the derivative df/dy.</i>
&gt;<i></i>
&gt;<i> Any comments welcome,</i>
&gt;<i></i>
&gt;<i>       P.</i>

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00290" href="msg00290.html">R: [sundials-users] Re: Avoiding discontinuities in y_dot</a></strong>
<ul><li><em>From:</em> Paolo Greppi 3iP &lt;paolo.greppi@3ip.it&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00291.html">Re: [sundials-users] Re: Avoiding discontinuities in y_dot</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00290.html">R: [sundials-users] Re: Avoiding discontinuities in y_dot</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00241.html">RE: Building SUNDIALS/CVODE on Windows</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00292">
<strong>Main</strong></a></li>
<li><a href="threads.html#00292">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
