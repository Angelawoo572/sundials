<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [sundials&#45;users] Arbitrary precision for sundials solvers? -->
<!--X-From-R13: Dnqh Ereona <freona1Nyyay.tbi> -->
<!--X-Date: Wed, 12 Apr 2006 10:45:47 &#45;0700 (PDT) -->
<!--X-Message-Id: 443D3C38.9070402@llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 6BBF14CC0A5E6845929616D28E450E2E8659F1@sasdmsg02.sasol.com -->
<!--X-Reference: 443D1013.7030905@Uni&#45;Koeln.De -->
<!--X-Head-End-->
<html>
<head>
<title>Re: [sundials-users] Arbitrary precision for sundials solvers?</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00435.html">Date Prev</a>] [<a href="msg00437.html">Date Next</a>] [<a href="msg00435.html">Thread Prev</a>] [<a href="msg00421.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00436">Date Index</a></b>]
[<b><a href="threads.html#00436">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sundials-users] Arbitrary precision for sundials solvers?</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Radu Serban &lt;<a href="mailto:serban1%40llnl.gov">serban1@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Wed, 12 Apr 2006 10:43:20 -0700</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Kai,</pre><br>
Use the original formulation. The transformation suggested by Robin has been discussed before<br>
    (see <a  href="http://www.llnl.gov/CASC/sundials/support/mailArchive/msg00358.html">http://www.llnl.gov/CASC/sundials/support/mailArchive/msg00358.html</a>)<br>
and is not recommended. While it's straightforward to specify atol for A, B,... (they have a physical interpretation - the noise level; i.e. 
the values below which the corresponding solution component can be considered 0 for purposes of numerical integration) it is not clear how 
to select absolute tolerances for Anew, Bnew,...<br>
<br>
Of course, you need to ensure that you use only positive values for A, B, ... when evaluating the RHS function. Again this issue has been 
discussed ad nauseam and is the topic of one of the &quot;Usage Notes&quot; on the SUNDIALS website<br>
    (see <a  href="http://www.llnl.gov/CASC/sundials/support/notes.html#disc">http://www.llnl.gov/CASC/sundials/support/notes.html#disc</a>)<br>
Try either solution (1) - using the RHS return flag, or (3) - using temporary variables (both described in the &quot;Treatment of unphysical 
solution components&quot; subsection). Also look at the cvsnegsolx example provided there.<br>
<br>
<pre style="margin: 0em;">--Radu</pre><br>
Kai Hartmann wrote:
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">Hi Robin,</pre><br>
<pre style="margin: 0em;">I also had that in mind some time ago. I thought of it like that:</pre><br>
<pre style="margin: 0em;">dy/dt = a*lny - b</pre><br>
<pre style="margin: 0em;">z = lny &lt;=&gt; y = exp(z)</pre><br>
<pre style="margin: 0em;">dy/dt = dz/dt*exp(z)</pre><br>
<pre style="margin: 0em;">=&gt; dz/dt = exp(-z)*(a*z-b)</pre><br>
<pre style="margin: 0em;">This leads to the same problem, doesn't it? Well, I tested it and it
gave exactly the same result.</pre><br>
<pre style="margin: 0em;">Did I make mistake?</pre><br>
<pre style="margin: 0em;">Kai</pre><br>
<pre style="margin: 0em;"><br>Jordi, Robin (RG) schrieb:</pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">Dear Kai,</pre><br>
<pre style="margin: 0em;">Why don't you transform the equation using an exponential transform.
Eq: Anew = ln(A), Bnew = ln(B) etc. This removes the logs and you solve
for the logarithm of the concentrations in question.</pre><br>
<pre style="margin: 0em;">Cheers,</pre><br>
<pre style="margin: 0em;">Robin
-----Original Message-----
From: owner-sundials-users@lists.llnl.gov
[<a  href="mailto:owner-sundials-users@lists.llnl.gov">mailto:owner-sundials-users@lists.llnl.gov</a>] On Behalf Of Kai Hartmann
Sent: 12 April 2006 11:07 AM
To: sundials-users@llnl.gov
Subject: Re: [sundials-users] Arbitrary precision for sundials solvers?</pre><br>
<pre style="margin: 0em;">Hi all, hi Radu.</pre><br>
<br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">This alone does not suggest the need for more than extended precision
(or even double precision). I trust you use different absolute
tolerances for different solution components to deal with the
</pre></blockquote><pre style="margin: 0em;"><br>different</pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">orders of magnitude.</pre><br>
<pre style="margin: 0em;">What exactly makes you think that you need more precision? How many
significant digits are you after? What is an acceptable noise level
(absolute tolerance)? Maybe you could tell us a bit about the actual
physical problem you try to solve...
</pre></blockquote><pre style="margin: 0em;"><br>Ok, I will try to describe the problem.</pre><br>
<pre style="margin: 0em;">This is about a system of chemical reactions. Consider the following
hypothetical reactions:</pre><br>
<pre style="margin: 0em;">(1) A &lt;-&gt; B  g=-100
(2) B &lt;-&gt; C  g=50</pre><br>
<pre style="margin: 0em;">The flux through each reaction in this system is given by</pre><br>
<pre style="margin: 0em;">f = -ln(Product/Educt) - g</pre><br>
<pre style="margin: 0em;">resulting in the following differential equations</pre><br>
<pre style="margin: 0em;">dA/dt = -f(1) = ln(B/A) - 100
dB/dt = f(1) - f(2) = -ln(B/A) +100 +ln(C/B) +50 = ln((A*C)/B^2) +150
dC/dt = f(2) = -ln(C/B) - 50</pre><br>
<pre style="margin: 0em;">Because of the nature of the equation (logarithmic), I think I cannot
give an absolute tolerance. When I experimented with it in the past, I
got negative and/or complex numbers as solution (and the solver stops).
So I always set it to the lowest possible value. The relative tolerance
can be moderate (10^-3 to 10^-6).</pre><br>
<pre style="margin: 0em;">I hope this does make some sense ...</pre><br>
<pre style="margin: 0em;">Thanks for your help,</pre><br>
<pre style="margin: 0em;">Kai</pre><br>
----------------------------------------------------------------------------<br>
NOTICE: Please note that this eMail, and the contents thereof, 
is subject to the standard Sasol eMail legal notice which may be found at: 
<a  href="http://www.sasol.com/legalnotices">http://www.sasol.com/legalnotices</a>                                                                                                          <br>
<br>
If you cannot access the legal notice through the URL attached and you wish 
to receive a copy thereof please send an eMail to 
legalnotice@sasol.com<br>
----------------------------------------------------------------------------<br>
<br>
</blockquote><pre style="margin: 0em;"><br></pre><br>
<br>
</blockquote><pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">--
   Radu Serban
   Center for Applied Scientific Computing   [email] radu@llnl.gov
   Lawrence Livermore National Laboratory    [phone] 925-424-4852
   P.O. Box 808, L-560                       [fax]   925-422-6287
   Livermore, CA 94551</pre><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00434" href="msg00434.html">RE: [sundials-users] Arbitrary precision for sundials solvers?</a></strong>
<ul><li><em>From:</em> &quot;Jordi, Robin (RG)&quot; &lt;robin.jordi@sasol.com&gt;</li></ul></li>
<li><strong><a name="00435" href="msg00435.html">Re: [sundials-users] Arbitrary precision for sundials solvers?</a></strong>
<ul><li><em>From:</em> Kai Hartmann &lt;Kai.Hartmann@uni-koeln.de&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00435.html">Re: [sundials-users] Arbitrary precision for sundials solvers?</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00437.html">Re: [sundials-users] coordinate projection with CVODE</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00435.html">Re: [sundials-users] Arbitrary precision for sundials solvers?</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00421.html">[sundials-users] coordinate projection with CVODE</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00436">
<strong>Main</strong></a></li>
<li><a href="threads.html#00436">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
