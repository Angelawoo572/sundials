<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [sundials&#45;users] sensitivity in iterative runs -->
<!--X-From-R13: Dnqh Ereona <enqhNyyay.tbi> -->
<!--X-Date: Tue, 29 Aug 2006 09:10:58 &#45;0700 -->
<!--X-Message-Id: 44F4669A.7040002@llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: Pine.LNX.4.62.0608291643450.8910@mescalin.tbi.univie.ac.at -->
<!--X-Head-End-->
<html>
<head>
<title>Re: [sundials-users] sensitivity in iterative runs</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00642.html">Date Prev</a>] [<a href="msg00644.html">Date Next</a>] [<a href="msg00642.html">Thread Prev</a>] [<a href="msg00644.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00643">Date Index</a></b>]
[<b><a href="threads.html#00643">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sundials-users] sensitivity in iterative runs</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Radu Serban &lt;<a href="mailto:radu%40llnl.gov">radu@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Tue, 29 Aug 2006 09:08:58 -0700</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Rainer,</pre><br>
I cannot duplicate such problems. I suspect you miss something in the 
reinitialization. For example, are you certain that you correctly set the 
initial conditions for the sensitivity variables before calling CvodeSensReInit? 
Make sure you do not reuse the same variable to also extract the sensitivities 
after a previous return from CVode (by calling CVodeGetSens).<br>
<br>
<pre style="margin: 0em;">--Radu</pre><br>
<pre style="margin: 0em;">P.S. Maybe you could post the relevant portion of your main function.</pre><br>
Rainer Machne wrote:
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">Dear Sundials users/developers,</pre><br>
<pre style="margin: 0em;"><br>In our software we use the ReInit functions of both CVode and CVodeSens
(version 2.1.1) to run arbitrary numbers of integration runs.</pre><br>
We get however different sensitivities s(x(t)) with each run, even if we 
don't change any parameters or initial conditions, i.e. with exactly the 
same model, for which CVode also returns the same results x(t).<br>
<br>
I have tried different combinations of using either ReInit or a 
completely new creation of cvode solver structures.<br>
<br>
 Both,<br>
a) freeing and recreating the sensitivity structures with 
N_VNewVectorArray_Serial and CVodeSensMalloc or<br>
b) reinitializing these structures with CVodeSensReInit<br>
produce wrong results. The results are different from each other, though.<br>
<br>
In the CVodeSensReInit case, the results look somehow `more correct':<br>
e.g. two variables with exactly opposite sensitivities (x/-) to one 
parameter stay this way for iterative runs, although with different values.<br>
<br>
Here some results for the same output time (3.0) and different 
iterations, sensitivities of two variables to the same parameter:<br>
<br>
<pre style="margin: 0em;">both cases:
 1st run:   0.0323545 -0.0323545</pre><br>
<pre style="margin: 0em;">a) destroying and recreating CVodeSens structures:
 2nd run:   0.0386666 -2.81625
10th run:   0.0228166 -14.0761</pre><br>
<pre style="margin: 0em;">b) using CVodeSensReInit:
 2nd run:   0.0640767 -0.0640767
10th run:   0.294778 -0.294778</pre><br>
<pre style="margin: 0em;">The results x(t) are the same for all cases, i.e. 87.2221 and 12.7779.
The parameter towards which sensitivity is tested has the value 10.</pre><br>
Note, that the symmetry is kept when using ReInit, while one sensitivity 
is growing much bigger for the destroy/create case.<br>
<br>
<br>The only way to get consistent results is to destroy and recreate the 
whole CVode solver structures with CVodeCreate.<br>
<br>
Could this be a bug in SUNDIALS or do you see any hints what we might do 
wrong in our software from above results??<br>
If it's a bug in Sundials, I guess it must be some structure in the 
CVode forward solver that is important for CVodeSens but created 
independently of the latter. ??<br>
<br>
Sorry, if this has been brought up and discussed before, I didn't find 
the email archives online.<br>
<br>
<pre style="margin: 0em;">Thanks,
Rainer Machne</pre><br>
<pre style="margin: 0em;"><br>Theoretical Biochemistry Group
Department for Theoretical Chemistry
University of Vienna
Austria/Europe</pre><br>
</blockquote><pre style="margin: 0em;"><br></pre><br>
<br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00644" href="msg00644.html">Re: [sundials-users] sensitivity in iterative runs</a></strong>
<ul><li><em>From:</em> Rainer Machne &lt;raim@tbi.univie.ac.at&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00642" href="msg00642.html">[sundials-users] sensitivity in iterative runs</a></strong>
<ul><li><em>From:</em> Rainer Machne &lt;raim@tbi.univie.ac.at&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00642.html">[sundials-users] sensitivity in iterative runs</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00644.html">Re: [sundials-users] sensitivity in iterative runs</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00642.html">[sundials-users] sensitivity in iterative runs</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00644.html">Re: [sundials-users] sensitivity in iterative runs</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00643">
<strong>Main</strong></a></li>
<li><a href="threads.html#00643">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
