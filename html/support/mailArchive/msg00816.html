<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [sundials&#45;users] Stiff ODE solution is slow? -->
<!--X-From-R13: Uertbel [nfba <tertoevpxznfbaNlnubb.pbz> -->
<!--X-Date: Wed, 06 Dec 2006 16:28:40 &#45;0800 -->
<!--X-Message-Id: 20061206234813.76148.qmail@web58413.mail.re3.yahoo.com -->
<!--X-Content-Type: multipart/mixed -->
<!--X-Derived: binuSwS1exgij.bin -->
<!--X-Head-End-->
<html>
<head>
<title>Re: [sundials-users] Stiff ODE solution is slow?</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00815.html">Date Prev</a>] [<a href="msg00817.html">Date Next</a>] [<a href="msg00815.html">Thread Prev</a>] [<a href="msg00825.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00816">Date Index</a></b>]
[<b><a href="threads.html#00816">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sundials-users] Stiff ODE solution is slow?</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Gregory Mason &lt;<a href="mailto:gregbrickmason%40yahoo.com">gregbrickmason@yahoo.com</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Wed, 6 Dec 2006 15:48:13 -0800 (PST)</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<div style="font-family:times new roman, new york, times, serif;font-size:12pt"><DIV style="FONT-SIZE: 12pt; FONT-FAMILY: times new roman, new york, times, serif">Hi There</DIV>
<DIV style="FONT-SIZE: 12pt; FONT-FAMILY: times new roman, new york, times, serif">&nbsp;Thanks for your prompt response. In continuation with the discussion, I am attaching with this mail a .doc file showing the matrix A in Y'=AY. In the first table, there are four colored blocks, say M1, M2, M3 and M4 corresponding to different states which are being calculated.Matrix M1 is same as M3 in topology though Y' equations are different. And their relation to M4 is also same, meaning that ith element of M4 relates to nth element of both M1 and M3. Also maximum number of non diagonal terms for any Y in M1 and M3 can be 4, for M2 it is 0 and for M4 it can be 2. Size of M1, M2 and M3 are same. The&nbsp; real problem which i am solving looks similar to what I have shown in this 36x36 matrix.The y_dot equation which I wrote about last time is acutally not linear. I was just trying to give a sense of the relative magnitude of y_dot values. The actual y_dot values for y in M1 is 0 to
 10^8, M2 is 0 to 10^1, M3 is 0 to 10^2 and M4 is 0 to 10^4. Meanwhile I did try CVBANDPRE earlier. It was my mistake that i mentioned it as CVBDDPRE in last mail. And for CVBANDPRE, the solver gave "nan" value for few state variable before blowing up though it was working ok without preconditioner. Also I didn't have any idea about what value of mu and ml should be taken. <BR>&nbsp;The second table shows the statistics obtained from solver run. They have been obtained uptill t = 18000. Simulation for first 18000 runs in 30 min and the rest 18000 in 5 hrs 30 min. <BR>&nbsp;Seems like I will have to go through Dr. Hindmarsh's paper on preconditioners before I make any foray here.. </DIV>
<DIV style="FONT-SIZE: 12pt; FONT-FAMILY: times new roman, new york, times, serif">Regards<BR>Greg</DIV>
<DIV style="FONT-SIZE: 12pt; FONT-FAMILY: times new roman, new york, times, serif">p.s-&gt; Btw, while trying to calculate 2nd derivative I used CVodeGetDky(cvode_mem,t,2,Y_other). But when I try to print NV_Ith_S(Y_other, i) I dont' get the expected value. How should I access Y_other vector?&nbsp;</DIV>
<DIV style="FONT-SIZE: 12pt; FONT-FAMILY: times new roman, new york, times, serif"><BR><BR>&nbsp;</DIV>
<DIV style="FONT-SIZE: 12pt; FONT-FAMILY: times new roman, new york, times, serif">----- Original Message ----<BR>From: Alan Hindmarsh &lt;alanh@llnl.gov&gt;<BR>To: Gregory Mason &lt;gregbrickmason@yahoo.com&gt;<BR>Cc: sundials-users@llnl.gov; alanh@llnl.gov<BR>Sent: Wednesday, December 6, 2006 5:33:30 PM<BR>Subject: Re: [sundials-users] Stiff ODE solution is slow?<BR><BR>
<DIV>Hi Gregory,<BR><BR>I agree with Radu's answers to your latest quesions.&nbsp;&nbsp;In summary: run<BR>serial, use Newton-Krylov, but use a preconditioner.&nbsp;&nbsp;I strongly<BR>suspect that a banded preconditioner which includes the banded part of<BR>the RHS coefficient matrix will work well.&nbsp;&nbsp;The Krylov iterations take<BR>care of what that does not include.<BR><BR>Also: stiffness is charactarized by a large value of the ratio<BR>&nbsp;&nbsp;(time span of interest) / (smallest decay time constant)<BR>If you just remove equations like y' = -ky with small k, the stiffness<BR>does not change at all, because you have not changed either the large k's<BR>or the time span.<BR><BR>-Alan H<BR><BR><BR>On Mon, 4 Dec 2006, Gregory Mason wrote:<BR><BR>&gt; Hi There<BR>&gt;&nbsp;&nbsp;I have few questions...<BR>&gt;&nbsp;&nbsp; I have a set of stiff ODEs. THe RHS matrix is sparse but is not<BR>&gt;banded. Infact assuming that I have 4000 ODEs to solve......if I use
 only<BR>&gt;3500 of them, they do form a sparse banded matrix. Other relevant<BR>&gt;information regarding the ODEs: If I write them in form of y' = -ky, k<BR>&gt;for 1000 of them(odes) is ~ 10^6, while for the rest of them it is<BR>&gt;~10^-1. All the ("y")s vary between 0 to 10. And the tolerances I am<BR>&gt;setting is a scaler abs tolerance of 10^-4 and and rel. tolerance of<BR>&gt;10^-3. Now for solving this system, on a 2.5 gHZ machine, it takes 6 hrs<BR>&gt;to go from t =0 to t =30000. I was wondering if this is the average<BR>&gt;computational time for solving this a set of stiff ODEs this big. Because<BR>&gt;for my needs, its still quite slow. If this is what is expected, then<BR>&gt;perhaps I have two choices: i) Use of preconditioner ii) Parallelizing<BR>&gt;the code. I forgot to mention that I am running the the code using<BR>&gt;Newton_Krylov solver. Btw, When I try to plot the internal time steps<BR>&gt;taken by the<BR>&gt;solver, I see that for initial few
 time steps (t&lt;100) it took relatively larger time steps starting with an initial time step provided by me, however after that its decreasing exponentially (almost) uptill I ran the simulations to.<BR>&gt; Since I dont' have any prior experience with the preconditioners, I<BR>&gt;tried to incorporate CVBDDPRE (the default banded precond). But the code<BR>&gt;which works ok (but slow) without the preconditioners starts generating<BR>&gt;"nan" values just after few time steps (t&lt;50). In the code, all -ve<BR>&gt;values are temporarily set to 0 in the f() function.<BR>&gt; Can some please suggest some ways to make the code run faster. Is the<BR>&gt;selection of my tolerances ok. What kind of experiment should I do to<BR>&gt;derive a preconditioner and what might be the possible cause of failure<BR>&gt;of BDDPRE. And, can someone also give me a rough estimate of how much<BR>&gt;computational time i can save using the preconditioner with krylov solver<BR>&gt;which will help
 me in prioritizing my subsequent work in terms of<BR>&gt;parallelizing the code or developing a preconditioner.<BR>&gt;Regards<BR>&gt;Greg<BR>&gt;p.s-&gt; Also, once I tried to set of the slower variables (with smaller k)<BR>&gt;by putting y'=0 for all of them. And I presumed that<BR>&gt;this will essentially mean that the solver will be solving only ODEs with<BR>&gt;large k and then the system should not remain stiff , which should<BR>&gt;eventually lead to drastic decrease in solver time. But this didn't<BR>&gt;happened. Any explanation?</DIV></DIV>
<DIV style="FONT-SIZE: 12pt; FONT-FAMILY: times new roman, new york, times, serif"><BR></DIV></div><br>

<hr size=1>Check out <a href="http://us.rd.yahoo.com/evt=43257/*http://advision.webevents.yahoo.com/mailbeta">the all-new Yahoo! Mail beta</a> - Fire up a more powerful email and get things done faster.<p><strong>Attachment:
<a href="binuSwS1exgij.bin" ><tt>Matrix_Stats.doc</tt></a></strong><br>
<em>Description:</em> Binary data</p>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00825" href="msg00825.html">Re: [sundials-users] Stiff ODE solution is slow?</a></strong>
<ul><li><em>From:</em> Alan Hindmarsh &lt;alanh@llnl.gov&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00815.html">Re: [sundials-users] Stiff ODE solution is slow?</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00817.html">Re: [sundials-users] Re: (IDACalcIC failure)</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00815.html">Re: [sundials-users] Stiff ODE solution is slow?</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00825.html">Re: [sundials-users] Stiff ODE solution is slow?</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00816">
<strong>Main</strong></a></li>
<li><a href="threads.html#00816">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
