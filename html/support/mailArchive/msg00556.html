<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [sundials&#45;users] Re: problem in running the parallel fortran example -->
<!--X-From-R13: Dnqh Ereona <enqhNyyay.tbi> -->
<!--X-Date: Thu, 29 Jun 2006 13:43:44 &#45;0700 -->
<!--X-Message-Id: 44A43AC0.9020208@llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 449FF72D.1050304@eas.iis.fraunhofer.de -->
<!--X-Reference: 44A0044E.7030404@llnl.gov -->
<!--X-Reference: Pine.GSO.4.61.0606271654400.15344@techunix.technion.ac.il -->
<!--X-Reference: 44A2A676.2010000@llnl.gov -->
<!--X-Head-End-->
<html>
<head>
<title>Re: [sundials-users] Re: problem in running the parallel fortran example</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00555.html">Date Prev</a>] [<a href="msg00557.html">Date Next</a>] [<a href="msg00555.html">Thread Prev</a>] [<a href="msg00557.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00556">Date Index</a></b>]
[<b><a href="threads.html#00556">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sundials-users] Re: problem in running the parallel fortran example</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Radu Serban &lt;<a href="mailto:radu%40llnl.gov">radu@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Thu, 29 Jun 2006 13:40:32 -0700</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Dear Rachel,</pre><br>
<pre style="margin: 0em;">First of all, please post to the sundials-users mailing list.</pre><br>
The mpich libraries that you use were built with the Absoft compilers but you use gcc/g77 to build SUNDIALS. The reason for which you had to 
modify the example source is that the Fortran name mangling scheme is different for the two Fortran compilers. I suggest you either use an 
mpipch installation built with gcc (if you already have one available), or else specify the Absoft compilers when you configure SUNDIALS. 
That should take care of all build errors and may also resolve the run-time error (I am pretty confident that using GNU compilers throughout 
will work. If I have some time later today, I'll try to build mpich with Absoft myself and try the second option.)<br>
<br>
<pre style="margin: 0em;">--Radu</pre><br>
<pre style="margin: 0em;">Rachel Gordon wrote:</pre><br>
<pre style="margin: 0em;">&gt; Dear Radu,
&gt;
&gt; Thank you very much for your prompt reply.
&gt;
&gt; The cluster I am running on is a 16 PC Xeon 2.8Gh machine. I guess that your 
machine is based on Itanium PC's.
&gt;
&gt; I just installed kinsol, so I didn't try the parallel fortran examples 
cvode,ida. I can install the other codes if needed.
&gt;
&gt; Here is the history of my installation of kinsol:
&gt;
&gt; I tried first:
&gt;
&gt; ./configure CC=gcc  F77=g77 --with-mpi-root=/opt/mpich-1.2.4  FFLAGS=&quot;-g -O2 
-ffloat-store&quot;
&gt;
&gt; The command:  make examples gave:
&gt;
&gt; make[1]: Entering directory 
`/home/people/rgordon/Kinsol.dir/sundials/kinsol/fcmix/examples_par'
&gt; Updating fkinkryx_p.f...
&gt;
&gt; /opt/mpich-1.2.4/bin/mpif77  -I/opt/mpich-1.2.4/include -g -O2 -ffloat-store 
-c ./fkinkryx_p-updated.f
&gt;
&gt; Error: bad option:  -ffloat-store
&gt; make[1]: *** [fkinkryx_p] Error 1
&gt; make[1]: Leaving directory 
`/home/people/rgordon/Kinsol.dir/sundials/kinsol/fcmix/examples_par'
&gt;
&gt;
&gt;
&gt;
&gt; Then I tried:
&gt; ./configure CC=gcc  F77=g77 --with-mpi-root=/opt/mpich-1.2.4  FFLAGS=&quot;-g -O2&quot;
&gt;
&gt; Which resulted:
&gt;
&gt; Making examples in kinsol/fcmix/examples_par...
&gt; make[1]: Entering directory 
`/home/people/rgordon/Kinsol.dir/sundials/kinsol/fcmix/examples_par'
&gt; Updating fkinkryx_p.f...
&gt; /opt/mpich-1.2.4/bin/mpif77  -I/opt/mpich-1.2.4/include -g -O2 -c 
./fkinkryx_p-updated.f
&gt; FORTRAN 77 Compiler 8.0, Copyright (c) 1987-2002, Absoft Corp.
&gt;  error on line 64 of ./fkinkryx_p-updated.f: data type is undefined for 
variable mpi_comm_world
&gt;
&gt; make[1]: *** [fkinkryx_p] Error 1
&gt; make[1]: Leaving directory 
`/home/people/rgordon/Kinsol.dir/sundials/kinsol/fcmix/examples_par'
&gt;
&gt;
&gt;
&gt; To fix this I changed in fkinkryx_p.f   mpi_comm_world to  MPI_COMM_WORLD
&gt; and did again:
&gt;
&gt; ./configure CC=gcc  F77=g77 --with-mpi-root=/opt/mpich-1.2.4  FFLAGS=&quot;-g -O2&quot;
&gt;
&gt; Then on:   make examples
&gt; I got:
&gt;
&gt; Making examples in kinsol/fcmix/examples_par...
&gt; make[1]: Entering directory 
`/home/people/rgordon/Kinsol.dir/sundials/kinsol/fcmix/examples_par'
&gt; Updating fkinkryx_p.f...
&gt; /opt/mpich-1.2.4/bin/mpif77  -I/opt/mpich-1.2.4/include -g -O2 -c 
./fkinkryx_p-updated.f
&gt; FORTRAN 77 Compiler 8.0, Copyright (c) 1987-2002, Absoft Corp.
&gt;  /opt/mpich-1.2.4/bin/mpif77 -o ./fkinkryx_p ./fkinkryx_p-updated.o  -g -O2  
-L/home/people/rgordon/Kinsol.dir/sundials/lib
&gt; -lsundials_fkinsol -lsundials_kinsol -lsundials_fnvecparallel 
-lsundials_nvecparallel -L/opt/mpich-1.2.4/lib  -lm
&gt; -L/usr/lib/gcc-lib/i386-redhat-linux/2.96 
-L/usr/lib/gcc-lib/i386-redhat-linux/2.96/../../.. -lg2c -lm
&gt; ./fkinkryx_p-updated.o: In function `main':
&gt; ./fkinkryx_p-updated.f:57: undefined reference to `mpi_init'
&gt; ./fkinkryx_p-updated.f:64: undefined reference to `fnvinitp'
&gt; ./fkinkryx_p-updated.f:68: undefined reference to `mpi_finalize'
&gt; ./fkinkryx_p-updated.f:72: undefined reference to `mpi_comm_size'
&gt; ./fkinkryx_p-updated.f:76: undefined reference to `mpi_abort'
&gt; ./fkinkryx_p-updated.f:83: undefined reference to `mpi_finalize'
&gt; ./fkinkryx_p-updated.f:88: undefined reference to `mpi_comm_rank'
&gt; ./fkinkryx_p-updated.f:92: undefined reference to `mpi_abort'
&gt; ./fkinkryx_p-updated.f:106: undefined reference to `fkinmalloc'
&gt; ./fkinkryx_p-updated.f:111: undefined reference to `mpi_abort'
&gt; ./fkinkryx_p-updated.f:115: undefined reference to `fkinsetiin'
&gt; ./fkinkryx_p-updated.f:116: undefined reference to `fkinsetrin'
&gt; ./fkinkryx_p-updated.f:117: undefined reference to `fkinsetrin'
&gt; ./fkinkryx_p-updated.f:118: undefined reference to `fkinsetvin'
&gt; ./fkinkryx_p-updated.f:120: undefined reference to `fkinspgmr'
&gt; ./fkinkryx_p-updated.f:121: undefined reference to `fkinspilssetprec'
&gt; ./fkinkryx_p-updated.f:130: undefined reference to `fkinsol'
&gt; ./fkinkryx_p-updated.f:135: undefined reference to `mpi_abort'
&gt; ./fkinkryx_p-updated.f:158: undefined reference to `fkinfree'
&gt; ./fkinkryx_p-updated.f:162: undefined reference to `mpi_finalize'
&gt; collect2: ld returned 1 exit status
&gt;
&gt; make[1]: *** [fkinkryx_p] Error 1
&gt; make[1]: Leaving directory 
`/home/people/rgordon/Kinsol.dir/sundials/kinsol/fcmix/examples_par'
&gt;
&gt;
&gt;
&gt; Then  I replaced the names of the MPI routines to:
&gt;         mpi_init      to:   MPI_Init
&gt;         mpi_finalize  to:   MPI_Finalize    and so on,
&gt;
&gt; This eliminated the error messages about the MPI routine but still the error 
messages about fkinmalloc and fnvinitp
&gt; fkinsetiin ... remained.
&gt;
&gt; To get rid of this error I run:
&gt;
&gt; ./configure CC=gcc F77=g77 --with-mpi-root=/opt/mpich-1.2.4  FFLAGS=&quot;-g -O2&quot; 
--with-f77underscore=none
&gt;
&gt; With this change I managed to get the executable  fkinkryx_p*.
&gt; However this executable resulted the:
&gt;
&gt;  &quot;Segmentation fault      (core dumped) ....&quot;  error message.
&gt;
&gt;
&gt; Thanks again for your help
&gt;
&gt; Sincerely,
&gt; Rachel
&gt;
&gt;
&gt;   Dr.  Rachel Gordon
&gt;   Senior Research Associate        Phone: +972-4-8293811
&gt;   Dept. of Aerospace Eng.        Fax:   +972 - 4 - 8292030
&gt;   The Technion, Haifa 32000, Israel     email: rgordon@tx.technion.ac.il
&gt;
&gt;
&gt; On Wed, 28 Jun 2006, Radu Serban wrote:
&gt;
&gt;&gt; Hi Rachel,
&gt;&gt;
&gt;&gt; I have no problem running any of the fcmix parallel examples using 
mpich-1.2.4 (under Red Hat Enterprise Linux WS release 3 (Taroon
&gt;&gt; Update 6)). You should not have to make any modifications to the sources as 
Fortran is case insensitive. I am quite baffled by this,
&gt;&gt; especially since you say the serial Fortran examples work (otherwise, I 
would have guessed a problem with the name mangling scheme).
&gt;&gt;
&gt;&gt; Do you have similar problems with all the other parallel Fortran examples 
(cvode, ida)?
&gt;&gt; What are the compilation commands executed for 'make examples'. In my case 
they are:
&gt;&gt;
&gt;&gt; Making examples in kinsol/fcmix/examples_par...
&gt;&gt; make[1]: Entering directory 
`/home/radu/CODES/TEST/sundials/kinsol/fcmix/examples_par'
&gt;&gt; Updating fkinkryx_p.f...
&gt;&gt; /usr/apps/mpich/1.2.4/bin/mpif77  -I/usr/apps/mpich/1.2.4/bin/../include -g 
-O2 -ffloat-store -c ./fkinkryx_p-updated.f
&gt;&gt; /usr/apps/mpich/1.2.4/bin/mpif77 -o ./fkinkryx_p ./fkinkryx_p-updated.o  -g 
-O2 -ffloat-store  -L/home/radu/CODES/TEST/sundials/lib
&gt;&gt; -lsundials_fkinsol -lsundials_kinsol -lsundials_fnvecparallel 
-lsundials_nvecparallel -L/usr/apps/mpich/1.2.4/bin/../lib  -lm
&gt;&gt; -L/usr/lib/gcc-lib/i386-redhat-linux/3.2.3 
-L/usr/lib/gcc-lib/i386-redhat-linux/3.2.3/../../.. -lfrtbegin -lg2c -lm -lgcc_s
&gt;&gt; make[1]: Leaving directory 
`/home/radu/CODES/TEST/sundials/kinsol/fcmix/examples_par'
&gt;&gt;
&gt;&gt;
&gt;&gt; --Radu
&gt;&gt;
&gt;&gt;
&gt;&gt; P.S. I cc-ed the sundials-users mailing list on this message. Please post 
sundials-related questions there as you may get more
&gt;&gt; help from other users.
&gt;&gt;
&gt;&gt;
&gt;&gt; Rachel Gordon wrote:
&gt;&gt;
&gt;&gt;&gt; Dear Radu,
&gt;&gt;&gt;
&gt;&gt;&gt; I installed Kinsol on my Linux cluster (running under Red Hat Linux release 
7.3 (Valhalla) ). I tried the c examples (serial and
&gt;&gt;&gt; parallel) and the serial fortran example and they all run fine. However 
when I try the parallel fortran example fkinkryx_p, I get
&gt;&gt;&gt; an error message:
&gt;&gt;&gt;
&gt;&gt;&gt; /opt/mpich-1.2.4/bin/mpirun: line 1: 24308 Segmentation fault      (core 
dumped) /home/people/...
&gt;&gt;&gt;
&gt;&gt;&gt; I already changed  in the original file:
&gt;&gt;&gt;    mpi_comm_world   to:  MPI_COMM_WORLD
&gt;&gt;&gt;
&gt;&gt;&gt; and the names of the mpi routines:
&gt;&gt;&gt;    mpi_init(ier)     to: MPI_Init(ier),
&gt;&gt;&gt;    mpi_finalize(ier) to: MPI_Finalize(ier),
&gt;&gt;&gt;    mpi_abort(..  )   to: MPI_Abort(.. ), and so on.
&gt;&gt;&gt;
&gt;&gt;&gt; This enabled creation  of the executable file fkinkryx_p*, but on running 
it with: mpirun -np 4 fkinkryx_p    I get the above
&gt;&gt;&gt; error message.
&gt;&gt;&gt;
&gt;&gt;&gt; What did I do wrong?
&gt;&gt;&gt;
&gt;&gt;&gt; Thanks for your cooperation,
&gt;&gt;&gt;
&gt;&gt;&gt; Sincerely,
&gt;&gt;&gt; Rachel
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;   Dr.  Rachel Gordon
&gt;&gt;&gt;   Senior Research Associate        Phone: +972-4-8293811
&gt;&gt;&gt;   Dept. of Aerospace Eng.        Fax:   +972 - 4 - 8292030
&gt;&gt;&gt;   The Technion, Haifa 32000, Israel     email: rgordon@tx.technion.ac.il
&gt;&gt;&gt;</pre><br>
<br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00559" href="msg00559.html">Re: [sundials-users] Re: problem in running the parallel fortran example</a></strong>
<ul><li><em>From:</em> Rachel Gordon &lt;rgordon@techunix.technion.ac.il&gt;</li></ul></li>
<li><strong><a name="00557" href="msg00557.html">Re: [sundials-users] Re: problem in running the parallel fortran example</a></strong>
<ul><li><em>From:</em> &quot;Daniel R. Reynolds&quot; &lt;drreynolds@ucsd.edu&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00545" href="msg00545.html">[sundials-users] Problems with IDACalcIC()</a></strong>
<ul><li><em>From:</em> Jens Bastian &lt;Jens.Bastian@eas.iis.fraunhofer.de&gt;</li></ul></li>
<li><strong><a name="00548" href="msg00548.html">Re: [sundials-users] Problems with IDACalcIC()</a></strong>
<ul><li><em>From:</em> Radu Serban &lt;radu@llnl.gov&gt;</li></ul></li>
<li><strong><a name="00555" href="msg00555.html">[sundials-users] Re: problem in running the parallel fortran example</a></strong>
<ul><li><em>From:</em> Radu Serban &lt;radu@llnl.gov&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00555.html">[sundials-users] Re: problem in running the parallel fortran example</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00557.html">Re: [sundials-users] Re: problem in running the parallel fortran example</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00555.html">[sundials-users] Re: problem in running the parallel fortran example</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00557.html">Re: [sundials-users] Re: problem in running the parallel fortran example</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00556">
<strong>Main</strong></a></li>
<li><a href="threads.html#00556">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
