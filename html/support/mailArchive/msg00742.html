<!-- MHonArc v2.6.10 -->
<!--X-Subject: [sundials&#45;users] Kinsol test case &#45; first impression of a 'newbie' user... -->
<!--X-From-R13: "Oaqernf @vpbynv" <Oaqernf.@vpbynvNtzk.arg> -->
<!--X-Date: Sat, 21 Oct 2006 15:34:57 &#45;0700 -->
<!--X-Message-Id: op.thsl9rm1t8lo91@helium -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<html>
<head>
<title>[sundials-users] Kinsol test case - first impression of a 'newbie' user...</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00741.html">Date Prev</a>] [<a href="msg00743.html">Date Next</a>] [<a href="msg00732.html">Thread Prev</a>] [<a href="msg00744.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00742">Date Index</a></b>]
[<b><a href="threads.html#00742">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>[sundials-users] Kinsol test case - first impression of a 'newbie' user...</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
&quot;Andreas Nicolai&quot; &lt;<a href="mailto:Andreas.Nicolai%40gmx.net">Andreas.Nicolai@gmx.net</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Sat, 21 Oct 2006 18:33:17 -0400</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi there,</pre><br>
while trying to solve a chemical equilibrium problem I thought, why not  
try KINSOL, after using CVODE successfully for a while already. Maybe I  
can report my use-case and the minor problems/difficulties I had along the  
way.<br>
<br>
Now, the problem I want to solve is rather simple: calculate chemical  
equlibrium while considering the species H2O, Na(+), Cl(-), NaCl and  
NaCl.2H2O.<br>
The function for F(u) = 0 is easy enough (using solubility constants and  
some activity model) and then got to the KINSOL solver setup.<br>
<br>
I started looking through the documentation for Kinsol and at the given  
skeleton program. The first minor problem I had was that the documentation  
didn't specify the actual data types that the functions return (this  
information can be easily found in the header file or further down in the  
documentation, but<br>
writing the code example lines in the style:<br>
<br>
<pre style="margin: 0em;">N_Vector    u      = N_VMake_Serial(n, udata);
void *      kinMem = KINCreate();
int         flag   = KINMalloc(...);</pre><br>
<pre style="margin: 0em;">would make things just a little bit easier).</pre><br>
Setting up the linear solver module was easy enough (I started with  
KINDense), but the actual call to KINSol gave me problems at first. The  
vectors uscale and fscale are documented alright, but as a newbie to the  
problem I had no idea what values to use there (or which values would at  
least not harm the solution). Some comment in the user manual, like &quot;Start  
with unity vectors (all ones) and only adjust if necessary&quot; would help  
here.<br>
<br>
First thing I tried was the KIN_NONE strategy and tried to run the solver.  
My routine got called a few times and by the pertubation of the values I  
could tell it was composing the Jacobian. Now once this was done the  
solver gave the first iterate values which were way outside the scope of  
my solution.<br>
<br>
Just to illustrate that, initial guess was (in mol numbers): 55.05, 10,  
10, 0, 0 for the species listed above.<br>
The first iterate gave the values: 48172, 8678, 8678, 15389, -24058 which  
are of course way off the scale.<br>
<br>
Next I remembered something from the mailing list about imposing  
constraints on the solution. After figuring out that the documentation (is  
still) not quite correct when it comes to the 2.0 and 1.0 constraint flag  
(thankfully there was another mailing list entry already about this), I  
set the constraints<br>
(u[i] &gt;= 0 for all i), and finally I got it to run.<br>
<br>
So, all in all, getting Kinsol to run for a simple equlibrium chemistry  
problem, was a piece of cake. Just for the record, my own handcrafted  
solution took 16 iterations/function evaluations (using a dense matrix  
jacobian), the KINDense solver took 12 function evaluations, and the SPGMR  
solver took only 5 !!!<br>
All in all, nice work (but the documentation could be slightly enhanced).<br>
<br>
<pre style="margin: 0em;">Bye,
Andreas</pre><br>
<pre style="margin: 0em;">--
Andreas Nicolai                         anicolai@syr.edu
PhD Candidate, M.A.M.E                  (315) 443-2641
Syracuse University
151 Link Hall
Syracuse, NY, 13244</pre><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00741.html">Re: [sundials-users] CVodeB and intermediate output</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00743.html">Re: [sundials-users] CVodeB and intermediate output</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00732.html">[sundials-users] calling CVODE from Matlab</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00744.html">[sundials-users] Chemical equilibrium with limitation on the solution...</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00742">
<strong>Main</strong></a></li>
<li><a href="threads.html#00742">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
