<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [sundials&#45;users] Installing/checking sundials 2.1.1 -->
<!--X-From-R13: Dnqh Ereona <freona1Nyyay.tbi> -->
<!--X-Date: Wed, 01 Mar 2006 15:22:19 &#45;0800 (PST) -->
<!--X-Message-Id: 44062C4D.7030904@llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 4ba776c00603010317l2821e22w39fcdc18ca460816@mail.gmail.com -->
<!--X-Head-End-->
<html>
<head>
<title>Re: [sundials-users] Installing/checking sundials 2.1.1</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00328.html">Date Prev</a>] [<a href="msg00330.html">Date Next</a>] [<a href="msg00325.html">Thread Prev</a>] [<a href="msg00350.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00329">Date Index</a></b>]
[<b><a href="threads.html#00329">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sundials-users] Installing/checking sundials 2.1.1</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Radu Serban &lt;<a href="mailto:serban1%40llnl.gov">serban1@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Wed, 01 Mar 2006 15:20:45 -0800</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Hi Christos,</pre><br>
Christos Frouzakis wrote:
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em">I am trying to install sundials on an Opteron cluster with Quadrics 
interconnect using the Portland group compilers.<br>
As there are no Quadrics MPI wrappers for the PGI compiles, I had to 
explicitly define the paths for the include files and libraries. The 
configuration was done with the command<br>
<br>
./configure CC=pgcc CFLAGS=-fast F77=pgf77 FFLAGS=-fast 
--with-mpicc=pgcc --with-mpif77=pgf77 
--with-mpi-incdir=/usr/lib/mpi/include 
--with-mpi-libdir=/usr/lib/mpi/lib --with-mpi-libs=&quot;-lmpifarg -lmpi 
-lelan -g77libs&quot; --with-libs=-lg2c<br>
<br>
The configuration script did not correctly set the mpi include and 
library paths, so the corresponding makefiles were corrected by hand.
</blockquote><br>In the release version, if you want to manually specify the MPI include and lib directories, you need to set --with-mpicc=no and 
--with-mpif77=no, in which case configure will try to link MPI programs with the C and Fortran compilers and using the MPI flags you specify 
(include and lib dir, MPI flags and libraries).<br>
<br>
With your current configure line, the script assumes you are using an MPI script/wrapper which would internally set the appropriate MPI 
include and lib directories. However, to make sure we do not get errors in the Makefiles (&quot;empty&quot; -I flags), if an mpicc script is used, we 
just set MPI_INC_DIR and MPI_LIB_DIR based on the location of mpicc (overwriting any user-specified MPI locations).<br>
<br>
This is the reason why you see the &quot;wrong&quot; MPI_INCDIR and MPI_LIBDIR paths in the generated Makefiles. Since you specified 
--with-mpicc=pgcc, they are path_to_pgcc/../include and path_to_pgcc/../lib, respectively. Correct?<br>
<br>
<pre style="margin: 0em;">This issue has been resolved for the next release (see step 1b below).</pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">The code compiled without any problems, warnings, or errors.</pre><br>
In order to compile the examples, the linker had to be changed from CC 
to F77, but then everything went smoothly.
</blockquote><br>Indeed, in the release version, CC and MPICC are used to link the serial and parallel Fortran examples, respectively. This has been changed 
for the next release (see step 4 below)<br>
<br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em">Unfortunately, when I run the examples I get completely wrong results 
(in comparison to the corresponding *.out files).<br>
After a day of trying with compiler flags and modification of makefiles, 
I ran out of ideas ... Any suggestions?<br>
<br>
</blockquote><br>Which examples are you referring to (all of them?) and what do you mean by 'completely wrong'? It is OK (actually quite likely) to get 
slightly different results (by this I mean within the specified tolerances) on different platforms and using different compilers, especially 
when using any optimization flags (the pgcc/pgf77 -fast flag will turn on level 2 optimization).<br>
<br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">Best,</pre><br>
-Christos Frouzakis
</blockquote><pre style="margin: 0em;"><br></pre><br>
Here's an overview of the MPI-related logic implemented in the SUNDIALS configure script.<br>
I refer here on the current development version which may be slightly different than what is in the released version, but I'd like to open 
this up for discussion in anticipation of the next release.<br>
<br>
<pre style="margin: 0em;">C MPI Tests
-----------</pre><br>
The default behavior is to look for MPI compilation scripts/wrappers (mpicc or similar) which will automatically take care of passing the 
appropriate -I, -L, and -l options required by the MPI program. To overwrite the default behavior, you MUST specify --with-mpicc=no<br>
<br>
<pre style="margin: 0em;">1) If --with-mpicc is not specified, we assume MPICC=mpicc. If it is specified 
to something other than 'no' we use that script name as MPICC.</pre><br>
Next, we test if MPICC exists as a file (we cannot reliably test if it is executable since the '-x' test flag is not portable). If it cannot 
be found, we look into the user's path for it, or we try to use the MPI root directory (if specified).<br>
<br>
a) If we still cannot find it, we give up MPI checking.<br>
b) If we can find it, we just set MPICC and then, ONLY if MPI_INC_DIR and/or MPI_LIB_DIR are empty, to resolve potential Makefile problems, 
we set them to basedir/../include and basedir/../lib, respectively (where basedir is the directory portion of the full pathname of MPICC)<br>
<br>
2) If the configure line contains --with-mpicc=no then we attempt to link MPI programs with the C compiler (optionally specified through CC) 
and using the MPI include and lib directories and the MPI libraries provided by the user. The logic in this case is as follows:<br>
<br>
<pre style="margin: 0em;">a) Search for an MPI implementation
if --with-mpi-incdir is specified, use it as MPI_INCDIR.
else if --with-mpi-root is specified, use it to set MPI_INCDIR by appending 
/include
else give up MPI checking</pre><br>
<pre style="margin: 0em;">b) Search for MPI libraries
if --with-mpi-libdir is specified, use it as MPI_LIBDIR
else use MPI root directory to set MPI_LIBDIR by appending /lib</pre><br>
<pre style="margin: 0em;">c) Check for the MPI libraries
if --with-mpi-libs is not specified give up MPI checking
else we try to link a test program</pre><br>
<pre style="margin: 0em;">In this case, MPICC is the same as CC.</pre><br>
<pre style="margin: 0em;">Fortran MPI Tests
-----------------</pre><br>
If MPI Fortran is needed (based on which, if any, SUNDIALS modules are disabled, on whether Fortran support is enabled/disabled, on whether 
a working serial Fortran compiler was found previously, etc) we perform similar tests to the above ones.<br>
<br>
<pre style="margin: 0em;">In addition, the build system performs the following two tests:</pre><br>
<pre style="margin: 0em;">3) Determine if MPI_Comm_f2c() from MPI-2 is supported so that communicators 
other than MPI_COMM_WORLD can be used in parallel Fortran programs</pre><br>
<pre style="margin: 0em;">4) Determine what should be used to link parallel Fortran examples</pre><br>
<pre style="margin: 0em;">If the MPICC wrapper or compiler (depending on steps 1 and 2 above) is NOT a 
C++ compiler then use MPIF77 to link.
Else, we test if MPICC can link a Fortran parallel example. If yes, we will use 
MPICC to link. If not, we will use MPIF77 to link.</pre><br>
<pre style="margin: 0em;"><br>--Radu</pre><br>
<pre style="margin: 0em;">--
   Radu Serban
   Center for Applied Scientific Computing   [email] radu@llnl.gov
   Lawrence Livermore National Laboratory    [phone] 925-424-4852
   P.O. Box 808, L-560                       [fax]   925-422-6287
   Livermore, CA 94551</pre><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00392" href="msg00392.html">[sundials-users] interpolation</a></strong>
<ul><li><em>From:</em> Ivan Ivanov &lt;smallhare@inbox.ru&gt;</li></ul></li>
<li><strong><a name="00350" href="msg00350.html">Re: [sundials-users] Installing/checking sundials 2.1.1</a></strong>
<ul><li><em>From:</em> Christos Frouzakis &lt;christos.frouzakis@gmail.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00325" href="msg00325.html">[sundials-users] Installing/checking sundials 2.1.1</a></strong>
<ul><li><em>From:</em> Christos Frouzakis &lt;christos.frouzakis@gmail.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00328.html">Re: [sundials-users] value of t during internal steps of CVODE call</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00330.html">RE: [sundials-users] Changing algebraic variables during integration   with IDA</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00325.html">[sundials-users] Installing/checking sundials 2.1.1</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00350.html">Re: [sundials-users] Installing/checking sundials 2.1.1</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00329">
<strong>Main</strong></a></li>
<li><a href="threads.html#00329">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
