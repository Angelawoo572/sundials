<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [sundials&#45;users] CV_TOO_MUCH_WORK -->
<!--X-From-R13: Dnqh Ereona <enqhNyyay.tbi> -->
<!--X-Date: Wed, 14 Jun 2006 14:08:42 &#45;0700 -->
<!--X-Message-Id: 44907A47.3040204@llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 001301c68f8c$ba573a70$3df901a3@PCHEARTBREAK -->
<!--X-Reference: Pine.LNX.4.58.0606141352510.25034@tux64.llnl.gov -->
<!--X-Head-End-->
<html>
<head>
<title>Re: [sundials-users] CV_TOO_MUCH_WORK</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00506.html">Date Prev</a>] [<a href="msg00508.html">Date Next</a>] [<a href="msg00506.html">Thread Prev</a>] [<a href="msg00512.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00507">Date Index</a></b>]
[<b><a href="threads.html#00507">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sundials-users] CV_TOO_MUCH_WORK</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Radu Serban &lt;<a href="mailto:radu%40llnl.gov">radu@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Wed, 14 Jun 2006 14:06:15 -0700</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">I was just composing a reply to Alan G when Alan H's message came through :-)
I only have a couple of things to add:</pre><br>
1. If you really want to disable CV_TOO_MUCH_WORK returns (assuming you have good answers to Alan H's questions), rather than hacking the 
CVODE source code, use LONG_MAX from limits.h for maxsteps.<br>
<br>
2. Could you please post the equations you want to solve (the big picture, both the ODEs and PDEs)? It's not all that clear to me from your 
description how you use CVODE. What's the independent variable in the ODEs?<br>
<br>
<pre style="margin: 0em;">--Radu</pre><br>
Alan Hindmarsh wrote:
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">Hi Alan G-</pre><br>
<pre style="margin: 0em;">1. Re CV_TOO_MUCH_WORK: I agree with Andreas's response.  You do not
want to remove the max-steps check.  It is there for good reason -- to
stop the integration when there is a real error somewhere.  In your
case, it is easy enough to pick a large enough value of mxsteps to
make sure you have only a few (if any) too-much-work returns, and
then just keep calling CVode until you get to your next tout.
(I trust you have good reason for NOT wanting to see the solution
every 500 steps or so.  This is a rare situation.)</pre><br>
<pre style="margin: 0em;">2. Re the ODEs/PDE issue: Again I agree with Andreas.  CVODE and IDA
are heavily used for large PDE systems, which could easily include ODEs.
Finite difference methods yield CVODE problems, while FEM yields IDA
problems.  Either way, the issue then becomes one of careful ordering
of variables, choice of linear solver (usually one of the Krylov
solvers), and preconditioning.  Even so, solution of the fully coupled
system is likely to be more efficient than equivalent multiple
solutions of smaller subproblems (with frequent restarting).  The
hardest part is preconditioning, but that need not be any more than
the combination of all the individual preconditioners (or direct
Jacobians) that you would generate for the subproblems.</pre><br>
<pre style="margin: 0em;">-Alan H</pre><br>
<pre style="margin: 0em;"><br>On Wed, 14 Jun 2006, Alan Garny wrote:</pre><br>
<br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">Hi,</pre><br>
<pre style="margin: 0em;">First and foremost, thanks for such a great library. I use it in my software
and my users are quite impressed with the speed it provides, so well done!</pre><br>
<pre style="margin: 0em;">Second, I have come across a small problem when solving a stiff problem,
which we only want to output the data at a large time interval. This, not
surprisingly, requires lots of steps and, in fact, too many steps, which
means we eventually get a CV_TOO_MUCH_WORK error. I am aware of
CVodeSetMaxNumSteps, but working on different problems, I have no idea as
how many steps may be required. I am therefore thinking of disabling the
code that checks whether we have reached the maximum number of steps (so as
to be equivalent to having no maximum number of steps). Is that
sensible/acceptable?</pre><br>
<pre style="margin: 0em;">While I am at it, I would like to ask about another problem that I have,
though I don't think there is really a solution for it. Basically, I have
lots of what we refer to as virtual cells. Each cell is modelled using a set
of ODEs that allows us to compute the cell's potential. Once we have
determined the new potential of each cell, we then have to solve at least
one PDE that will allow us to determine how much current has to flow between
neighbouring cells.</pre><br>
<pre style="margin: 0em;">I use CVODE to solve the ODEs, while a finite difference technique to solve
the PDE(s). After solving the PDE, I need to update the virtual cells with
their new potential and that's where my problem lies: CVODE has to
reinitialise itself to be useable for the next time step.</pre><br>
<pre style="margin: 0em;">In other words, if I use CVODE for one virtual cell, then the speed I get is
just amazing, but as soon as I want to couple several cells together, then
CVODE proves to be very inefficient (because of the kind of problem I want
to model, I believe).</pre><br>
<pre style="margin: 0em;">Have I, by any chance, overlooked something? Can the kind of problem I am
interested in be solved efficiently using CVODE? If so, then I can still
think of another issue that might be worse investigating: memory
consumption. CVODE is (for obvious reasons) quite memory hungry, but is
there really no way to reduce its memory requirements? At the moment, when
coupling my virtual cells, I use only one CVODE 'object', since I need to
reinitialise everything after every single time step, but if my problem
above can be solved efficiently using CVODE, then I guess I would have to
have one CVODE 'object' per virtual cell, which could be quite inefficient
memory wise.</pre><br>
<pre style="margin: 0em;">Ok, so much for my CV_TOO_MUCH_WORK related issue... :)</pre><br>
<pre style="margin: 0em;">        Cheers, Alan.</pre><br>
<pre style="margin: 0em;">University of Oxford, Department of Physiology, Anatomy &amp; Genetics
Sherrington Building, Parks Road, Oxford, OX1 3PT, England
<a  href="http://noble.physiol.ox.ac.uk/people/agarny/">http://noble.physiol.ox.ac.uk/people/agarny/</a>
</pre></blockquote><pre style="margin: 0em;"><br></pre><br>
</blockquote><pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">--
   Radu Serban
   Center for Applied Scientific Computing   [email] radu@llnl.gov
   Lawrence Livermore National Laboratory    [phone] 925-424-4852
   P.O. Box 808, L-560                       [fax]   925-422-6287
   Livermore, CA 94551</pre><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00499" href="msg00499.html">[sundials-users] CV_TOO_MUCH_WORK</a></strong>
<ul><li><em>From:</em> &quot;Alan Garny&quot; &lt;alan.garny@physiol.ox.ac.uk&gt;</li></ul></li>
<li><strong><a name="00506" href="msg00506.html">Re: [sundials-users] CV_TOO_MUCH_WORK</a></strong>
<ul><li><em>From:</em> Alan Hindmarsh &lt;alanh@llnl.gov&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00506.html">Re: [sundials-users] CV_TOO_MUCH_WORK</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00508.html">RE: [sundials-users] include file directory layout (was: The lighter side of SUNDIALS)</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00506.html">Re: [sundials-users] CV_TOO_MUCH_WORK</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00512.html">RE: [sundials-users] CV_TOO_MUCH_WORK</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00507">
<strong>Main</strong></a></li>
<li><a href="threads.html#00507">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
