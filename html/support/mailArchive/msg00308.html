<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [sundials&#45;users] value of t during internal steps of CVODE call -->
<!--X-From-R13: Dnqh Ereona <freona1Nyyay.tbi> -->
<!--X-Date: Tue, 21 Feb 2006 14:00:24 &#45;0800 (PST) -->
<!--X-Message-Id: 43FB8CEB.2070003@llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20060221175557.8542.qmail@web37011.mail.mud.yahoo.com -->
<!--X-Head-End-->
<html>
<head>
<title>Re: [sundials-users] value of t during internal steps of CVODE call</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00307.html">Date Prev</a>] [<a href="msg00309.html">Date Next</a>] [<a href="msg00328.html">Thread Prev</a>] [<a href="msg00311.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00308">Date Index</a></b>]
[<b><a href="threads.html#00308">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sundials-users] value of t during internal steps of CVODE call</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Radu Serban &lt;<a href="mailto:serban1%40llnl.gov">serban1@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Tue, 21 Feb 2006 13:58:03 -0800</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
raj duffy wrote:
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><br>      I checked and the calls indeed they are coming from Jac evaluation it 
seems. I am using GMRES-BDF solver. Btw if and when there are<br>
internal time divisions and if I print &quot;t&quot; from inside the fuinction f(),<br>
ain't this will show the internal time steps. Basically I want to have some 
flux calculations and check that source volume &gt; CalculatedFlux*(t-ti)<br>
  
Regards<br>
 Raj<br>
<br>
</blockquote><br>When using the GMRES linear solver, Jacobian information comes as J*v products and these are 
evaluated at each solution of the linear system (i.e. at least once per internal step).<br>
This suggests that starting with t~=52 (probably earlier, but can't say from what you've sent) you 
get quite a few convergence failures.<br>
Could you monitor and report this? Use CVodeGetNumNonlinSolvConvFails and CVSpilsGetNumConvFails.<br>
<br>
Secondly, the RHS function may be evaluated at other times than those corresponding to successful 
internal steps (e.g. in case of error test or convergence failures, the step size will be reduced).<br>
<br>
If you want to do the test you mentioned only to evaluate the quality of the simulation, you should 
call CVode in ONE_STEP_MODE and perform the check after a successful return from it, outside f(). If 
you'd like this test to &quot;control&quot; the simulation, then you should do it inside f() at whatever t and 
y CVODE passes to it, but you'll have to wait for the next release of SUNDIALS which will allow you 
to return a 'recoverable failure' from the RHS function in case the test fails.<br>
<br>
<pre style="margin: 0em;">--Radu</pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">*/Radu Serban &lt;serban1@llnl.gov&gt;/* wrote:</pre><br>
<pre style="margin: 0em;">    Hi Raj,</pre><br>
<pre style="margin: 0em;">    Andreas is correct. These all seem to be calls to the RHS function
    made from the DQ internal
    Jacobian approximation function. To verify that, you can monitor the
    number of calls to f() from
    such DQ functions (use CVDenseGetNumRhsEvals or CVBandGetNumRhsEvals
    for the dense or banded linear
    solver module, respe! ctively). Also, these calls to f() are made at
    the same value of t but each with
    slightly perturbed values of the states (print the values of y from
    within f to see that).</pre><br>
<pre style="margin: 0em;">    However, if this is the case, you should see 6 of these calls at the
    first step too (the Jacobian
    function is always called at nsteps=0).</pre><br>
<pre style="margin: 0em;">    Can you monitor and report some of the other solver statistics
    (number of convergence failures,
    error test failures, etc), as well as confirm the linear solver that
    you use?</pre><br>
<pre style="margin: 0em;">    In any case, inside your RHS function, ALWAYS use the value of t
    that is passed as an argument.</pre><br>
<pre style="margin: 0em;">    --Radu</pre><br>
<pre style="margin: 0em;">    raj duffy wrote:
     &gt; Hello
     &gt;
     &gt; When I am printing time t within the for-loop for Cvode with
     &gt; Normal-stepping (denoted by Tsteps) and then inside function f()
     &gt; (denoted by t) I get something like
     &gt;
     &gt; t = 0.000000
     &gt; t = 0.000010
     &gt; t = 0.100010
     &gt; t = 1.100010
     &gt; Tsteps = 1.000000 nsteps 3
     &gt; !
     &gt; t = 2.100010
     &gt; Tsteps = 2.000000 nsteps 4
     &gt;
     &gt; t = 3.100010
     &gt; Tsteps = 3.000000 nsteps 5
     &gt;
     &gt; t = 4.100010
     &gt; Tsteps = 4.000000 nsteps 6
     &gt;
     &gt; ..........................
     &gt; ........................
     &gt; ......................
     &gt;
     &gt; Tsteps = 51.000000 nsteps 53
     &gt;
     &gt; t = 52.100010
     &gt; t = 52.100010
     &gt; t = 52.100010
     &gt; t = 52.100010
     &gt; t = 52.100010
     &gt; t = 52.100010
     &gt; Tsteps = 52.000000 nsteps 54
     &gt;
     &gt; t = 53.100010
     &gt; t = 53.100010
     &gt; &amp;nb! sp;t = 53.100010
     &gt; t = 53.100010
     &gt; t = 53.100010
     &gt; t = 53.100010
     &gt; Tsteps = 53.000000 nsteps 55
     &gt;
     &gt; t = 54.100010
     &gt; t = 54.100010
     &gt; t = 54.100010
     &gt; t = 54.100010
     &gt; t = 54.100010
     &gt; Tsteps = 54.000000 nsteps 56
     &gt;
     &gt; Now interestingly, number of times f function was called (lets
    say after
     &gt; Tsteps=52 ) is 6 however t doesn'! t shows any internal division
    as all
     &gt; the ts' are same. However the cumulative number of steps taken
    only gets
     &gt; increased by one. So what does this multiple calls to f() suggest.I
     &gt; essentially want to use the value to t during the internal time
    steps in
     &gt; the function f().
     &gt;
     &gt; Regards
     &gt;
     &gt; Raj
     &gt;
     &gt;
    ------------------------------------------------------------------------
     &gt;
     &gt; What are the most popular cars? Find out at Yahoo! Autos
     &gt;
     &gt; &gt;</pre><br>
<pre style="margin: 0em;"><br></pre><br>
------------------------------------------------------------------------<br>
Relax. Yahoo! Mail virus scanning 
&lt;<a  href="http://us.rd.yahoo.com/mail_us/taglines/virusall/*http://communications.yahoo.com/features.php?page=221">http://us.rd.yahoo.com/mail_us/taglines/virusall/*http://communications.yahoo.com/features.php?page=221</a>&gt; 
helps detect nasty viruses!
</blockquote><pre style="margin: 0em;"><br></pre><br>
<br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00311" href="msg00311.html">Re: [sundials-users] value of t during internal steps of CVODE call</a></strong>
<ul><li><em>From:</em> raj duffy &lt;raj_duffy@yahoo.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00306" href="msg00306.html">Re: [sundials-users] value of t during internal steps of CVODE call</a></strong>
<ul><li><em>From:</em> raj duffy &lt;raj_duffy@yahoo.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00307.html">Re: [sundials-users] value of t during internal steps of CVODE call</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00309.html">Re: [sundials-users] value of t during internal steps of CVODE call</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00328.html">Re: [sundials-users] value of t during internal steps of CVODE call</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00311.html">Re: [sundials-users] value of t during internal steps of CVODE call</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00308">
<strong>Main</strong></a></li>
<li><a href="threads.html#00308">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
