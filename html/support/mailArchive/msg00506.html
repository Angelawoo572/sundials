<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [sundials&#45;users] CV_TOO_MUCH_WORK -->
<!--X-From-R13: Oyna Vvaqznefu <nynauNyyay.tbi> -->
<!--X-Date: Wed, 14 Jun 2006 13:56:31 &#45;0700 -->
<!--X-Message-Id: Pine.LNX.4.58.0606141352510.25034@tux64.llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 001301c68f8c$ba573a70$3df901a3@PCHEARTBREAK -->
<!--X-Head-End-->
<html>
<head>
<title>Re: [sundials-users] CV_TOO_MUCH_WORK</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00505.html">Date Prev</a>] [<a href="msg00507.html">Date Next</a>] [<a href="msg00501.html">Thread Prev</a>] [<a href="msg00507.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00506">Date Index</a></b>]
[<b><a href="threads.html#00506">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sundials-users] CV_TOO_MUCH_WORK</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Alan Hindmarsh &lt;<a href="mailto:alanh%40llnl.gov">alanh@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Wed, 14 Jun 2006 13:54:03 -0700 (PDT)</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>
Hi Alan G-

1. Re CV_TOO_MUCH_WORK: I agree with Andreas's response.  You do not
want to remove the max-steps check.  It is there for good reason -- to
stop the integration when there is a real error somewhere.  In your
case, it is easy enough to pick a large enough value of mxsteps to
make sure you have only a few (if any) too-much-work returns, and
then just keep calling CVode until you get to your next tout.
(I trust you have good reason for NOT wanting to see the solution
every 500 steps or so.  This is a rare situation.)

2. Re the ODEs/PDE issue: Again I agree with Andreas.  CVODE and IDA
are heavily used for large PDE systems, which could easily include ODEs.
Finite difference methods yield CVODE problems, while FEM yields IDA
problems.  Either way, the issue then becomes one of careful ordering
of variables, choice of linear solver (usually one of the Krylov
solvers), and preconditioning.  Even so, solution of the fully coupled
system is likely to be more efficient than equivalent multiple
solutions of smaller subproblems (with frequent restarting).  The
hardest part is preconditioning, but that need not be any more than
the combination of all the individual preconditioners (or direct
Jacobians) that you would generate for the subproblems.

-Alan H


On Wed, 14 Jun 2006, Alan Garny wrote:

&gt;<i> Hi,</i>
&gt;<i></i>
&gt;<i> First and foremost, thanks for such a great library. I use it in my software</i>
&gt;<i> and my users are quite impressed with the speed it provides, so well done!</i>
&gt;<i></i>
&gt;<i> Second, I have come across a small problem when solving a stiff problem,</i>
&gt;<i> which we only want to output the data at a large time interval. This, not</i>
&gt;<i> surprisingly, requires lots of steps and, in fact, too many steps, which</i>
&gt;<i> means we eventually get a CV_TOO_MUCH_WORK error. I am aware of</i>
&gt;<i> CVodeSetMaxNumSteps, but working on different problems, I have no idea as</i>
&gt;<i> how many steps may be required. I am therefore thinking of disabling the</i>
&gt;<i> code that checks whether we have reached the maximum number of steps (so as</i>
&gt;<i> to be equivalent to having no maximum number of steps). Is that</i>
&gt;<i> sensible/acceptable?</i>
&gt;<i></i>
&gt;<i> While I am at it, I would like to ask about another problem that I have,</i>
&gt;<i> though I don't think there is really a solution for it. Basically, I have</i>
&gt;<i> lots of what we refer to as virtual cells. Each cell is modelled using a set</i>
&gt;<i> of ODEs that allows us to compute the cell's potential. Once we have</i>
&gt;<i> determined the new potential of each cell, we then have to solve at least</i>
&gt;<i> one PDE that will allow us to determine how much current has to flow between</i>
&gt;<i> neighbouring cells.</i>
&gt;<i></i>
&gt;<i> I use CVODE to solve the ODEs, while a finite difference technique to solve</i>
&gt;<i> the PDE(s). After solving the PDE, I need to update the virtual cells with</i>
&gt;<i> their new potential and that's where my problem lies: CVODE has to</i>
&gt;<i> reinitialise itself to be useable for the next time step.</i>
&gt;<i></i>
&gt;<i> In other words, if I use CVODE for one virtual cell, then the speed I get is</i>
&gt;<i> just amazing, but as soon as I want to couple several cells together, then</i>
&gt;<i> CVODE proves to be very inefficient (because of the kind of problem I want</i>
&gt;<i> to model, I believe).</i>
&gt;<i></i>
&gt;<i> Have I, by any chance, overlooked something? Can the kind of problem I am</i>
&gt;<i> interested in be solved efficiently using CVODE? If so, then I can still</i>
&gt;<i> think of another issue that might be worse investigating: memory</i>
&gt;<i> consumption. CVODE is (for obvious reasons) quite memory hungry, but is</i>
&gt;<i> there really no way to reduce its memory requirements? At the moment, when</i>
&gt;<i> coupling my virtual cells, I use only one CVODE 'object', since I need to</i>
&gt;<i> reinitialise everything after every single time step, but if my problem</i>
&gt;<i> above can be solved efficiently using CVODE, then I guess I would have to</i>
&gt;<i> have one CVODE 'object' per virtual cell, which could be quite inefficient</i>
&gt;<i> memory wise.</i>
&gt;<i></i>
&gt;<i> Ok, so much for my CV_TOO_MUCH_WORK related issue... :)</i>
&gt;<i></i>
&gt;<i>       Cheers, Alan.</i>
&gt;<i></i>
&gt;<i> University of Oxford, Department of Physiology, Anatomy &amp; Genetics</i>
&gt;<i> Sherrington Building, Parks Road, Oxford, OX1 3PT, England</i>
&gt;<i> <a  href="http://noble.physiol.ox.ac.uk/people/agarny/">http://noble.physiol.ox.ac.uk/people/agarny/</a></i>

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00512" href="msg00512.html">RE: [sundials-users] CV_TOO_MUCH_WORK</a></strong>
<ul><li><em>From:</em> &quot;Alan Garny&quot; &lt;agml@hellix.com&gt;</li></ul></li>
<li><strong><a name="00507" href="msg00507.html">Re: [sundials-users] CV_TOO_MUCH_WORK</a></strong>
<ul><li><em>From:</em> Radu Serban &lt;radu@llnl.gov&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00499" href="msg00499.html">[sundials-users] CV_TOO_MUCH_WORK</a></strong>
<ul><li><em>From:</em> &quot;Alan Garny&quot; &lt;alan.garny@physiol.ox.ac.uk&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00505.html">Re: [sundials-users] include file directory layout (was: The lighter side of SUNDIALS)</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00507.html">Re: [sundials-users] CV_TOO_MUCH_WORK</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00501.html">Re: [sundials-users] CV_TOO_MUCH_WORK</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00507.html">Re: [sundials-users] CV_TOO_MUCH_WORK</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00506">
<strong>Main</strong></a></li>
<li><a href="threads.html#00506">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
