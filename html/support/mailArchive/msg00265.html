<!-- MHonArc v2.6.10 -->
<!--X-Subject: [sundials&#45;users] Re: Error message handling -->
<!--X-From-R13: Dnqh Ereona <freona1Nyyay.tbi> -->
<!--X-Date: Thu, 26 Jan 2006 10:06:37 &#45;0800 (PST) -->
<!--X-Message-Id: 43D90F25.2080104@llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 43D7B64C.1090308@llnl.gov -->
<!--X-Head-End-->
<html>
<head>
<title>[sundials-users] Re: Error message handling</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00264.html">Date Prev</a>] [<a href="msg00266.html">Date Next</a>] [<a href="msg00263.html">Thread Prev</a>] [<a href="msg00266.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00265">Date Index</a></b>]
[<b><a href="threads.html#00265">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>[sundials-users] Re: Error message handling</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Radu Serban &lt;<a href="mailto:serban1%40llnl.gov">serban1@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Thu, 26 Jan 2006 10:04:21 -0800</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<tt>Radu Serban wrote:
</tt><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">Wow,</pre><br>
<tt>I didn't realize this was such a big issue for so many of of our users...<br>
Critical mass has certainly been reached :-) to consider a different 
solution for error message handling (and to warrant a new thread on the 
mailing list).</tt><br>
<br>
<tt>The solution that seems most feasible (and in line with the SUNDIALS 
user interface) is that suggested by Andreas, namely allowing for an 
optional user-supplied error handling function (with a default probably 
defaulting to the current error message handling).</tt><br>
<br>
<tt>Without having really thought it through, I see a couple of issues (I'll 
use CVODE as an example):</tt><br>
<br>
<tt>1) This would still leave out the &quot;memory NULL&quot; error. In each function 
that receives as first argument the solver (or preconditioner) memory 
pointer an error is returned if this pointer is NULL (by the way, this 
is one of the reasons why it's always good practice to initialize such 
pointers to NULL before calling a function like CVodeCreate). But then 
we couldn't access the error handling function stored in cvodemem...</tt><br>
<br>
<tt>2) Theoretically, each module (e.g. linear solver) should have its own 
error handling function (since we allow for users to define new such 
modules). But that is probably overkill, so we need to think of a 
mechanism that would allow using the same function.<br>
Now we have the problem that errors cannot be uniquely identified only 
through the error code (by the way, Alan G., this is the reason why the 
same error code is - apparently - returned for different errors: they 
come from different modules. We cannot force a user writing a new linear 
solver modules to use a set of error codes disjunct from that used by 
the main CVODE solver).<br>
So maybe the function type for such an error handling function should 
also contain an argument (const char*) identifying the module?<br>
   void error_handler(int error_code, const char *module, const char 
*msg, void *data);</tt><br>
<br>
<tt>Please feel free to post comments and/or suggestions. There may be other 
issues I have overlooked. I'll talk it over with the rest of our team 
and think of a prototype that I would post here for comments.</tt><br>
<br>
<pre style="margin: 0em;">--Radu</pre><br>
<pre style="margin: 0em;"><br></pre><br>
</blockquote><pre style="margin: 0em;"><br>Here's what I put together. Comments/suggestion?</pre><br>
<pre style="margin: 0em;">/*
 * -----------------------------------------------------------------
 * Type : CVErrHandlerFn
 * -----------------------------------------------------------------
 * A function eh, which handles error messages, must have type
 * CVErrHandlerFn.
 * The function eh takes as input the error code, the name of the
 * module reporting the error, the name of the function in which
 * the error occurred, the error message (with no escape sequences),
 * and a pointer to user data, the same as that passed to
 * CVodeSetErrHandlerFn.
 *
 * All error codes are negative, except CV_WARNING which indicates
 * a warning (the solver continues).
 *
 * A CVErrHandlerFn has no return value.
 * -----------------------------------------------------------------
 */</pre><br>
<pre style="margin: 0em;">typedef void (*CVErrHandlerFn)(int error_code,
                               const char *module, const char *function,
                               char *msg, void *eh_data);</pre><br>
<pre style="margin: 0em;">/*
 * -----------------------------------------------------------------
 * CVodeSetErrHandlerFn specifies a user-provided error handler
 * function.
 * -----------------------------------------------------------------
 * If not specified, an internal error handling function is used
 * and error messages are directed to the stream specified through
 * CVodeSetErrFile (default: stderr).
 * -----------------------------------------------------------------
 */</pre><br>
<pre style="margin: 0em;">int CVodeSetErrHandlerFn(void *cvode_mem, CVErrHandlerFn ehfun, void *eh_data);</pre><br>
<pre style="margin: 0em;"><br>---------------------------------------</pre><br>
<tt>Error messages reporting a NULL (main solver or linear solver) memory pointer are automatically 
directed to stderr. As Alan Garny requested, this will not happen if the compiler directive 
NO_STDERR_OUTPUT is defined. However, I will NOT provide a mechanism to set this directive through 
the configure script. I expect that most users that will use the default build system will run their 
applications from a console.</tt><br>
<br>
<pre style="margin: 0em;"><br>The default error handler prints messages such as:</pre><br>
<pre style="margin: 0em;">[CVODE ERROR]  CVodeMalloc
  y0 = NULL illegal.</pre><br>
<tt>[CVODE WARNING]  CVode<br>
  Internal t = 6.69184e-06 and h = 3.69212e-06 are such that t + h = t on the next step. The solver 
will continue anyway.</tt><br>
<br>
<pre style="margin: 0em;">-- Radu</pre><br>
<pre style="margin: 0em;"><br></pre><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00266" href="msg00266.html">RE: [sundials-users] Re: Error message handling</a></strong>
<ul><li><em>From:</em> Alan Garny &lt;agml@hellix.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00260" href="msg00260.html">Error message handling</a></strong>
<ul><li><em>From:</em> Radu Serban &lt;serban1@llnl.gov&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00264.html">[sundials-users] Problem reagring Residual function in IDA</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00266.html">RE: [sundials-users] Re: Error message handling</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00263.html">Re: Error message handling</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00266.html">RE: [sundials-users] Re: Error message handling</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00265">
<strong>Main</strong></a></li>
<li><a href="threads.html#00265">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
