<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [sundials&#45;users] Offline Manipulation of y values -->
<!--X-From-R13: Dnqh Ereona <freona1Nyyay.tbi> -->
<!--X-Date: Thu, 16 Mar 2006 05:28:19 &#45;0800 (PST) -->
<!--X-Message-Id: 441966FE.4080000@llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20060316041330.92829.qmail@web37013.mail.mud.yahoo.com -->
<!--X-Head-End-->
<html>
<head>
<title>Re: [sundials-users] Offline Manipulation of y values</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00377.html">Date Prev</a>] [<a href="msg00379.html">Date Next</a>] [<a href="msg00379.html">Thread Prev</a>] [<a href="msg00381.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00378">Date Index</a></b>]
[<b><a href="threads.html#00378">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sundials-users] Offline Manipulation of y values</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Radu Serban &lt;<a href="mailto:serban1%40llnl.gov">serban1@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Thu, 16 Mar 2006 05:24:14 -0800</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
raj duffy wrote:
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">Hi there</pre><br>
    I am solving a system of ODEs. After solving for y values in each 
time step, I need to feed the y values to other function fo calculate 
some other variables. However in that function, my y gers modified too.<br>
    Now in one of the earlier postings, Radu pointed out that y can not 
be changed outside f function. My code snippet is given below. Is it ok 
to call OtherFuncF and modify y as presented under or not<br>
<br>
<pre style="margin: 0em;">main()
{</pre><br>
N_Vector CV_Y;<br>
CVodeMalloc(cvode_mem, f, cData.StartTime, CV_Y, CV_SS, cData.reltol, 
&amp;cData.abstol); <br>
<br>
for(i=0; i&lt;cData.NumSteps; i++)<br>
 {<br>
    CVode(cvode_mem, ... CV_Y, &amp;t, CV_NORMAL); 
    OtherFuncF(CV_Y);<br>
 }<br>
<br>
<pre style="margin: 0em;">}</pre><br>
void OtherFuncF( N_Vector VY)<br>
{<br>
newY = NV_DATA_S(VY);<br>
         
   /* Do manipulations on newY here */<br>
}<br>
<br>
</blockquote><pre style="margin: 0em;"><br>Hi Raj,</pre><br>
I said that y cannot be modified *INSIDE* user-provided functions, such as the RHS function (in other words while the solver attempts to 
take a new step). Modifying it outside the integrator (e.g. after a successful return from CVode) is fine from the solver's point of view 
(but may not be what you need -- see below). Indeed, the output solution vector passed as an argument to CVode (CV_Y in your case) is used 
only as temporary workspace within CVode and, on output, contains the solution at time t (in CV_NORMAL mode, t=tout). Any modifications to 
CV_Y done in OtherFuncF will not even be seen by CVODE which uses its internally stored history array to predict and then correct at the 
following step.<br>
<br>
<pre style="margin: 0em;">That being said, this may or may not be what you want:</pre><br>
(1) If OtherFuncF modifies CV_Y *ONLY* for the purpose of computing these other variables you mention and the modified CV_Y is not needed by 
itself, then you're OK with the code above.<br>
<br>
(2) On the other hand, if you *DO* need to perturb the solution y at the current tout, you'll need to restart the integrator before going 
back in the for loop. In this latter case, what you have here is a discontinuity in the solution at explicitly-defined points in time (you 
basically want to &quot;jump&quot; on a different solution curve). See my recent post &quot;Notes on controlling unphysical solution components and 
integrating over discontinuities&quot;.<br>
<br>
Beware that calling CVodeReInit can add quite a bit to the computational expense as it forces the integrator to restart at order 1 and with 
a smaller step size. Of course, it's all relative and it depends on the size of cData.NumSteps and the number of steps the integrator takes 
from one tout to the next one.<br>
<br>
<pre style="margin: 0em;">Your main program should then look something like this (I assume you specify 
somehow tout[i], i=0,...,cData.NumSteps-1)</pre><br>
<pre style="margin: 0em;">main()
{
 N_Vector CV_Y;
 CVodeMalloc(cvode_mem, f, cData.StartTime, CV_Y, CV_SS, cData.reltol, 
&amp;cData.abstol);
 ...
 for(i=0; i&lt;cData.NumSteps; i++) {
   if (i&gt;0) CVodeReInit(cvode_mem, f, tout[i-1], CV_Y, CV_SS, cData.reltol, 
&amp;cData.abstol);
   CVode(cvode_mem, tout[i], CV_Y, &amp;t, CV_NORMAL);
   OtherFuncF(CV_Y);
  }</pre><br>
<pre style="margin: 0em;">}</pre><br>
<pre style="margin: 0em;">-- Radu</pre><br>
<pre style="margin: 0em;"><br></pre><br>
<pre style="margin: 0em;">--
   Radu Serban
   Center for Applied Scientific Computing   [email] radu@llnl.gov
   Lawrence Livermore National Laboratory    [phone] 925-424-4852
   P.O. Box 808, L-560                       [fax]   925-422-6287
   Livermore, CA 94551</pre><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00381" href="msg00381.html">Re: [sundials-users] Offline Manipulation of y values</a></strong>
<ul><li><em>From:</em> Andrey Romanenko &lt;andrey@enginum.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00376" href="msg00376.html">[sundials-users] Offline Manipulation of y values</a></strong>
<ul><li><em>From:</em> raj duffy &lt;raj_duffy@yahoo.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00377.html">Re: [sundials-users] Offline Manipulation of y values</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00379.html">Re: [sundials-users] Offline Manipulation of y values</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00379.html">Re: [sundials-users] Offline Manipulation of y values</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00381.html">Re: [sundials-users] Offline Manipulation of y values</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00378">
<strong>Main</strong></a></li>
<li><a href="threads.html#00378">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
