<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: [sundials&#45;users] nonlinear problem -->
<!--X-From-R13: Oyna Vvaqznefu <nynauNyyay.tbi> -->
<!--X-Date: Tue, 06 Mar 2007 16:38:13 &#45;0800 -->
<!--X-Message-Id: Pine.LNX.4.58.0703061628230.10762@tux64.llnl.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 45F9E104&#45;C1EC&#45;453A&#45;9895&#45;CFD0F962E7D3@u.washington.edu -->
<!--X-Reference: op.tn5zv4glt8lo91@helium -->
<!--X-Reference: AFF9FB2B&#45;1941&#45;4673&#45;B616&#45;F72A16039641@u.washington.edu -->
<!--X-Reference: op.tn53vdeat8lo91@helium -->
<!--X-Reference: C7353296&#45;B710&#45;43ED&#45;91AC&#45;D99F7CEDD99D@u.washington.edu -->
<!--X-Head-End-->
<html>
<head>
<title>Re: [sundials-users] nonlinear problem</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00894.html">Date Prev</a>] [<a href="msg00896.html">Date Next</a>] [<a href="msg00887.html">Thread Prev</a>] [<a href="msg00888.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00895">Date Index</a></b>]
[<b><a href="threads.html#00895">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sundials-users] nonlinear problem</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Alan Hindmarsh &lt;<a href="mailto:alanh%40llnl.gov">alanh@llnl.gov</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Tue, 6 Mar 2007 16:32:19 -0800 (PST)</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>
Hello Manav,

Contrary to some of the comments by Andreas, I think it may make a big
difference which formulation you use, because your problem is large
and you must therefore exploit its sparsity structure.

If your original problem is written abstractly as C dT/dt = R, where
both the matrix T and the function R depend on T (and maybe time t
also), then it is almost certainly best to leave it in just that form
and use IDA.  Writing dT/dt = C^{-1} R and using CVODE means that
the Jacobian of the RHS function is now dense, and none of the
sparsity structure of C and dR/dT can be expoited.  This only makes
sense if the system is nonstiff and you do not need to do any linear
algebra except to invert C to get dT/dt.  But from your mention of
Jacobian issues, I suspect your problem is indeed stiff, and some
linear algebra is needed.  Do you know for sure?

Likewise, using a new vector y = C T, and writing
  dy/dt = R + (dC/dt)T
introduces more difficulties than it removes.  Here(dC/dt)T has a term
from the explicit t-dependence of C and one from (dC/dT)(dT/dt), which
again requires C^{-1}R to evaluate.  Moreover, as you point out, the
Jacobian of the new RHS funtion w.r.t. y is a nightmare.

You are right about the difference quotient costs: For a Jacobian of
size N that is dense, this requires N function evaluations.  For one
that is sparse, it requires much fewer, depending on the structure.
For a solution of C dT/dt - R = 0, IDA must deal with a Jacobian
  J = d(C Tdot)/dT - dR/dT + alpha C (alpha = a given scalar).
All of these matrices are sparse, and probably easy for you to supply
analytically.  But any that are not can be generated efficiently by
difference quotients.  IDA offers direct and preconditioned iterative
methods for solving systems Jx = b, and the preconditioner can be
an approximation to J that is even simpler and cheaper to compute
and solve.

-Alan H





On Thu, 22 Feb 2007, Manav Bhatia wrote:

&gt;<i> Hi Andreas,</i>
&gt;<i></i>
&gt;<i>      I am afraid I am a little hesitant to use finite difference to</i>
&gt;<i> calculate the jacobian, primarily due to CPU expense. I am solving a</i>
&gt;<i> 3-D conduction heat transfer equation with temperature dependent</i>
&gt;<i> material properties, nonlinear radiation BC, and a combined internal</i>
&gt;<i> cavity radiation. And the combined problem is expensive to solve.</i>
&gt;<i> Hence, if a jacobian is calculated using finite difference, the f()</i>
&gt;<i> function will have to be calculated as many times as the number of</i>
&gt;<i> dofs in the model.</i>
&gt;<i></i>
&gt;<i>      Moreover, I already have the jacobian calculation in place for</i>
&gt;<i> the f() function. So, I only need to add some extra computing for the</i>
&gt;<i> jacobian of the restated problem.</i>
&gt;<i></i>
&gt;<i> Manav</i>
&gt;<i></i>
&gt;<i></i>
&gt;<i></i>
&gt;<i> On Feb 22, 2007, at 12:43 PM, Andreas Nicolai wrote:</i>
&gt;<i></i>
&gt;<i> &gt; Hi again,</i>
&gt;<i> &gt;</i>
&gt;<i> &gt; let CVODE figure out the Jacobian for you using its default</i>
&gt;<i> &gt; difference quotient approximation. Simply implement the f()</i>
&gt;<i> &gt; function. For a simple heat transfer equation with some non-linear</i>
&gt;<i> &gt; terms on the right-hand-side CVODE already performs extremely well.</i>
&gt;<i> &gt; A user-defined Jacobian would only make sense of your right-hand-</i>
&gt;<i> &gt; side terms are really non-linear over several orders of magnitude.</i>
&gt;<i> &gt; But in my experience, even if you include some heavily non-linear</i>
&gt;<i> &gt; radiation terms, this is not a problem for CVODE.</i>
&gt;<i> &gt;</i>
&gt;<i> &gt; Andreas</i>
&gt;<i> &gt;</i>
&gt;<i> &gt; PS: are you solving 1D or 2D or 3D problems?</i>
&gt;<i> &gt;</i>
&gt;<i> &gt; --</i>
&gt;<i> &gt; Andreas Nicolai                         anicolai@syr.edu</i>
&gt;<i> &gt; PhD Candidate, M.A.M.E                  (315) 443-2641</i>
&gt;<i> &gt; Syracuse University</i>
&gt;<i> &gt; 151 Link Hall</i>
&gt;<i> &gt; Syracuse, NY, 13244</i>
&gt;<i></i>

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00880" href="msg00880.html">[sundials-users] nonlinear problem</a></strong>
<ul><li><em>From:</em> Manav Bhatia &lt;manav@u.washington.edu&gt;</li></ul></li>
<li><strong><a name="00883" href="msg00883.html">Re: [sundials-users] nonlinear problem</a></strong>
<ul><li><em>From:</em> &quot;Andreas Nicolai&quot; &lt;Andreas.Nicolai@gmx.net&gt;</li></ul></li>
<li><strong><a name="00884" href="msg00884.html">Re: [sundials-users] nonlinear problem</a></strong>
<ul><li><em>From:</em> Manav Bhatia &lt;manav@u.washington.edu&gt;</li></ul></li>
<li><strong><a name="00885" href="msg00885.html">Re: [sundials-users] nonlinear problem</a></strong>
<ul><li><em>From:</em> &quot;Andreas Nicolai&quot; &lt;Andreas.Nicolai@gmx.net&gt;</li></ul></li>
<li><strong><a name="00887" href="msg00887.html">Re: [sundials-users] nonlinear problem</a></strong>
<ul><li><em>From:</em> Manav Bhatia &lt;manav@u.washington.edu&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00894.html">Re: [sundials-users] Re: CVODES Question</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00896.html">Re: [sundials-users] Preconditioned Jacobian for CVODE</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00887.html">Re: [sundials-users] nonlinear problem</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00888.html">Re: [sundials-users] nonlinear problem</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00895">
<strong>Main</strong></a></li>
<li><a href="threads.html#00895">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
