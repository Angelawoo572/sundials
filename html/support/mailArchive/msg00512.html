<!-- MHonArc v2.6.10 -->
<!--X-Subject: RE: [sundials&#45;users] CV_TOO_MUCH_WORK -->
<!--X-From-R13: "Oyna Uneal" <ntzyNuryyvk.pbz> -->
<!--X-Date: Thu, 15 Jun 2006 01:33:35 &#45;0700 -->
<!--X-Message-Id: 000c01c69055$811c1900$3df901a3@PCHEARTBREAK -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: Pine.LNX.4.58.0606141352510.25034@tux64.llnl.gov -->
<!--X-Head-End-->
<html>
<head>
<title>RE: [sundials-users] CV_TOO_MUCH_WORK</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00511.html">Date Prev</a>] [<a href="msg00513.html">Date Next</a>] [<a href="msg00507.html">Thread Prev</a>] [<a href="msg00514.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00512">Date Index</a></b>]
[<b><a href="threads.html#00512">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>RE: [sundials-users] CV_TOO_MUCH_WORK</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
&quot;Alan Garny&quot; &lt;<a href="mailto:agml%40hellix.com">agml@hellix.com</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Thu, 15 Jun 2006 09:27:13 +0100</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Thanks for all the replies. It's much appreciated.

&gt;<i> 1. Re CV_TOO_MUCH_WORK: I agree with Andreas's response.  You </i>
&gt;<i> do not want to remove the max-steps check.  It is there for </i>
&gt;<i> good reason -- to stop the integration when there is a real </i>
&gt;<i> error somewhere.  In your case, it is easy enough to pick a </i>
&gt;<i> large enough value of mxsteps to make sure you have only a </i>
&gt;<i> few (if any) too-much-work returns, and then just keep </i>
&gt;<i> calling CVode until you get to your next tout.</i>
&gt;<i> (I trust you have good reason for NOT wanting to see the </i>
&gt;<i> solution every 500 steps or so.  This is a rare situation.)</i>

The kind of ODEs my users solve typically require a maximum number of steps
of 300. That is, however, based on the assumption that sample their results
every millisecond. Some of my users, however, need to sample every 10
milliseconds (if not more), in which case they will need more than 300 and
even more than 500 steps.

Anyway, before receiving you guys' reply, I did think that there had to be a
good reason for max-steps check indeed. So, I updated my software so as to
have 500 steps maximum by default, but with the possibility for the user of
increasing that number if need be (i.e. if the the maximum number of steps
is reached, then my software let the user know, in which case s/he can
decide to either reduce the sampling rate or increasing the maximum number
of steps). I believe that's the way it should be done, even though I would
have liked to be in a position where the user's input could be avoided.

&gt;<i> 2. Re the ODEs/PDE issue: Again I agree with Andreas.  CVODE </i>
&gt;<i> and IDA are heavily used for large PDE systems, which could </i>
&gt;<i> easily include ODEs.</i>
&gt;<i> Finite difference methods yield CVODE problems, while FEM </i>
&gt;<i> yields IDA problems.  Either way, the issue then becomes one </i>
&gt;<i> of careful ordering of variables, choice of linear solver </i>
&gt;<i> (usually one of the Krylov solvers), and preconditioning.  </i>
&gt;<i> Even so, solution of the fully coupled system is likely to be </i>
&gt;<i> more efficient than equivalent multiple solutions of smaller </i>
&gt;<i> subproblems (with frequent restarting).  The hardest part is </i>
&gt;<i> preconditioning, but that need not be any more than the </i>
&gt;<i> combination of all the individual preconditioners (or direct</i>
&gt;<i> Jacobians) that you would generate for the subproblems.</i>

I currently solve my PDE system using a finite difference method and reading
your comments, it now makes sense: I should rearrange things.

To answer Radu's question, one of the systems I am trying to solve is:

Am*(Cm*dVm/dt+Sum(Iion)) = div(D*grad(Vm))

Where Am is the surfave-to-volume ratio of the cell, Cm is the capacitance
of the cell, Vm is the transmembrane potential of the cell, Iion is one of
the cell's currents, and D the conductivity tensor.

At the moment, the way I solve that is:

1) Solve dVm/dt = -1/Cm*Sum(Iion) for each cell, using CVODE,
2) Compute 1/Am*div(D*grad(Vm)) for each cell,
3) Update Vm using a simple forward Euler technique.

Because of #3, I obviously have to reinitialise CVODE, which is where I lose
an awful lot of time.

I suppose I should rewrite the above equation as follows:

dVm/dt = 1/Cm*(1/Am*div(D*grad(Vm))-Sum(Iion))

&gt;<i>From there, it's going to be easy to use CVODE in an efficient way. I should</i>
have thought of that before. I tried to get CVODE and my implementation of a
'cell' to work together as well as possible, without having to modify the
latter, but it would seem that it might be worth reworking my implementation
of a 'cell'.

This still leaves the problem of memory requirements though. CVODE does
require quite a bit of it, even though I have been able to reduce its
requirements by commenting out some of the stuff that I don't need (e.g.
stability limit detection and rootfinding data). I guess there is no much
that can be done about it though...

Anyway, thanks again for a great library and useful comments!

        Cheers, Alan.


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00514" href="msg00514.html">Re: [sundials-users] CV_TOO_MUCH_WORK</a></strong>
<ul><li><em>From:</em> Radu Serban &lt;radu@llnl.gov&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00506" href="msg00506.html">Re: [sundials-users] CV_TOO_MUCH_WORK</a></strong>
<ul><li><em>From:</em> Alan Hindmarsh &lt;alanh@llnl.gov&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00511.html">Re: [sundials-users] How to simplify that...Overview of steps to get sundials running on Windows...</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00513.html">Re: [sundials-users] include file directory layout</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00507.html">Re: [sundials-users] CV_TOO_MUCH_WORK</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00514.html">Re: [sundials-users] CV_TOO_MUCH_WORK</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00512">
<strong>Main</strong></a></li>
<li><a href="threads.html#00512">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
