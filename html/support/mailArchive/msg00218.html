<!-- MHonArc v2.6.10 -->
<!--X-Subject: Re: Undefined value from CVodeGetCurrentStep -->
<!--X-From-R13: Oaqernf @vpbynv <Oaqernf.@vpbynvNtzk.arg> -->
<!--X-Date: Tue, 17 Jan 2006 14:42:24 &#45;0800 (PST) -->
<!--X-Message-Id: op.s3jnq9b0t8lo91@smtp.kuleuven.ac.be -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: op.s3bmu2y5t8lo91@smtp.kuleuven.ac.be -->
<!--X-Reference: 43CD2433.2080406@llnl.gov -->
<!--X-Head-End-->
<html>
<head>
<title>Re: Undefined value from CVodeGetCurrentStep</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00217.html">Date Prev</a>] [<a href="msg00219.html">Date Next</a>] [<a href="msg00216.html">Thread Prev</a>] [<a href="msg00219.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00218">Date Index</a></b>]
[<b><a href="threads.html#00218">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: Undefined value from CVodeGetCurrentStep</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
Andreas Nicolai &lt;<a href="mailto:Andreas.Nicolai%40gmx.net">Andreas.Nicolai@gmx.net</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Tue, 17 Jan 2006 17:36:35 -0500</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Radu,</pre><br>
<blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><tt>I don't know how you use the step size inside f(), but it would probably make more senseto use the value of the step size used on the last successful step, hu. Note that hu=0.0as long as nst=0 (nst being the value returned by CVodeGetNumSteps).
</tt></blockquote><pre style="margin: 0em;"><br>Let me explain why I need it. I have a sink model that calculates a sink 
based on one of my quantities (crystalline salt mass). The sink (rate of 
dissolution of solid into the solution) is calculated as rate in kg/s. However, 
the sink function is unsteady when the available salt mass approaches zero. If 
the salt mass is zero, obviously the sink must be zero, too (nothing more to 
dissolve). With such an unsteady sink I sometimes get negative salt masses or 
very bad convergence (and small time steps) when the last bit of salt is 
dissolving.</pre><br>
<pre style="margin: 0em;">In my previous first order Euler solver I remedied the problem by &quot;correcting&quot; the sink term in such a way, that 
whenever &quot;dissolution rate&quot; x &quot;time step&quot; becomes bigger then the available salt mass, I corrected the 
dissolution rate to &quot;salt mass&quot; / &quot;time step&quot;. This ensured good convergence and I never got negative salt 
masses.</pre><br>
<pre style="margin: 0em;">Now in order to use the same procedure in CVODE I would need the current time 
step, that is actually used during the current iteration from within the f() 
function, in order to correctly calculate the sink term.</pre><br>
<pre style="margin: 0em;">Any suggestions how I could obtain that value?</pre><br>
<pre style="margin: 0em;"><br>Andreas</pre><br>
<pre style="margin: 0em;">PS: Alternatively I could use some kind of scaling function, which would 
&quot;gently&quot; bend my dissolution rate towards zero if my remaining salt masses 
approach zero.</pre><br>
<pre style="margin: 0em;">--
Andreas Nicolai                   Andreas.Nicolai@gmx.net
Syracuse University               +01 (315) 443 1099
151 E.A.Link Hall
Syracuse NY 13244-1240</pre><br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00219" href="msg00219.html">Re: Undefined value from CVodeGetCurrentStep</a></strong>
<ul><li><em>From:</em> Andrey Romanenko &lt;andrey@enginum.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00215" href="msg00215.html">Undefined value from CVodeGetCurrentStep</a></strong>
<ul><li><em>From:</em> Andreas Nicolai &lt;Andreas.Nicolai@gmx.net&gt;</li></ul></li>
<li><strong><a name="00216" href="msg00216.html">Re: Undefined value from CVodeGetCurrentStep</a></strong>
<ul><li><em>From:</em> Radu Serban &lt;serban1@llnl.gov&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00217.html">Re: BVP</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00219.html">Re: Undefined value from CVodeGetCurrentStep</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00216.html">Re: Undefined value from CVodeGetCurrentStep</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00219.html">Re: Undefined value from CVodeGetCurrentStep</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00218">
<strong>Main</strong></a></li>
<li><a href="threads.html#00218">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
