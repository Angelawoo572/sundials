<!-- MHonArc v2.6.10 -->
<!--X-Subject: RE: [sundials&#45;users] Changing algebraic variables during integration   with IDA -->
<!--X-From-R13: "Hbtry, Searfg T &#45; Snfgzna" <rsibtryNrnfgzna.pbz> -->
<!--X-Date: Thu, 02 Mar 2006 11:11:14 &#45;0800 (PST) -->
<!--X-Message-Id: 9719251EEFA00B4397C90260CE584496015D2D26@nt2mail03.emn.com -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<html>
<head>
<title>RE: [sundials-users] Changing algebraic variables during integration   with IDA</title>
<meta name="author" content="Radu Serban">
<meta name="description" content="suite of nonlinear differential algebraic equation solvers">
<meta name="keywords" content="SUNDIALS, CVODE, CVODES, IDA, KINSOL">
<meta name="keywords" content="ODE, DAE, sensitivity">
<meta name="keywords" content="differential, algebraic">
<link REL="SHORTCUT ICON" HREF="img/favicon.ico" type="image/x-icon">
<link REL="ICON" HREF="img/favicon.ico" type="image/x-icon">
<link href="../../sundials_styles.css" rel="stylesheet" type="text/css">
<script language="JavaScript">
<!--
homeon = new Image();           homeon.src = "../../graphics/home_buttonH.png";
homeoff = new Image();          homeoff.src = "../../graphics/home_button.png";
descriptionon = new Image();    descriptionon.src = "../../graphics/description_buttonH.png";
descriptionoff = new Image();   descriptionoff.src = "../../graphics/description_button.png";
documentationon = new Image();  documentationon.src = "../../graphics/documentation_buttonH.png";
documentationoff = new Image(); documentationoff.src = "../../graphics/documentation_button.png";
downloadon = new Image();       downloadon.src = "../../graphics/download_buttonH.png";
downloadoff = new Image();      downloadoff.src = "../../graphics/download_button.png";
supporton = new Image();        supporton.src = "../../graphics/support_buttonH.png";
supportoff = new Image();       supportoff.src = "../../graphics/support_button.png";
//-->
</script>
<script src="../../sunjs.js" type="text/javascript" language="javascript1.2"></script>
</head>
<!-- ******************************************************************************** -->
<body>
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
  <td height="60" background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  <td width="116"><img SRC="../../graphics/head_top_left.png" height="60" width="116" border="0"></td>
  <td width="720"><img SRC="../../graphics/head_mail_top_right.png" height="60" width="720" border="0"></td>
  <td background="../../graphics/table_bck1.gif"><img src="../../graphics/table_bck1.gif" width="5" height="60"></td>
  </tr>
  <tr valign="top">
  <td height="127" background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  <td width="116">
    <a href="../../main.html" onMouseOver="img_act('home'); return true;" onMouseOut="img_inact('home'); return true;"><img src="../../graphics/home_button.png" border="0" name="home"></a><br>
    <a href="../../description/description.html" onMouseOver="img_act('description'); return true;" onMouseOut="img_inact('description'); return true;"><img src="../../graphics/description_button.png" border="0" name="description"></a><br>
    <a href="../../documentation/documentation.html" onMouseOver="img_act('documentation'); return true;" onMouseOut="img_inact('documentation'); return true;"><img src="../../graphics/documentation_button.png" border="0" name="documentation"></a><br>
    <a href="../../download/download.html" onMouseOver="img_act('download'); return true;" onMouseOut="img_inact('download'); return true;"><img src="../../graphics/download_button.png" border="0" name="download"></a><br>
    <a href="../../support/support.html" onMouseOver="img_act('support'); return true;" onMouseOut="img_inact('support'); return true;"><img src="../../graphics/support_button.png" border="0" name="support"></a><br>
    <img SRC="../../graphics/line_tl.gif" height="7" width="116" border="0"></td>
  <td width="720">
      <img SRC="../../graphics/head_bottom_right.png" height="120" width="720" border="0"><br>
      <img SRC="../../graphics/line_tr.gif" height="7" width="720" border="0"></td>
  <td background="../../graphics/table_bck2.gif"><img src="../../graphics/table_bck2.gif" width="5" height="127"></td>
  </tr>
  <tr valign="top">
  <td background="../../graphics/table_bck3.gif"></td>
  <td width="116" valign="bottom" align="center" background="../../graphics/table_bck5.gif"><img SRC="../../graphics/logo.png" border="0"></td>
  <td width="720" bgcolor="#ffffff">
  <div id="content">   
<!-- Start content for this page -->
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<p class="links">
[<a href="msg00329.html">Date Prev</a>] [<a href="msg00331.html">Date Next</a>] [<a href="msg00326.html">Thread Prev</a>] [<a href="msg00333.html">Thread Next</a>]<br>
[<b><a href="maillist.html#00330">Date Index</a></b>]
[<b><a href="threads.html#00330">Thread Index</a></b>]
</p>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>RE: [sundials-users] Changing algebraic variables during integration   with IDA</h1>
<div class="frame">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table border=0 cellpadding=2 cellspacing=0>
<tr>
<td align="right"><b>
<em>From</em></b></td>
<td align="left">
&quot;Vogel, Ernest F - Eastman&quot; &lt;<a href="mailto:efvogel%40eastman.com">efvogel@eastman.com</a>&gt;</td>
</tr>

<tr>
<td align="right"><b>
<em>Date</em></b></td>
<td align="left">
Thu, 02 Mar 2006 14:08:42 -0500</td>
</tr>

</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="container">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Alan,

Thank you very much for your reply.

I'd like to offer a simple example for clarification.

Two differential equations:
yp1 = A - yy2
yp2 = yy2 - B

One algebraic equation:
yy2 = C * ( yy1 - yy2 )

(yp is the derivative of yy.)

I am simulating a continuous process with discrete feedback control.
The integrator stops at the end of each control action step (I am using
IDASetStopTime so it doesn't overshoot).  In some cases, a controller
could change A or B.  In those cases, IDA seemed to handle changes to A
and B without trouble.  In other cases, a controller could change C.  As
I expected, changes to C caused problems which I over came by calling
IDACalcIC whenever I changed C.

I was not sure from your reply exactly when I should need to restart the
solver.  It seems that changes to C should for sure require a restart,
but what about A and B?

Your reply also brings up a couple more questions:
Would you say that in my case, changes to A, B, and C are explicit?
Would an implicit change likely occur at an unknown time?
What is the difference between the rootfinding feature and IDACalcIC?

Once again, thanks very much for your help.

Ernie Vogel


-----Original Message-----
From: Alan Hindmarsh [<a  href="mailto:alanh@llnl.gov">mailto:alanh@llnl.gov</a>] 
Sent: Wednesday, March 01, 2006 5:08 PM
To: Vogel, Ernest F - Eastman
Cc: sundials-users@llnl.gov; alanh@llnl.gov
Subject: Re: [sundials-users] Changing algebraic variables during
integration with IDA


Hello Ernie,

If and when there is a major discontinuity in the model (whether in a
differential variable or an algebraic variagle), it is best to stop
there and restart.  Letting the ODE/DAE solver locate the jump and get
through it on its own is likely to be less efficient.  If the point of
the jump is defined implicitly, use the rootfinding feature (available
in CVODE now, and in IDA in the next release) to locate it.  On the
other hand, if the jump is small, each of these solvers is designed to
handle it without extra assistance.

When stopping and restarting after resetting a variable value, you
should call IDAReInit.  Also call IDACalcIC only if your new values
are not known to be consistent with the DAEs.

In the sundials-users archives you will find various other discussions
about handling discontinuities.

-Alan Hindmarsh


On Wed, 22 Feb 2006, Vogel, Ernest F - Eastman wrote:

&gt;<i> For the set of DAEs that I am integrating with IDA, I want to make</i>
&gt;<i> changes to variables that appear in the differential equations and</i>
&gt;<i> variables that appear in the algebraic equations periodically over the</i>
&gt;<i> course of the integration.  Changing variables that appear in</i>
&gt;<i> differential equations do not appear to present a problem.  However,</i>
&gt;<i> changing variables that appear in algebraic equations make the solver</i>
&gt;<i> stop.  That result seems expected because the changes move the</i>
algebraic
&gt;<i> equations away from a solution.  To fix the problem, I called the</i>
&gt;<i> function IDACalcIC to recalculate the algebraic solution each time I</i>
&gt;<i> changed a variable in an algebraic equation.  That additional call</i>
made
&gt;<i> the total function evaluations go up by a factor of 4, compared to the</i>
&gt;<i> case where I am not changing algebraic variables.  I'm wondering if</i>
&gt;<i> there is a better way to deal with the case of changing variables in</i>
&gt;<i> algebraic equations.  Calling IDAReInit seems like a possibility, but</i>
&gt;<i> not as likely to work as IDACalcIC.</i>
&gt;<i></i>
&gt;<i> Thanks for your help!</i>
&gt;<i> Ernie Vogel</i>

[* Internet Mail *]



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<div class="container">
<table width="95%" frame="below"><tr><td></td></table>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00333" href="msg00333.html">Re: [sundials-users] Changing algebraic variables during integration with IDA</a></strong>
<ul><li><em>From:</em> Radu Serban &lt;serban1@llnl.gov&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00329.html">Re: [sundials-users] Installing/checking sundials 2.1.1</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00331.html">RE: [sundials-users] sundials-users archives</a></strong>
</li>

<li>Previous by thread:
<strong><a href="msg00326.html">[sundials-users] Re: root finding in IDA</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00333.html">Re: [sundials-users] Changing algebraic variables during integration with IDA</a></strong>
</li>

<li>Index(es):
<ul>
<li><a href="maillist.html#00330">
<strong>Main</strong></a></li>
<li><a href="threads.html#00330">
<strong>Thread</strong></a></li>
</ul>
</li>
</ul>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
<!-- End content for this page -->
  </div>
  </td>
  <td background="../../graphics/table_bck3.gif"></td>
  </tr>
  <tr valign="top">
  <td height="17" background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  <td width="116"><a HREF="http://www.llnl.gov/disclaimer.html" target="_top"><img SRC="../../graphics/line_bl.gif" height="17" width="116" border="0"></a></td>
  <td width="720"><img SRC="../../graphics/line_br.gif" height="17" width="720" border="0"></td>
  <td background="../../graphics/table_bck4.gif"><img src="../../graphics/table_bck4.gif" width="5" height="17"></td>
  </tr>
  </table>
</body>
</html>
