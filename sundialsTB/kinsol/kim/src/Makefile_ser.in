# -----------------------------------------------------------------
# $Revision: 1.5 $
# $Date: 2006-07-26 01:27:51 $
# -----------------------------------------------------------------
# Programmer(s): Radu Serban @ LLNL
# -----------------------------------------------------------------
# Copyright (c) 2002, The Regents of the University of California.
# Produced at the Lawrence Livermore National Laboratory.
# All rights reserved.
# For details, see the LICENSE file.
# -----------------------------------------------------------------
# Makefile for the KINSOL Matlab module using the serial NVECTOR
#
# @configure_input@
# -----------------------------------------------------------------

SHELL = @SHELL@

@SET_MAKE@

srcdir       = @srcdir@
top_builddir = @top_builddir@
builddir     = @builddir@
prefix       = @prefix@
exec_prefix  = @exec_prefix@
includedir   = @includedir@
libdir       = @libdir@

LIBTOOL      = @LIBTOOL@
LIBTOOL_DEPS = @LIBTOOL_DEPS@

INSTALL      = @INSTALL@
INSTALL_PROG = @INSTALL_PROGRAM@
INSTALL_FILE = @INSTALL_DATA@

MEX      = @MEX@
MEXEXT   = @MEXEXT@
MEXOPTS  = @MEXOPTS@
MEXFLAGS = @MEXFLAGS@
MEXLDADD = @MEXLDADD@

STB_INSTDIR = @STB_INSTDIR@

KIM_SRCDIR = ${srcdir}
NVM_SRCDIR = ${srcdir}/../../../nvector/src

top_srcdir = $(srcdir)/../../../..

SUNDIALS_INCDIR = $(top_srcdir)/include
KINSOL_SRCDIR   = ${top_builddir}/src/kinsol
NVECSER_SRCDIR  = ${top_builddir}/src/nvec_ser

KIM_SRC  = ${KIM_SRCDIR}/kim.c ${KIM_SRCDIR}/kimWrap.c ${KIM_SRCDIR}/kimOpts.c
NVM_SRC  = ${NVM_SRCDIR}/nvm_serial.c ${NVM_SRCDIR}/nvm_ops.c
SRCFILES = ${KIM_SRC} ${NVM_SRC}

INCLUDES = -I${KIM_SRCDIR} -I${NVM_SRCDIR} -I${SUNDIALS_INCDIR} -I${top_builddir}/src
LIBS = ${KINSOL_SRCDIR}/libsundials_kinsol.la ${NVECSER_SRCDIR}/libsundials_nvecserial.la

MEXFILE = ../kim.${MEXEXT}

mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs

all: kim

clean:
	rm -f *.lo
	rm -f *.o
	rm -f $(MEXFILE)
	rm -rf ../.libs

install: kim
#	Create directories
	$(mkinstalldirs) ${STB_INSTDIR}/sundialsTB/nvector
	$(mkinstalldirs) ${STB_INSTDIR}/sundialsTB/kinsol/kim
	$(mkinstalldirs) ${STB_INSTDIR}/sundialsTB/kinsol/examples_ser
#	Install startup file
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/startup_STB.m                      $(STB_INSTDIR)/sundialsTB/
#	Install KINSOL functions
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/Contents.m                  $(STB_INSTDIR)/sundialsTB/kinsol/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/KINBandJacFn.m              $(STB_INSTDIR)/sundialsTB/kinsol/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/KINDenseJacFn.m             $(STB_INSTDIR)/sundialsTB/kinsol/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/KINFree.m                   $(STB_INSTDIR)/sundialsTB/kinsol/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/KINGcommFn.m                $(STB_INSTDIR)/sundialsTB/kinsol/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/KINGetStats.m               $(STB_INSTDIR)/sundialsTB/kinsol/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/KINGlocalFn.m               $(STB_INSTDIR)/sundialsTB/kinsol/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/KINJacTimesVecFn.m          $(STB_INSTDIR)/sundialsTB/kinsol/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/KINMalloc.m                 $(STB_INSTDIR)/sundialsTB/kinsol/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/KINPrecSetupFn.m            $(STB_INSTDIR)/sundialsTB/kinsol/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/KINPrecSolveFn.m            $(STB_INSTDIR)/sundialsTB/kinsol/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/KINSetOptions.m             $(STB_INSTDIR)/sundialsTB/kinsol/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/KINSol.m                    $(STB_INSTDIR)/sundialsTB/kinsol/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/KINSysFn.m                  $(STB_INSTDIR)/sundialsTB/kinsol/
#	Install kim functions
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/kim/Contents.m              $(STB_INSTDIR)/sundialsTB/kinsol/kim/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/kim/kim_bjac.m              $(STB_INSTDIR)/sundialsTB/kinsol/kim/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/kim/kim_djac.m              $(STB_INSTDIR)/sundialsTB/kinsol/kim/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/kim/kim_gcom.m              $(STB_INSTDIR)/sundialsTB/kinsol/kim/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/kim/kim_gloc.m              $(STB_INSTDIR)/sundialsTB/kinsol/kim/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/kim/kim_info.m              $(STB_INSTDIR)/sundialsTB/kinsol/kim/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/kim/kim_jtv.m               $(STB_INSTDIR)/sundialsTB/kinsol/kim/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/kim/kim_pset.m              $(STB_INSTDIR)/sundialsTB/kinsol/kim/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/kim/kim_psol.m              $(STB_INSTDIR)/sundialsTB/kinsol/kim/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/kim/kim_sys.m               $(STB_INSTDIR)/sundialsTB/kinsol/kim/
#	Install MEX file
	$(INSTALL_PROG) $(top_builddir)/sundialsTB/kinsol/kim/kim.$(MEXEXT)         $(STB_INSTDIR)/sundialsTB/kinsol/kim/
#	Install serial example files
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/examples_ser/kindiag.m      $(STB_INSTDIR)/sundialsTB/kinsol/examples_ser/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/examples_ser/kindiag_pset.m $(STB_INSTDIR)/sundialsTB/kinsol/examples_ser/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/examples_ser/kindiag_psol.m $(STB_INSTDIR)/sundialsTB/kinsol/examples_ser/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/examples_ser/kindiag_sys.m  $(STB_INSTDIR)/sundialsTB/kinsol/examples_ser/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/examples_ser/kindx.m        $(STB_INSTDIR)/sundialsTB/kinsol/examples_ser/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/kinsol/examples_ser/kindx_sys.m    $(STB_INSTDIR)/sundialsTB/kinsol/examples_ser/
#	Install NVECTOR files
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/nvector/Contents.m                 $(STB_INSTDIR)/sundialsTB/nvector/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/nvector/N_VDotProd.m               $(STB_INSTDIR)/sundialsTB/nvector/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/nvector/N_VL1Norm.m                $(STB_INSTDIR)/sundialsTB/nvector/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/nvector/N_VMax.m                   $(STB_INSTDIR)/sundialsTB/nvector/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/nvector/N_VMaxNorm.m               $(STB_INSTDIR)/sundialsTB/nvector/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/nvector/N_VMin.m                   $(STB_INSTDIR)/sundialsTB/nvector/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/nvector/N_VWL2Norm.m               $(STB_INSTDIR)/sundialsTB/nvector/
	$(INSTALL_FILE) $(top_srcdir)/sundialsTB/nvector/N_VWrmsNorm.m              $(STB_INSTDIR)/sundialsTB/nvector/

uninstall:
	@if test -d ${STB_INSTDIR}/sundialsTB ; then \
	   rm -rf ${STB_INSTDIR}/sundialsTB ;        \
	 fi

distclean: clean
	rm -f Makefile
	rm -f $(top_srcdir)/sundialsTB/startup_STB.m

kim:
	${LIBTOOL} --mode=link ${MEX} ${MEXOPTS} ${MEXFLAGS} ${INCLUDES} -o ${MEXFILE} ${SRCFILES} ${MEXLDADD} ${LIBS}

libtool: $(top_builddir)/$(LIBTOOL_DEPS)
	 @cd ${top_builddir} ;                 \
	  ${SHELL} ./config.status --recheck ; \
	  cd ${abs_builddir}
