#!/bin/sh
#
# File tarsun: Script to build SUNDIALS tar-file.
# Version of 4 September 2002.
#

#---------------------------------------------------------
# Test if the script is executed from within its directory
#---------------------------------------------------------
scriptbase=`basename $0`
if [ ! -f "$scriptbase" ]
then
    echo "This script must be executed from within its directory"
    exit 1
fi

#-------------
# Define flags
#-------------
err=F   # Error flag
hlp=F   # Help flag
ser=F   # Serial flag
par=F   # Parallel flag
fnm=F   # File name flag

#------------------
# Process arguments
#------------------
if [ $# -eq 0 ]
then
   err=T
else
   while getopts asphf: name
   do
     case $name in
        h) hlp=T;;
        a) ser=T;par=T;;
        s) ser=T;;
        p) par=T;;
        f) fnm=T;filename=$OPTARG;;
        ?) err=T;;
     esac
   done
fi

#------------------
# Define some names
#------------------
scriptdir=`pwd`
distrodir=`echo $PWD | sed -e 's/scripts//'`
distrobase=`basename $distrodir`

#------------
# Print usage
#------------
if [ $err = "T" -o $hlp = "T" ]
then
    echo "Usage: tarsun [option | file]"
    echo "   -a      : both serial and parallel"
    echo "   -s      : serial"
    echo "   -p      : parallel"
    echo "   -h      : help"
    echo "   -f file : output to file" 
    echo "Note: This script must be executed from within its directory" 
    echo "      Default file will be created in $distrodir"
    if [ $err = "T" -o \( $ser = "F" -a $par = "F" \) ]
    then
        exit 1
    fi
fi

#-----------------
# Create file name
#-----------------
if [ $fnm != "T" ]
then
    if [ $ser = "T" -a $par = "F" ]
    then
        filename="sundials_ser.tar"
    elif [ $ser = "F" -a $par = "T" ]
    then
        filename="sundials_par.tar"
    else
        filename="sundials.tar"
    fi
    tarfile=$distrodir$filename
else
    filebase=`basename $filename`
    cd `dirname $filename`
    filedir=`pwd`
    tarfile=$filedir/$filebase
    cd $scriptdir
fi

#----------------
# Create tar file
#----------------

cd ../..
echo "Generate $distrobase distribution tar-file $tarfile"

# Add top level files
#--------------------

echo "  Add top-level files/directories"

tar cf $tarfile $distrobase/Makefile

tar uf $tarfile $distrobase/doc/Readme

tar uf $tarfile $distrobase/lib/.dontremove

tar uf $tarfile $distrobase/include/.dontremove

# Add SHARED module
#------------------

echo "  Add shared module"

tar uf $tarfile $distrobase/shared/LICENSE

tar uf $tarfile $distrobase/shared/doc/nvecreadme

tar uf $tarfile $distrobase/shared/lib/.dontremove

tar uf $tarfile $distrobase/shared/include/sundialstypes.h
tar uf $tarfile $distrobase/shared/include/sundialsmath.h
tar uf $tarfile $distrobase/shared/include/nvector.h
tar uf $tarfile $distrobase/shared/include/dense.h
tar uf $tarfile $distrobase/shared/include/smalldense.h
tar uf $tarfile $distrobase/shared/include/band.h
tar uf $tarfile $distrobase/shared/include/spgmr.h
tar uf $tarfile $distrobase/shared/include/iterativ.h
tar uf $tarfile $distrobase/shared/include/fcmixpar.h

tar uf $tarfile $distrobase/shared/source/Makefile
tar uf $tarfile $distrobase/shared/source/sundialsmath.c
tar uf $tarfile $distrobase/shared/source/nvector.c
tar uf $tarfile $distrobase/shared/source/dense.c
tar uf $tarfile $distrobase/shared/source/smalldense.c
tar uf $tarfile $distrobase/shared/source/band.c
tar uf $tarfile $distrobase/shared/source/spgmr.c
tar uf $tarfile $distrobase/shared/source/iterativ.c

if [ $ser = "T" ]
then
    tar uf $tarfile $distrobase/shared/include/nvector_serial.h
    tar uf $tarfile $distrobase/shared/include/fnvector_serial.h

    tar uf $tarfile $distrobase/shared/source/nvecserial.mk
    tar uf $tarfile $distrobase/shared/source/nvector_serial.c
    tar uf $tarfile $distrobase/shared/source/fnvector_serial.c
fi

if [ $par = "T" ]
then
    tar uf $tarfile $distrobase/shared/include/nvector_parallel.h
    tar uf $tarfile $distrobase/shared/include/fnvector_parallel.h

    tar uf $tarfile $distrobase/shared/source/nvecparallel.mk
    tar uf $tarfile $distrobase/shared/source/nvector_parallel.c
    tar uf $tarfile $distrobase/shared/source/fnvector_parallel.c
fi

# Add CVODE module
#-----------------

echo "  Add cvode module"

tar uf $tarfile $distrobase/cvode/LICENSE

tar uf $tarfile $distrobase/cvode/doc/cvreadme
tar uf $tarfile $distrobase/cvode/doc/stald.doc

tar uf $tarfile $distrobase/cvode/include/cvode.h
tar uf $tarfile $distrobase/cvode/include/cvdense.h
tar uf $tarfile $distrobase/cvode/include/cvband.h
tar uf $tarfile $distrobase/cvode/include/cvdiag.h
tar uf $tarfile $distrobase/cvode/include/cvspgmr.h
tar uf $tarfile $distrobase/cvode/include/cvbandpre.h
tar uf $tarfile $distrobase/cvode/include/cvbbdpre.h

tar uf $tarfile $distrobase/cvode/source/Makefile
tar uf $tarfile $distrobase/cvode/source/cvode.c
tar uf $tarfile $distrobase/cvode/source/cvdense.c
tar uf $tarfile $distrobase/cvode/source/cvband.c
tar uf $tarfile $distrobase/cvode/source/cvdiag.c
tar uf $tarfile $distrobase/cvode/source/cvspgmr.c
tar uf $tarfile $distrobase/cvode/source/cvbandpre.c
tar uf $tarfile $distrobase/cvode/source/cvbbdpre.c

tar uf $tarfile $distrobase/cvode/lib/.dontremove

tar uf $tarfile $distrobase/cvode/examples/Makefile

tar uf $tarfile $distrobase/cvode/fcmix/Makefile
tar uf $tarfile $distrobase/cvode/fcmix/fcvode.h
tar uf $tarfile $distrobase/cvode/fcmix/fcvode.c
tar uf $tarfile $distrobase/cvode/fcmix/fcvspgmr01.c
tar uf $tarfile $distrobase/cvode/fcmix/fcvspgmr10.c
tar uf $tarfile $distrobase/cvode/fcmix/fcvspgmr11.c
tar uf $tarfile $distrobase/cvode/fcmix/fcvspgmr20.c
tar uf $tarfile $distrobase/cvode/fcmix/fcvspgmr21.c
tar uf $tarfile $distrobase/cvode/fcmix/fcvpreco.c
tar uf $tarfile $distrobase/cvode/fcmix/fcvpsol.c
tar uf $tarfile $distrobase/cvode/fcmix/fcvjtimes.c
tar uf $tarfile $distrobase/cvode/fcmix/fcvband1.c
tar uf $tarfile $distrobase/cvode/fcmix/fcvdense1.c
tar uf $tarfile $distrobase/cvode/fcmix/fcvbbd.h
tar uf $tarfile $distrobase/cvode/fcmix/fcvbbd.c
tar uf $tarfile $distrobase/cvode/fcmix/fcvbbdin1.c

if [ $ser = "T" ]
then
    tar uf $tarfile $distrobase/cvode/doc/cvudoc.ps
    tar uf $tarfile $distrobase/cvode/doc/cvudoc.pdf
    tar uf $tarfile $distrobase/cvode/doc/cvaddenda

    tar uf $tarfile $distrobase/cvode/examples/cvx_ser.mk
    tar uf $tarfile $distrobase/cvode/examples/cvdx.c
    tar uf $tarfile $distrobase/cvode/examples/cvdx.out
    tar uf $tarfile $distrobase/cvode/examples/cvbx.c
    tar uf $tarfile $distrobase/cvode/examples/cvbx.out
    tar uf $tarfile $distrobase/cvode/examples/cvkx.c
    tar uf $tarfile $distrobase/cvode/examples/cvkx.out
    tar uf $tarfile $distrobase/cvode/examples/cvkxb.c
    tar uf $tarfile $distrobase/cvode/examples/cvkxb.out
    tar uf $tarfile $distrobase/cvode/examples/cvdemd.c
    tar uf $tarfile $distrobase/cvode/examples/cvdemd.out
    tar uf $tarfile $distrobase/cvode/examples/cvdemk.c
    tar uf $tarfile $distrobase/cvode/examples/cvdemk.out

    tar uf $tarfile $distrobase/cvode/fcmix/fcvx_ser.mk
    tar uf $tarfile $distrobase/cvode/fcmix/cvdensef.f
    tar uf $tarfile $distrobase/cvode/fcmix/cvdensef.out
    tar uf $tarfile $distrobase/cvode/fcmix/cvbandf.f
    tar uf $tarfile $distrobase/cvode/fcmix/cvbandf.out
    tar uf $tarfile $distrobase/cvode/fcmix/cvkryf.f
    tar uf $tarfile $distrobase/cvode/fcmix/cvkryf.out
fi

if [ $par = "T" ]
then
    tar uf $tarfile $distrobase/cvode/doc/pvudoc.ps
    tar uf $tarfile $distrobase/cvode/doc/pvudoc.pdf
    tar uf $tarfile $distrobase/cvode/doc/pvaddenda

    tar uf $tarfile $distrobase/cvode/examples/cvx_par.mk
    tar uf $tarfile $distrobase/cvode/examples/pvnx.c
    tar uf $tarfile $distrobase/cvode/examples/pvnx.out
    tar uf $tarfile $distrobase/cvode/examples/pvkx.c
    tar uf $tarfile $distrobase/cvode/examples/pvkx.out
    tar uf $tarfile $distrobase/cvode/examples/pvkxb.c
    tar uf $tarfile $distrobase/cvode/examples/pvkxb.out

    tar uf $tarfile $distrobase/cvode/fcmix/fcvx_par.mk
    tar uf $tarfile $distrobase/cvode/fcmix/pvdiagnf.f
    tar uf $tarfile $distrobase/cvode/fcmix/pvdiagnf.out
    tar uf $tarfile $distrobase/cvode/fcmix/pvdiagkf.f
    tar uf $tarfile $distrobase/cvode/fcmix/pvdiagkf.out
    tar uf $tarfile $distrobase/cvode/fcmix/pvdiagkbf.f
    tar uf $tarfile $distrobase/cvode/fcmix/pvdiagkbf.out
fi

# Add KINSOL module
#------------------

echo "  Add kinsol module"

tar uf $tarfile $distrobase/kinsol/LICENSE

tar uf $tarfile $distrobase/kinsol/doc/kinreadme
tar uf $tarfile $distrobase/kinsol/doc/kinaddenda
tar uf $tarfile $distrobase/kinsol/doc/kinudoc.ps
tar uf $tarfile $distrobase/kinsol/doc/kinudoc.pdf

tar uf $tarfile $distrobase/kinsol/include/kinsol.h
tar uf $tarfile $distrobase/kinsol/include/kinspgmr.h
tar uf $tarfile $distrobase/kinsol/include/kinbbdpre.h

tar uf $tarfile $distrobase/kinsol/source/Makefile
tar uf $tarfile $distrobase/kinsol/source/kinsol.c
tar uf $tarfile $distrobase/kinsol/source/kinspgmr.c
tar uf $tarfile $distrobase/kinsol/source/kinbbdpre.c

tar uf $tarfile $distrobase/kinsol/lib/.dontremove

tar uf $tarfile $distrobase/kinsol/examples/Makefile

tar uf $tarfile $distrobase/kinsol/fcmix/Makefile
tar uf $tarfile $distrobase/kinsol/fcmix/fkinsol.h
tar uf $tarfile $distrobase/kinsol/fcmix/fkinsol.c
tar uf $tarfile $distrobase/kinsol/fcmix/fkinspgmr01.c
tar uf $tarfile $distrobase/kinsol/fcmix/fkinspgmr10.c
tar uf $tarfile $distrobase/kinsol/fcmix/fkinspgmr11.c
tar uf $tarfile $distrobase/kinsol/fcmix/fkinspgmr20.c
tar uf $tarfile $distrobase/kinsol/fcmix/fkinspgmr21.c
tar uf $tarfile $distrobase/kinsol/fcmix/fkinpreco.c
tar uf $tarfile $distrobase/kinsol/fcmix/fkinpsol.c
tar uf $tarfile $distrobase/kinsol/fcmix/fkinuatimes.c
tar uf $tarfile $distrobase/kinsol/fcmix/fkinbbd.h
tar uf $tarfile $distrobase/kinsol/fcmix/fkinbbd.c
tar uf $tarfile $distrobase/kinsol/fcmix/fkinbbdinit1.c

if [ $ser = "T" ]
then
    tar uf $tarfile $distrobase/kinsol/examples/kinx_ser.mk
    tar uf $tarfile $distrobase/kinsol/examples/kinwebs.c
    tar uf $tarfile $distrobase/kinsol/examples/kinwebs.out

    tar uf $tarfile $distrobase/kinsol/fcmix/fkinx_ser.mk
    tar uf $tarfile $distrobase/kinsol/fcmix/kindiagsf.f
    tar uf $tarfile $distrobase/kinsol/fcmix/kindiagsf.out
fi
    
if [ $par = "T" ]
then
    tar uf $tarfile $distrobase/kinsol/examples/kinx_par.mk
    tar uf $tarfile $distrobase/kinsol/examples/kinwebp.c
    tar uf $tarfile $distrobase/kinsol/examples/kinwebp.out
    tar uf $tarfile $distrobase/kinsol/examples/kinwebbbd.c
    tar uf $tarfile $distrobase/kinsol/examples/kinwebbbd.out
    
    tar uf $tarfile $distrobase/kinsol/fcmix/fkinx_par.mk
    tar uf $tarfile $distrobase/kinsol/fcmix/kindiagpf.f
    tar uf $tarfile $distrobase/kinsol/fcmix/kindiagpf.out
fi


# Add IDA module
#---------------

echo "  Add ida module"

tar uf $tarfile $distrobase/ida/LICENSE

tar uf $tarfile $distrobase/ida/doc/idareadme
tar uf $tarfile $distrobase/ida/doc/idaaddenda
tar uf $tarfile $distrobase/ida/doc/idaudoc.ps
tar uf $tarfile $distrobase/ida/doc/idaudoc.pdf

tar uf $tarfile $distrobase/ida/include/ida.h
tar uf $tarfile $distrobase/ida/include/idadense.h
tar uf $tarfile $distrobase/ida/include/idaband.h
tar uf $tarfile $distrobase/ida/include/idaspgmr.h
tar uf $tarfile $distrobase/ida/include/idabbdpre.h

tar uf $tarfile $distrobase/ida/source/Makefile
tar uf $tarfile $distrobase/ida/source/ida.c
tar uf $tarfile $distrobase/ida/source/idadense.c
tar uf $tarfile $distrobase/ida/source/idaband.c
tar uf $tarfile $distrobase/ida/source/idaspgmr.c
tar uf $tarfile $distrobase/ida/source/idabbdpre.c

tar uf $tarfile $distrobase/ida/lib/.dontremove

tar uf $tarfile $distrobase/ida/examples/Makefile

if [ $ser = "T" ]
then
    tar uf $tarfile $distrobase/ida/examples/idax_ser.mk
    tar uf $tarfile $distrobase/ida/examples/irobx.c
    tar uf $tarfile $distrobase/ida/examples/irobx.out
    tar uf $tarfile $distrobase/ida/examples/iheatsb.c
    tar uf $tarfile $distrobase/ida/examples/iheatsb.out
    tar uf $tarfile $distrobase/ida/examples/iheatsk.c
    tar uf $tarfile $distrobase/ida/examples/iheatsk.out
    tar uf $tarfile $distrobase/ida/examples/iwebsb.c
    tar uf $tarfile $distrobase/ida/examples/iwebsb.out
fi

if [ $par = "T" ]
then
    tar uf $tarfile $distrobase/ida/examples/idax_par.mk
    tar uf $tarfile $distrobase/ida/examples/iheatpk.c
    tar uf $tarfile $distrobase/ida/examples/iheatpk.out
    tar uf $tarfile $distrobase/ida/examples/iheatbbd.c
    tar uf $tarfile $distrobase/ida/examples/iheatbbd.out
    tar uf $tarfile $distrobase/ida/examples/iwebpk.c
    tar uf $tarfile $distrobase/ida/examples/iwebpk.out
    tar uf $tarfile $distrobase/ida/examples/iwebbbd.c
    tar uf $tarfile $distrobase/ida/examples/iwebbbd.out
fi

# Add CVODES module
#------------------

echo "  Add cvodes module"

tar uf $tarfile $distrobase/cvodes/LICENSE

tar uf $tarfile $distrobase/cvodes/doc/cvsreadme
tar uf $tarfile $distrobase/cvodes/doc/cvs_guide.ps
tar uf $tarfile $distrobase/cvodes/doc/cvs_guide.pdf

tar uf $tarfile $distrobase/cvodes/include/cvodes.h
tar uf $tarfile $distrobase/cvodes/include/cvodea.h
tar uf $tarfile $distrobase/cvodes/include/cvsdense.h
tar uf $tarfile $distrobase/cvodes/include/cvsband.h
tar uf $tarfile $distrobase/cvodes/include/cvsdiag.h
tar uf $tarfile $distrobase/cvodes/include/cvsspgmr.h
tar uf $tarfile $distrobase/cvodes/include/cvsbandpre.h
tar uf $tarfile $distrobase/cvodes/include/cvsbbdpre.h

tar uf $tarfile $distrobase/cvodes/source/Makefile
tar uf $tarfile $distrobase/cvodes/source/cvodes.c
tar uf $tarfile $distrobase/cvodes/source/cvodea.c
tar uf $tarfile $distrobase/cvodes/source/cvsdense.c
tar uf $tarfile $distrobase/cvodes/source/cvsband.c
tar uf $tarfile $distrobase/cvodes/source/cvsdiag.c
tar uf $tarfile $distrobase/cvodes/source/cvsspgmr.c
tar uf $tarfile $distrobase/cvodes/source/cvsbandpre.c
tar uf $tarfile $distrobase/cvodes/source/cvsbbdpre.c

tar uf $tarfile $distrobase/cvodes/lib/.dontremove

tar uf $tarfile $distrobase/cvodes/examples/Makefile

tar uf $tarfile $distrobase/cvodes/fwd_examples/Makefile

tar uf $tarfile $distrobase/cvodes/adj_examples/Makefile

if [ $ser = "T" ]
then
    tar uf $tarfile $distrobase/cvodes/examples/cvx_ser.mk
    tar uf $tarfile $distrobase/cvodes/examples/cvdx.c
    tar uf $tarfile $distrobase/cvodes/examples/cvdx.out
    tar uf $tarfile $distrobase/cvodes/examples/cvbx.c
    tar uf $tarfile $distrobase/cvodes/examples/cvbx.out
    tar uf $tarfile $distrobase/cvodes/examples/cvkx.c
    tar uf $tarfile $distrobase/cvodes/examples/cvkx.out
    tar uf $tarfile $distrobase/cvodes/examples/cvkxb.c
    tar uf $tarfile $distrobase/cvodes/examples/cvkxb.out
    tar uf $tarfile $distrobase/cvodes/examples/cvdemd.c
    tar uf $tarfile $distrobase/cvodes/examples/cvdemd.out
    tar uf $tarfile $distrobase/cvodes/examples/cvdemk.c
    tar uf $tarfile $distrobase/cvodes/examples/cvdemk.out

    tar uf $tarfile $distrobase/cvodes/fwd_examples/cvfx_ser.mk
    tar uf $tarfile $distrobase/cvodes/fwd_examples/cvfdx.c
    tar uf $tarfile $distrobase/cvodes/fwd_examples/cvfdx.out1
    tar uf $tarfile $distrobase/cvodes/fwd_examples/cvfdx.out2
    tar uf $tarfile $distrobase/cvodes/fwd_examples/cvfnx.c
    tar uf $tarfile $distrobase/cvodes/fwd_examples/cvfnx.out1
    tar uf $tarfile $distrobase/cvodes/fwd_examples/cvfnx.out2
    tar uf $tarfile $distrobase/cvodes/fwd_examples/cvfkx.c
    tar uf $tarfile $distrobase/cvodes/fwd_examples/cvfkx.out1
    tar uf $tarfile $distrobase/cvodes/fwd_examples/cvfkx.out2

    tar uf $tarfile $distrobase/cvodes/adj_examples/cvax_ser.mk
    tar uf $tarfile $distrobase/cvodes/adj_examples/cvadx.c
    tar uf $tarfile $distrobase/cvodes/adj_examples/cvadx.out
    tar uf $tarfile $distrobase/cvodes/adj_examples/cvabx.c
    tar uf $tarfile $distrobase/cvodes/adj_examples/cvabx.out
    tar uf $tarfile $distrobase/cvodes/adj_examples/cvakx.c
    tar uf $tarfile $distrobase/cvodes/adj_examples/cvakx.out
    tar uf $tarfile $distrobase/cvodes/adj_examples/cvakxb.c
    tar uf $tarfile $distrobase/cvodes/adj_examples/cvakxb.out
fi


if [ $par = "T" ]
then
    tar uf $tarfile $distrobase/cvodes/examples/cvx_par.mk
    tar uf $tarfile $distrobase/cvodes/examples/pvnx.c
    tar uf $tarfile $distrobase/cvodes/examples/pvnx.out
    tar uf $tarfile $distrobase/cvodes/examples/pvkx.c
    tar uf $tarfile $distrobase/cvodes/examples/pvkx.out
    tar uf $tarfile $distrobase/cvodes/examples/pvkxb.c
    tar uf $tarfile $distrobase/cvodes/examples/pvkxb.out

    tar uf $tarfile $distrobase/cvodes/fwd_examples/cvfx_par.mk
    tar uf $tarfile $distrobase/cvodes/fwd_examples/pvfnx.c
    tar uf $tarfile $distrobase/cvodes/fwd_examples/pvfnx.out1
    tar uf $tarfile $distrobase/cvodes/fwd_examples/pvfnx.out2
    tar uf $tarfile $distrobase/cvodes/fwd_examples/pvfkx.c
    tar uf $tarfile $distrobase/cvodes/fwd_examples/pvfkx.out1
    tar uf $tarfile $distrobase/cvodes/fwd_examples/pvfkx.out2

    tar uf $tarfile $distrobase/cvodes/adj_examples/cvax_par.mk
    tar uf $tarfile $distrobase/cvodes/adj_examples/pvanx.c
    tar uf $tarfile $distrobase/cvodes/adj_examples/pvanx.out
fi

#----End of tarsun script file----

