#!/bin/sh
#
# File tarcvodes: Script to build CVODES tar-file.
# Version of 4 April 2002.
#
#-------------
# Define flags
#-------------
err=F   # Error flag
hlp=F   # Help flag
ser=F   # Serial flag
par=F   # Parallel flag
fnm=F   # File name flag

#------------------
# Process arguments
#------------------
if [ $# -eq 0 ]
then
   err=T
else
   while getopts asphf: name
   do
     case $name in
        h) hlp=T;;
        a) ser=T;par=T;;
        s) ser=T;;
        p) par=T;;
        f) fnm=T;filename=$OPTARG;;
        ?) err=T;;
     esac
   done
fi

#------------
# Print usage
#------------
if [ $err = "T" -o $hlp = "T" ]
then
    echo "Usage: tarsundials [option | file]"
    echo "   -a      : both serial and parallel"
    echo "   -s      : serial"
    echo "   -p      : parallel"
    echo "   -h      : help"
    echo "   -f file : output to file" 
    if [ $err = "T" -o \( $ser = "F" -a $par = "F" \) ]
    then
        exit 1
    fi
fi

#-----------------
# Create file name
#-----------------
if [ $fnm != "T" ]
then
    if [ $ser = "T" -a $par = "F" ]
    then
        filename="cvodes_ser.tar"
    elif [ $ser = "F" -a $par = "T" ]
    then
        filename="cvodes_par.tar"
    else
        filename="cvodes.tar"
    fi
fi

#----------------
# Create tar file
#----------------

cd ../..
echo "Generate tar file $PWD/$filename"

# Add top level files
#--------------------

echo "  Add top-level files/directories"

tar cf $filename sundials/Makefile

tar uf $filename sundials/lib/.dontremove

tar uf $filename sundials/include/.dontremove

tar uf $filename sundials/doc/Readme
tar uf $filename sundials/doc/dirstruc

# Add SHARED module
#------------------

echo "  Add shared module"

tar uf $filename sundials/shared/doc/nvecreadme

tar uf $filename sundials/shared/lib/.dontremove

tar uf $filename sundials/shared/include/llnltyps.h
tar uf $filename sundials/shared/include/llnlmath.h
tar uf $filename sundials/shared/include/nvector.h
tar uf $filename sundials/shared/include/dense.h
tar uf $filename sundials/shared/include/smalldense.h
tar uf $filename sundials/shared/include/band.h
tar uf $filename sundials/shared/include/spgmr.h
tar uf $filename sundials/shared/include/iterativ.h
tar uf $filename sundials/shared/include/fcmixpar.h

tar uf $filename sundials/shared/source/Makefile
tar uf $filename sundials/shared/source/llnlmath.c
tar uf $filename sundials/shared/source/nvector.c
tar uf $filename sundials/shared/source/dense.c
tar uf $filename sundials/shared/source/smalldense.c
tar uf $filename sundials/shared/source/band.c
tar uf $filename sundials/shared/source/spgmr.c
tar uf $filename sundials/shared/source/iterativ.c

if [ $ser = "T" ]
then
    tar uf $filename sundials/shared/include/nvector_serial.h
    tar uf $filename sundials/shared/include/fnvector_serial.h

    tar uf $filename sundials/shared/source/nvecserial.mk
    tar uf $filename sundials/shared/source/nvector_serial.c
    tar uf $filename sundials/shared/source/fnvector_serial.c
fi

if [ $par = "T" ]
then
    tar uf $filename sundials/shared/include/nvector_parallel.h
    tar uf $filename sundials/shared/include/fnvector_parallel.h

    tar uf $filename sundials/shared/source/nvecparallel.mk
    tar uf $filename sundials/shared/source/nvector_parallel.c
    tar uf $filename sundials/shared/source/fnvector_parallel.c
fi

# Add CVODES module
#------------------

echo "  Add cvodes module"

tar uf $filename sundials/cvodes/include/cvodes.h
tar uf $filename sundials/cvodes/include/cvodea.h
tar uf $filename sundials/cvodes/include/cvsdense.h
tar uf $filename sundials/cvodes/include/cvsband.h
tar uf $filename sundials/cvodes/include/cvsdiag.h
tar uf $filename sundials/cvodes/include/cvsspgmr.h
tar uf $filename sundials/cvodes/include/cvsbandpre.h
tar uf $filename sundials/cvodes/include/cvsbbdpre.h

tar uf $filename sundials/cvodes/source/Makefile
tar uf $filename sundials/cvodes/source/cvodes.c
tar uf $filename sundials/cvodes/source/cvodea.c
tar uf $filename sundials/cvodes/source/cvsdense.c
tar uf $filename sundials/cvodes/source/cvsband.c
tar uf $filename sundials/cvodes/source/cvsdiag.c
tar uf $filename sundials/cvodes/source/cvsspgmr.c
tar uf $filename sundials/cvodes/source/cvsbandpre.c
tar uf $filename sundials/cvodes/source/cvsbbdpre.c

tar uf $filename sundials/cvodes/lib/.dontremove

tar uf $filename sundials/cvodes/examples/Makefile

tar uf $filename sundials/cvodes/fwd_examples/Makefile

tar uf $filename sundials/cvodes/adj_examples/Makefile

if [ $ser = "T" ]
then
    tar uf $filename sundials/cvodes/examples/cvx_ser.mk
    tar uf $filename sundials/cvodes/examples/cvdx.c
    tar uf $filename sundials/cvodes/examples/cvbx.c
    tar uf $filename sundials/cvodes/examples/cvkx.c
    tar uf $filename sundials/cvodes/examples/cvkxb.c
    tar uf $filename sundials/cvodes/examples/cvdemd.c
    tar uf $filename sundials/cvodes/examples/cvdemk.c

    tar uf $filename sundials/cvodes/fwd_examples/cvsx_ser.mk
    tar uf $filename sundials/cvodes/fwd_examples/cvsdx.c
    tar uf $filename sundials/cvodes/fwd_examples/cvsnx.c
    tar uf $filename sundials/cvodes/fwd_examples/cvskx.c

    tar uf $filename sundials/cvodes/adj_examples/cvax_ser.mk
    tar uf $filename sundials/cvodes/adj_examples/adadj.c
    tar uf $filename sundials/cvodes/adj_examples/chemadj.c
    tar uf $filename sundials/cvodes/adj_examples/foodadj.c
    tar uf $filename sundials/cvodes/adj_examples/foodadj1.c
fi


if [ $par = "T" ]
then
    tar uf $filename sundials/cvodes/examples/cvx_par.mk
    tar uf $filename sundials/cvodes/examples/pvnx.c
    tar uf $filename sundials/cvodes/examples/pvkx.c
    tar uf $filename sundials/cvodes/examples/pvkxb.c

    tar uf $filename sundials/cvodes/fwd_examples/cvsx_par.mk
    tar uf $filename sundials/cvodes/fwd_examples/pvsnx.c
    tar uf $filename sundials/cvodes/fwd_examples/pvskx.c

    tar uf $filename sundials/cvodes/adj_examples/cvax_par.mk
fi


#----End of tarcvodes script file----