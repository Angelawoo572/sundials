# -----------------------------------------------------------------
# $Revision: 1.4 $
# $Date: 2012-04-26 00:06:10 $
# -----------------------------------------------------------------
# Programmer(s): Radu Serban, Slaven Peles @ LLNL
# -----------------------------------------------------------------
# LLNS Copyright Start
# Copyright (c) 2014, Lawrence Livermore National Security
# This work was performed under the auspices of the U.S. Department 
# of Energy by Lawrence Livermore National Laboratory in part under 
# Contract W-7405-Eng-48 and in part under Contract DE-AC52-07NA27344.
# Produced at the Lawrence Livermore National Laboratory.
# All rights reserved.
# For details, see the LICENSE file.
# LLNS Copyright End
# -----------------------------------------------------------------
# Makefile for SUNDIALS documents
# -----------------------------------------------------------------

QUIET =

SHARED_DOC = ../sundials

HTML_DIR = ../../html/documentation

# Use pdflatex as default compiler
TEX_COMPILER = pdflatex

UG_SHARED_FILES = \
fortran.tex \
install.tex \
linsolv.tex \
nvec_generic.tex \
nvec_parallel.tex \
nvec_petsc.tex \
nvec_parhyp.tex \
nvec_serial.tex \
nvec_openmp.tex \
nvec_pthreads.tex \
nvec_parhyp.tex \
spils_constants.tex \
sun_org.tex \
types.tex \
ug.tex \
biblio.bib
#texi2dvi 
#ug_html.tex \
#processHTML

UG_SHARED_FIGURES = \
bandmat.pdf \
cscmat.pdf \
sunorg1.pdf \
sunorg2.pdf \
doc_logo_blue.pdf \
warning.pdf

UG_CMAKE_FIGURES = \
ccmakedefault.png \
ccmakeempty.pdf \
ccmakeprefix.png \
testrunnertop.png\
testrunnerbot.png\
cmaketest.pdf

EX_SHARED_FILES = \
ug.tex \
biblio.bib
#texi2dvi \
#ug_html.tex \
#processHTML

#HTML_BUTTONS =\
#back.png \
#contents.png \
#index.png \
#next.png \
#next_g.png \
#prev.png \
#prev_g.png \
#up.png \
#up_g.png \
#warning.png


#-------------------------------------------------------------------------------

all:
	@echo "Usage:"
	@echo "  make ug     - compile LaTeX files to give PDF for User's Guide (pdflatex)"
	@echo "  make ex     - compile LaTeX files to give PDF for Examples Guide (pdflatex)"
	@echo "  make clean  - remove all temporary files"
	@echo "  make purge  - remove temporary files + PDF files"
	@echo "  make ug_pdf - generate PDF file for User's Guide using pdflatex"
	@echo "  make ex_pdf - generate PDF file for Examples Guide using pdflatex"
	@echo "  make ug_xel - generate PDF file for User's Guide using xelatex"
	@echo "  make ex_xel - generate PDF file for Examples Guide using xelatex"
	@echo ""

install: ug ex
#install: ug_pdf ex_pdf ug_html ex_html
#	rm -rf $(HTML_DIR)/${USER_GUIDE}
#	rm -rf $(HTML_DIR)/${EXAMPLES}
#	cp ${USER_GUIDE}.ps $(HTML_DIR)
	cp ${USER_GUIDE}.pdf $(HTML_DIR)
#	cp -r ${USER_GUIDE} $(HTML_DIR)
#	cp ${EXAMPLES}.ps $(HTML_DIR)
	cp ${EXAMPLES}.pdf $(HTML_DIR)
#	cp -r ${EXAMPLES} $(HTML_DIR)

#-------------------------------------------------------------------------------

ug: 	copy_ug copy_ug_figs copy_ug_cmake_figs ${USER_GUIDE}.pdf

ug_pdf: use_pdflatex ug

ug_xel: use_xelatex ug

#ug_html: ug
#	cp ug_html.tex ug.tex
#	latex2html -split 3 -link 3 -info 1 -no_math -html_version 3.2,math -show_section_numbers -short_index -local_icons -white -notransparent ${USER_GUIDE}.tex
#	@for i in ${HTML_BUTTONS} ; do \
#	cp ${SHARED_DOC}/buttons/$${i} ${USER_GUIDE}/ ;\
#	done
#	@cp ${SHARED_DOC}/l2h_styles.css ${USER_GUIDE}/${USER_GUIDE}.css
#	./processHTML ${USER_GUIDE}

copy_ug:
	@for i in ${UG_SHARED_FILES} ; do \
	cp ${SHARED_DOC}/$${i} . ;\
	done

copy_ug_figs:
	@for i in ${UG_SHARED_FIGURES} ; do \
	cp ${SHARED_DOC}/figures/$${i} . ;\
	done

copy_ug_cmake_figs:
	@for i in ${UG_CMAKE_FIGURES} ; do \
	cp ${SHARED_DOC}/figures/cmake/$${i} . ;\
	done

${USER_GUIDE}.pdf: ${UG_FILES} ${UG_SHARED_FILES:%=${SHARED_DOC}/%}
	${TEX_COMPILER} ${QUIET} ${USER_GUIDE}.tex
	bibtex ${USER_GUIDE}
	makeindex ${USER_GUIDE}.idx
	${TEX_COMPILER} ${QUIET} ${USER_GUIDE}.tex
	${TEX_COMPILER} ${QUIET} ${USER_GUIDE}.tex


#-------------------------------------------------------------------------------

ex: ug copy_ex ${EXAMPLES}.pdf

ex_pdf: use_pdflatex ex

ex_xel: use_xelatex ex

#ex_html: ex
#	cp ug_html.tex ug.tex
#	latex2html -split 4 -link 4 -info 1 -no_math -html_version 3.2,math -show_section_numbers -local_icons -white -notransparent ${EXAMPLES}.tex
#	@for i in ${HTML_BUTTONS} ; do \
#	cp ${SHARED_DOC}/buttons/$${i} ${EXAMPLES}/ ;\
#	done
#	@cp ${SHARED_DOC}/l2h_styles.css ${EXAMPLES}/${EXAMPLES}.css
#	./processHTML ${EXAMPLES}

copy_ex:
	@for i in ${EX_SHARED_FILES} ; do \
	cp ${SHARED_DOC}/$${i} . ;\
	done

${EXAMPLES}.pdf: ${EX_FILES} ${EX_SHARED_FILES:%=${SHARED_DOC}/%}
	${TEX_COMPILER} ${QUIET} ${EXAMPLES}.tex
	bibtex ${EXAMPLES}
	makeindex ${EXAMPLES}.idx
	${TEX_COMPILER} ${QUIET} ${EXAMPLES}.tex
	${TEX_COMPILER} ${QUIET} ${EXAMPLES}.tex


#-------------------------------------------------------------------------------

use_pdflatex:
	$(eval TEX_COMPILER := pdflatex)

use_xelatex:
	$(eval TEX_COMPILER := xelatex)

clean:
	rm -rf ${UG_SHARED_FILES}
	rm -rf ${UG_SHARED_FIGURES}
	rm -rf ${UG_CMAKE_FIGURES}
	rm -rf ${EX_SHARED_FILES}
	rm -f *~ *.aux *.bbl *.blg *.log *.toc *.lot *.lof *.ist *.ind *.ilg *.idx *.dvi *.out
purge:  clean
	rm -f ${USER_GUIDE}.pdf
	rm -f ${EXAMPLES}.pdf
	rm -rf ${USER_GUIDE} ${EXAMPLES}
