%===================================================================================
\chapter{Description of the {\nvector} module}\label{s:nvector}
%===================================================================================
\input{nvec_generic}

%---------------------------------------------------------------------------
\section{The {\nvecs} implementation of {\nvector}}\label{ss:nvec_ser}
\input{nvec_serial}

%---------------------------------------------------------------------------
\section{The {\nvecp} implementation of {\nvector}}\label{ss:nvec_par}
\input{nvec_parallel}

%---------------------------------------------------------------------------
\section{{\nvector} kernels used by {\cvodes}}

In Table \ref{t:nvecuse} below, we list the vector kernels in the 
{\nvector} module within the {\cvodes} package.
The table also shows, for each kernel, which of the code modules uses
the kernel. The {\cvodes} column shows kernel usage within the main
integrator module, while the remaining four columns show kernel usage
within each of the four {\cvodes} linear solvers. 

There is one subtlety in the {\cvspgmr} column hidden by the table. 
The dot product kernel \id{N\_VDotProd} is called both within the 
implementation file \id{cvsspgmr.c} for the {\cvspgmr} solver and within 
the implementation files \id{spgmr.c} and \id{iterative.c} for the generic {\spgmr} 
solver upon which the {\cvspgmr} solver is implemented. 
This issue does not arise for the other 
three {\cvodes} linear solvers because the generic {\dense} and {\band} solvers 
(used in the implementation of {\cvdense} and {\cvband}) do not make calls to 
any vector kernels and {\cvdiag} is not implemented using a generic diagonal solver. 

The vector kernels \id{N\_VMake}, \id{N\_VDispose}, \id{N\_VGetData}, and
\id{N\_VSetData} are only called by the {\cvodes} direct linear solvers, 
{\cvdense} and {\cvband}, and by preconditioner solve routines that use a 
direct linear solver ({\cvbandpre}  and {\cvbbdpre}). They duplicate 
functionality provided by macros in particular implementations of {\nvector},
but are part of the specifications of the generic {\nvector} module to insure 
that the {\cvodes} package is not dependent on any particular {\nvector} implementation.

At this point, we should emphasize that the {\cvodes} user does not need to know 
anything about the usage of vector kernels by the {\cvodes} code modules in order 
to use {\cvodes}. The information is presented as an implementation detail for the 
interested reader.

\begin{table}[htb]
\centering
\caption{List of vector kernels usage by {\cvodes} code modules}\label{t:nvecuse}
\medskip
\begin{tabular}{|l|c|c|c|c|c|} \hline
{\bf Kernel}       & {\cvodes} & {\cvdense} & {\cvband} & {\cvdiag} & {\cvspgmr} \\ \hline\hline
\id{N\_VNew}       &   X       &            &           &   X       &   X        \\ \hline
\id{N\_VFree}      &   X       &            &           &   X       &   X        \\ \hline
\id{N\_VSpace}     &   X       &            &           &           &   X        \\ \hline
\id{N\_VNew\_S}    &   X       &            &           &           &            \\ \hline
\id{N\_VFree\_S}   &   X       &            &           &           &            \\ \hline
\id{N\_VMake}      &           &    X       &   X       &           &            \\ \hline
\id{N\_VDispose}   &           &    X       &   X       &           &            \\ \hline
\id{N\_VGetData}   &           &    X       &   X       &           &            \\ \hline
\id{N\_VSetData}   &           &    X       &   X       &           &            \\ \hline
\id{N\_VLinearSum} &   X       &    X       &           &   X       &   X        \\ \hline
\id{N\_VConst}     &   X       &            &           &           &   X        \\ \hline
\id{N\_VProd}      &   X       &            &           &   X       &   X        \\ \hline
\id{N\_VDiv}       &   X       &            &           &   X       &   X        \\ \hline
\id{N\_VScale}     &   X       &    X       &   X       &   X       &   X        \\ \hline
\id{N\_VAbs}       &   X       &            &           &           &            \\ \hline
\id{N\_VInv}       &   X       &            &           &   X       &            \\ \hline
\id{N\_VAddConst}  &   X       &            &           &   X       &            \\ \hline
\id{N\_VDotProd}   &           &            &           &           &   X        \\ \hline
\id{N\_VMaxNorm}   &   X       &            &           &           &            \\ \hline
\id{N\_VWrmsNorm}  &   X       &    X       &   X       &           &   X        \\ \hline
\id{N\_VMin}       &   X       &            &           &           &            \\ \hline
\id{N\_VCompare}   &           &            &           &   X       &            \\ \hline
\id{N\_VInvTest}   &           &            &           &   X       &            \\ \hline
\end{tabular}
\end{table}

The vector kernels listed in Table \ref{t:nvecops} that are {\em not} used by
{\cvodes} are: \id{N\_VWL2Norm}, \id{N\_VL1Norm}, \id{N\_VWrmsNormMask}, \id{N\_VConstrProdPos},
\id{N\_VConstrMask}, and \id{N\_VMinQuotient}. Therefore a user-supplied {\nvector} module
for {\cvodes} could omit these six kernels. Also, recall that a user-supplied {\nvector}
module {\em need not} implement the \id{N\_VNew\_S} and \id{N\_VFree\_S} kernels.