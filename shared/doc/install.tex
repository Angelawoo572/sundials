Generally speaking, the installation procedure outlined in
\S\ref{ss:install_steps} below will work on commodity {\linux}/{\unix} systems
without modification. Users are still encouraged, however, to carefully read
this entire section before attempting to install the {\sundials} suite, in case
non-default choices are desired for compilers, compilation options, or the like.
In lieu of reading the option list below, the user may invoke the configuration
script with the help flag to view a complete listing of available options which
may be done by issuing 
\begin{verbatim}
   % ./configure --help 
\end{verbatim}
from within the \id{sundials} directory.

In the descriptions below, {\em build\_tree} refers to the directory under
which the user wants to build and/or install the {\sundials} package. By
default, the {\sundials} libraries and header files are installed under the
subdirectories {\em build\_tree}\id{/lib} and {\em build\_tree}\id{/include},
respectively. Also, {\em source\_tree} refers to the directory where the
{\sundials} source code is located. The chosen {\em build\_tree} may be
different from the {\em source\_tree}, thus allowing for multiple installations
of the {\sundials} suite with different configuration options.

Concerning the installation procedure outlined below, after invoking the
\id{tar} command with the appropriate options the contents of the
{\sundials} archive (or the {\em source\_tree}) will be extracted to a
directory named \id{sundials}. Since the name of the extracted directory
is not version-specific it is recommended that the user refrain from
extracting the archive to a directory containing a previous version/release
of the {\sundials} suite. If the user is only upgrading and the previous 
installation of {\sundials} is not needed, then the user may remove the
previous installation by issuing 
\begin{verbatim}
   % rm -Rf sundials
\end{verbatim}
from a shell command prompt.

Even though the installation procedure given below presupposes that the user
will use the default vector kernels supplied with the distribution, using the
{\sundials} suite with a user-supplied vector kernel normally will not require
any changes to the build procedure.  

%%===============================================================================

\section{Installation steps}\label{ss:install_steps}

To install the {\sundials} suite, given a downloaded file named
{\em sundials\_file}\id{.tar.gz}, issue the following commands from
a shell command prompt, while within the directory where {\em source\_tree}
is to be located.  The names of the library and header files
generated are listed in Table \ref{t:sundials_files} for reference.
(For brevity, the corresponding \id{.c} files are not listed.)
\begin{enumerate}
\item \id{gunzip} {\em sundials\_file}\id{.tar.gz}
\item \id{tar -xf} {\em sundials\_file}\id{.tar}\hspace{3em} [creates \id{sundials} directory]
\item \id{cd} {\em build\_tree}
\item {\em path\_to\_source\_tree}\id{/configure} {\em options}\hspace{2em} [options can be absent]
\item \id{make}
\item \id{make install}
\item \id{make examples}
\item If system storage space conservation is a priority, then issue \\ \\
\verb+   % make clean+ \hspace{2em} [removes unneeded object files] \\ \\
and/or \\ \\
\verb+   % make examples_clean+ \hspace{2em} [deletes example executables] \\ \\
from a shell command prompt.
\end{enumerate}

\begin{table}
\centering
\caption{{\sundials} libraries and header files}
\label{t:sundials_files}
\medskip
\begin{tabular}{|c|c|c|c|}\hline
{\bf CVODE} & {\bf CVODES} & {\bf IDA} & {\bf KINSOL} \\
\hline
\id{libcvode.a} & \id{libcvodes.a} & \id{libida.a} & \id{libkinsol.a} \\
\id{libfcvode.a} & & & \id{libfkinsol.a} \\
\hline
\id{cvode.h} & \id{cvodes.h} & \id{ida.h} & \id{kinsol.h} \\
\id{cvband.h} & \id{cvodea.h} & \id{idaband.h} & \id{kinbbdpre.h} \\
\id{cvbandpre.h} & \id{cvband.h} & \id{idabbdpre.h} & \id{kinspgmr.h} \\
\id{cvbbdpre.h} & \id{cvbandpre.h} & \id{idadense.h} & \\
\id{cvdense.h} & \id{cvbbdpre.h} & \id{idaspgmr.h} & \\
\id{cvdiag.h} & \id{cvdense.h} & & \\
\id{cvspgmr.h} & \id{cvdiag.h} & & \\
& \id{cvspgmr.h} & & \\
\hline
\end{tabular}

\medskip
\begin{tabular}{|c|c|}\hline
{\bf NVECTOR} & {\bf SHARED} \\
\hline
\id{libnvecserial.a} & \id{libshared.a} \\
\id{libfnvecserial.a} & \\
\id{libnvecparallel.a} & \\
\id{libfnvecparallel.a} & \\
\hline
\id{nvector.h} & \id{band.h} \\
\id{nvector\_serial.h} & \id{dense.h} \\
\id{fnvector\_serial.h} & \id{iterative.h} \\
\id{nvector\_parallel.h} & \id{smalldense.h} \\
\id{fnvector\_parallel.h} & \id{spgmr.h} \\
& \id{sundialsmath.h} \\
& \id{sundialstypes.h} \\
\hline
\end{tabular}

\end{table}

%%===============================================================================

\section{Configuration options}

The installation procedure given above will generally work without modification;
however, if the system includes multiple {\mpi} implementations, then certain
configure script-related options may be used to indicate which {\mpi}
implementation should be used. Also, if the user wants to use non-default
language compilers, then, again, the necessary shell environment variables must
be appropriately redefined.

The remainder of this section provides explanations of available configure script
options.


%%
%% General options
%%

\begin{config}
  
\item \id{--prefix=PREFIX}
  
  Location for architecture-independent files.
  
  Default: \id{PREFIX =} {\em build\_tree}
  
\item \id{--includedir=DIR}
  
  Alternate location for header files.
  
  Default: \id{DIR = PREFIX/include}
  
\item \id{--libdir=DIR}
  
  Alternate location for libraries.
  
  Default: \id{DIR = PREFIX/lib}
  
\item \id{--disable-examples}
  
  All available example programs are automatically built unless this option is
  used. The example executables are stored under the following subdirectories
  of the associated solver: 
  
  \begin{config}
  \item {\em build\_tree}/{\em solver}/\id{examples\_ser} : serial {\C} examples
  \item {\em build\_tree}/{\em solver}/\id{examples\_par} : parallel {\C} examples ({\mpi}-enabled)
  \item {\em build\_tree}/{\em solver}/\id{fcmix}/\id{examples\_ser} : serial {\F} examples
  \item {\em build\_tree}/{\em solver}/\id{fcmix}/\id{examples\_par} : parallel {\F} examples ({\mpi}-enabled)
  \end{config}
  
  {\em Note}: Some of these subdirectories may not exist depending upon the
  solver and/or the configuration options used.
  
\item \id{--disable-}{\em solver}

  Although each existing solver module is built by default, support for a
  given solver can be explicitly disabled using this option. In both of the
  above, the valid values for {\em solver} are: \id{kinsol}, \id{cvode},
  \id{cvodes}, and \id{ida}.
  
\item \id{--without-f77}

  Using this option will only prevent the {\F} examples included with the
  {\kinsol} and {\cvode} solver modules from being built. The {\fkinsol}
  and {\fcvode} {\F}-{\C} interface modules will be built regardless, if
  available.

\item \id{--with-cppflags=ARG}

  Specify additional {\C} preprocessor flags 
  ({\em e.g.}, \id{ARG = -I<include\_dir>} if necessary header files are located in nonstandard locations).

\item \id{--with-cflags=ARG}

  Specify additional {\C} compilation flags.

\item \id{--with-fflags=ARG}

  Specify additional {\F} compilation flags.

\item \id{--with-ldflags=ARG}

  Specify additional linker flags 
  ({\em e.g.}, \id{ARG = -L<lib\_dir>} if required libraries are located in nonstandard locations).

\item \id{--with-libs=ARG}

  Specify additional libraries to be used 
  ({\em e.g.}, \id{ARG = -l<foo>} to link with the library named \id{libfoo.a}).

\item \id{--with-single-prec}

  By default, {\sundials} will define a real number (internally referred to as
  \id{realtype}) to be a double-precision floating-point numeric data type via
  a preprocessor directive in the header file \id{sundialstypes.h} (located under
  the \id{sundials/shared/include} subdirectory); however, this option may be
  used to build {\sundials} with \id{realtype} alternatively defined as a
  single-precision floating-point numeric data type.

\item \id{--with-f77underscore=ARG}

  This option pertains to the {\fkinsol} and {\fcvode} {\F}-{\C} interface
  modules and is used to specify the number of underscores to append to
  function names so {\F} routines can properly link with the associated
  {\sundials} libraries. Valid values for \id{ARG} are: \id{none}, \id{one}
  and \id{two}.

  Default: \id{ARG = one}

\end{config}

%%
%% Environment variables
%%

\vspace{0.25in}
\noindent The following environment variables can be locally (re)defined for use during the configuration of {\sundials}. See the next section for illustrations of these.

\begin{config}

\item \id{CC}

\item \id{F77}

  Since the configuration script uses the first {\C} and {\F} compilers found in
  the current executable search path, then each relevant shell variable (\id{CC}
  and \id{F77}) must be locally (re)defined in order to use a different compiler. 
  For example, to use \id{xcc} (executable name of chosen compiler) as the {\C}
  language compiler, use \id{CC=xcc} in the configure step.

\item \id{CFLAGS}

\item \id{FFLAGS}

  Use these environment variables to override the default {\C} and {\F}
  compilation flags defined in the \id{sundials/aclocal.m4} script.

\end{config}

%%
%% Parallel options
%%

\vspace{0.25in}
\noindent The following configuration options are only applicable to the parallel {\sundials} packages:

\begin{config}
  
\item \id{--without-mpi}

  Using this option will completely disable {\mpi} support.

\item \id{--with-mpicc=ARG}
\item \id{--with-mpif77=ARG}

  By default, the configuration utility script will use the {\mpi} compiler
  scripts named \id{mpicc} and \id{mpif77} to compile the parallelized
  {\sundials} subroutines; however, for reasons of compatibility, different
  executable names may be specified via the above options. Also, \id{ARG=no}
  can be used to disable the use of {\mpi} compiler scripts, thus causing
  the serial {\C} and {\F} compilers to be used to compile the parallelized
  {\sundials} functions and examples.

\item \id{--with-mpi-root=MPIDIR}

  This option may be used to specify which {\mpi} implementation should be used.
  The {\sundials} configuration script will automatically check under the
  subdirectories \id{MPIDIR/include} and \id{MPIDIR/lib} for the necessary
  header files and libraries. The subdirectory \id{MPIDIR/bin} will also be
  searched for the {\C} and {\F} {\mpi} compiler scripts, unless
  \id{--with-mpicc=no} and/or \id{--with-mpif77=no}.

\item \id{--with-mpi-incdir=INCDIR}
\item \id{--with-mpi-libdir=LIBDIR}
\item \id{--with-mpi-lib=LIBS}

  These options may be used if the user would prefer not to use a preexisting
  {\mpi} compiler script, but instead would rather use a serial complier and
  provide the flags necessary to compile the {\mpi}-aware subroutines in
  {\sundials}.

  Often an {\mpi} implementation will have unique library names and so it may
  be necessary to specify the appropriate libraries to use ({\em e.g.},
  \id{LIBS = -lmpich}).

  Default: \id{INCDIR = MPIDIR/include}, \id{LIBDIR = MPIDIR/lib}, \id{LIBS = -lmpi}

\end{config}


%%
%% Cross-compilation
%%

\vspace{0.25in}
\noindent If the {\sundials} suite will be cross-compiled (meaning the build
procedure will not be completed on the actual destination system, but rather
on an alternate system with a different architecture) then the following two
options should be used:

\begin{config}

\item \id{--build=BUILD}

  This particular option is used to specify the canonical system/platform name
  for the build system.

\item \id{--host=HOST}

  If cross-compiling, then the user must use this option to specify the canonical
  system/platform name for the destination system.

\end{config}


%%===============================================================================

\section{Configuration examples}

The following examples are meant to help demonstrate proper usage of the configure options:

\begin{verbatim}
% configure CC=gcc F77=g77 --with-cflags=-g --with-fflags=-g \
            --with-mpicc=/usr/apps/mpich/1.2.4/bin/mpicc \ 
            --with-mpif77=/usr/apps/mpich/1.2.4/bin/mpif77
\end{verbatim}

\noindent The above example builds {\sundials} using \id{gcc} as the serial {\C}
compiler, \id{g77} as the serial {\F} compiler, \id{mpicc} as the parallel {\C}
compiler, \id{mpif77} as the parallel {\F} compiler, and appends the \id{-g}
compilaton flag to the list of default flags.

\begin{verbatim}
% configure CC=gcc --disable-examples --with-mpicc=no \
            --with-mpi-root=/usr/apps/mpich/1.2.4 \
            --with-mpi-libs=-lmpich
\end{verbatim}

\noindent This example again builds {\sundials} using \id{gcc} as the serial {\C}
compiler, but the \id{--with-mpicc=no} option explicitly disables the use of the
corresponding {\mpi} compiler script. Since the \id{--with-mpi-root} option is
given, the compilation flag \id{-I/usr/apps/mpich/1.2.4/include} is passed to
\id{gcc} when compiling the {\mpi}-enabled functions. Although the
\id{--disable-examples} option disables the examples (which means a {\F} compiler
is not required), the \id{--with-mpi-libs} option is still needed so that the
configure script can check if \id{gcc} can link with the appropriate {\mpi}
library as \id{-lmpi} is the internal default.
